<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéì AI Education Agent - Smart Learning Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'pantone-blue': '#0F4C75',
                        'pantone-teal': '#3282B8',
                        'pantone-light': '#BBE1FA',
                        'pantone-accent': '#1B262C',
                        'pantone-green': '#2E8B57',
                        'pantone-orange': '#FF6B35',
                        'pantone-purple': '#6A4C93'
                    }
                }
            }
        }
    </script>
    <style>
        .feature-interface {
            transition: all 0.3s ease-in-out;
        }
        .feature-interface.hidden {
            display: none;
        }
        .auth-container {
            background: linear-gradient(135deg, #0F4C75 0%, #3282B8 100%);
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid #BBE1FA;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 transition-colors">

    <!-- Home Page / Authentication -->
    <div id="home-page" class="min-h-screen auth-container flex items-center justify-center">
        <div class="max-w-md w-full mx-4">
            <!-- Professional Logo -->
            <div class="text-center mb-8">
                <div class="w-24 h-24 mx-auto mb-4 bg-white rounded-full flex items-center justify-center shadow-lg">
                    <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <!-- Graduation Cap -->
                        <path d="M24 8L8 16L24 24L40 16L24 8Z" fill="#0F4C75" stroke="#3282B8" stroke-width="1"/>
                        <path d="M16 20V28C16 32 20 36 24 36C28 36 32 32 32 28V20" stroke="#0F4C75" stroke-width="2" fill="none"/>
                        <!-- AI Brain Circuit -->
                        <circle cx="24" cy="20" r="3" fill="#3282B8"/>
                        <path d="M21 18L19 16M27 18L29 16M21 22L19 24M27 22L29 24" stroke="#BBE1FA" stroke-width="1.5"/>
                        <!-- Tassel -->
                        <path d="M36 16V20L38 22" stroke="#FF6B35" stroke-width="2" fill="none"/>
                        <circle cx="38" cy="22" r="1.5" fill="#FF6B35"/>
                    </svg>
                </div>
                <h1 class="text-3xl font-bold text-white mb-2" data-translate="ai-education-agent">AI Education Agent</h1>
                <p class="text-pantone-light" data-translate="smart-learning-platform-govt">Smart Learning Platform for Government Schools</p>
            </div>

            <!-- Role Selection -->
            <div id="role-selection" class="glass-effect rounded-lg p-6 mb-6">
                <h2 class="text-xl font-semibold text-white mb-4 text-center" data-translate="choose-role">Choose Your Role</h2>
                <div class="grid grid-cols-2 gap-4">
                    <button onclick="showLogin('student')" class="bg-pantone-green hover:bg-green-600 text-white py-3 px-4 rounded-lg transition-colors flex flex-col items-center">
                        <span class="text-2xl mb-1">üë®‚Äçüéì</span>
                        <span>Student</span>
                    </button>
                    <button onclick="showLogin('teacher')" class="bg-pantone-purple hover:bg-purple-600 text-white py-3 px-4 rounded-lg transition-colors flex flex-col items-center">
                        <span class="text-2xl mb-1">üë®‚Äçüè´</span>
                        <span>Teacher</span>
                    </button>
                </div>
            </div>

            <!-- Login Form -->
            <div id="login-form" class="glass-effect rounded-lg p-6 hidden">
                <div class="flex items-center justify-between mb-4">
                    <h2 id="login-title" class="text-xl font-semibold text-white">Student Login</h2>
                    <button onclick="showRoleSelection()" class="text-pantone-light hover:text-white">
                        <span class="text-sm">‚Üê Back</span>
                    </button>
                </div>

                <form onsubmit="handleLogin(event)">
                    <div class="mb-4">
                        <label class="block text-pantone-light text-sm font-medium mb-2">Student ID / Email</label>
                        <input type="text" id="login-id" class="w-full px-3 py-2 bg-white bg-opacity-20 border border-white border-opacity-30 rounded-lg text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-pantone-light" placeholder="Enter your ID or email" required>
                    </div>
                    <div class="mb-6">
                        <label class="block text-pantone-light text-sm font-medium mb-2">Password</label>
                        <div class="relative">
                            <input type="password" id="login-password" class="w-full px-3 py-2 pr-10 bg-white bg-opacity-20 border border-white border-opacity-30 rounded-lg text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-pantone-light" placeholder="Enter your password" required>
                            <button type="button" class="absolute inset-y-0 right-0 pr-3 flex items-center" onclick="togglePasswordVisibility('login-password', this)">
                                <svg class="h-5 w-5 text-gray-300 hover:text-white transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                </svg>
                            </button>
                        </div>
                    </div>
                    <button type="submit" class="w-full bg-pantone-orange hover:bg-orange-600 text-white py-2 px-4 rounded-lg transition-colors font-medium">
                        Login
                    </button>
                </form>

                <!-- Teacher Signup Option -->
                <div id="teacher-signup-option" class="mt-4 text-center hidden">
                    <p class="text-pantone-light text-sm mb-2">Don't have an account?</p>
                    <button onclick="showSignup()" class="text-pantone-light hover:text-white underline text-sm">
                        Sign up as Teacher
                    </button>
                </div>
            </div>

            <!-- Signup Form -->
            <div id="signup-form" class="glass-effect rounded-lg p-6 hidden">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-semibold text-white">Teacher Signup</h2>
                    <button onclick="showLogin('teacher')" class="text-pantone-light hover:text-white">
                        <span class="text-sm">‚Üê Back to Login</span>
                    </button>
                </div>

                <form onsubmit="handleSignup(event)">
                    <div class="mb-4">
                        <label class="block text-pantone-light text-sm font-medium mb-2">Full Name</label>
                        <input type="text" id="signup-name" class="w-full px-3 py-2 bg-white bg-opacity-20 border border-white border-opacity-30 rounded-lg text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-pantone-light" placeholder="Enter your full name" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-pantone-light text-sm font-medium mb-2">Email</label>
                        <input type="email" id="signup-email" class="w-full px-3 py-2 bg-white bg-opacity-20 border border-white border-opacity-30 rounded-lg text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-pantone-light" placeholder="Enter your email" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-pantone-light text-sm font-medium mb-2">School Name</label>
                        <input type="text" id="signup-school" class="w-full px-3 py-2 bg-white bg-opacity-20 border border-white border-opacity-30 rounded-lg text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-pantone-light" placeholder="Enter your school name" required>
                    </div>
                    <div class="mb-6">
                        <label class="block text-pantone-light text-sm font-medium mb-2">Password</label>
                        <div class="relative">
                            <input type="password" id="signup-password" class="w-full px-3 py-2 pr-10 bg-white bg-opacity-20 border border-white border-opacity-30 rounded-lg text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-pantone-light" placeholder="Create a password" required>
                            <button type="button" class="absolute inset-y-0 right-0 pr-3 flex items-center" onclick="togglePasswordVisibility('signup-password', this)">
                                <svg class="h-5 w-5 text-gray-300 hover:text-white transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                </svg>
                            </button>
                        </div>
                    </div>
                    <button type="submit" class="w-full bg-pantone-green hover:bg-green-600 text-white py-2 px-4 rounded-lg transition-colors font-medium">
                        Create Account
                    </button>
                </form>
            </div>

            <!-- Demo Credentials -->
            <div class="glass-effect rounded-lg p-4 mt-6">
                <h3 class="text-lg font-semibold text-white mb-3 text-center">üîë Demo Credentials</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                    <div class="bg-white bg-opacity-10 rounded p-3">
                        <h4 class="font-medium text-pantone-light mb-2">üë®‚Äçüè´ Teacher Login</h4>
                        <p class="text-white">Email: <code class="bg-black bg-opacity-20 px-1 rounded">teacher@demo.com</code></p>
                        <p class="text-white">Password: <code class="bg-black bg-opacity-20 px-1 rounded">demo123</code></p>
                    </div>
                    <div class="bg-white bg-opacity-10 rounded p-3">
                        <h4 class="font-medium text-pantone-light mb-2">üë®‚Äçüéì Student Login</h4>
                        <p class="text-white">Student ID: <code class="bg-black bg-opacity-20 px-1 rounded">STU001</code></p>
                        <p class="text-white">Password: <code class="bg-black bg-opacity-20 px-1 rounded">stu001123</code></p>
                    </div>
                </div>
                <div class="text-center mt-4">
                    <button onclick="resetDemoData()" class="bg-pantone-orange hover:bg-orange-600 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                        üîÑ Reset Demo Data
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application (Hidden Initially) -->
    <div id="main-app" class="hidden">

    <!-- Header -->
    <header class="bg-gradient-to-r from-pantone-blue to-pantone-teal dark:from-pantone-accent dark:to-pantone-blue text-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                        <svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <!-- Graduation Cap -->
                            <path d="M24 8L8 16L24 24L40 16L24 8Z" fill="white" stroke="#BBE1FA" stroke-width="1"/>
                            <path d="M16 20V28C16 32 20 36 24 36C28 36 32 32 32 28V20" stroke="white" stroke-width="2" fill="none"/>
                            <!-- AI Brain Circuit -->
                            <circle cx="24" cy="20" r="3" fill="#BBE1FA"/>
                            <path d="M21 18L19 16M27 18L29 16M21 22L19 24M27 22L29 24" stroke="white" stroke-width="1.5"/>
                            <!-- Tassel -->
                            <path d="M36 16V20L38 22" stroke="#FF6B35" stroke-width="2" fill="none"/>
                            <circle cx="38" cy="22" r="1.5" fill="#FF6B35"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold" data-translate="ai-education-agent">AI Education Agent</h1>
                        <p class="text-pantone-light text-sm" data-translate="smart-learning-platform">Smart Learning Platform</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-right">
                        <p id="user-welcome" class="text-sm font-medium" data-translate="welcome-back">Welcome back!</p>
                        <p id="user-role" class="text-xs text-pantone-light" data-translate="student-dashboard">Ready to learn today?</p>
                    </div>
                    <div class="w-10 h-10 bg-pantone-teal rounded-full flex items-center justify-center">
                        <span id="user-avatar" class="text-lg font-bold">üë§</span>
                    </div>
                    <button onclick="showHelpModal()" class="bg-pantone-purple hover:bg-purple-600 px-3 py-1 rounded text-sm transition-colors mr-2" data-translate="help">
                        Help
                    </button>
                    <button onclick="logout()" class="bg-pantone-orange hover:bg-orange-600 px-3 py-1 rounded text-sm transition-colors" data-translate="logout">
                        Logout
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <div class="bg-white dark:bg-gray-800 shadow">
        <div class="max-w-7xl mx-auto">
            <div class="flex justify-between items-center px-4 py-2">
                <nav class="flex space-x-8" aria-label="Tabs">
                <button onclick="showTab(0)" id="tab-0" class="py-4 px-1 border-b-2 font-medium text-sm border-pantone-teal dark:border-pantone-light text-pantone-blue dark:text-pantone-light">
                    <div class="flex items-center space-x-2">
                        <span>üìö</span>
                        <span data-translate="student-dashboard">Student Dashboard</span>
                    </div>
                </button>
                <button onclick="showTab(1)" id="tab-1" class="py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 dark:text-gray-400 hover:text-pantone-blue dark:hover:text-pantone-light hover:border-pantone-teal dark:hover:border-pantone-light">
                    <div class="flex items-center space-x-2">
                        <span>üë®‚Äçüè´</span>
                        <span data-translate="teacher-dashboard">Teacher Dashboard</span>
                    </div>
                </button>
                <button onclick="showTab(2)" id="tab-2" class="py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 dark:text-gray-400 hover:text-pantone-blue dark:hover:text-pantone-light hover:border-pantone-teal dark:hover:border-pantone-light">
                    <div class="flex items-center space-x-2">
                        <span>ü§ñ</span>
                        <span data-translate="ai-features">AI Features</span>
                    </div>
                </button>
                <button onclick="showTab(3)" id="tab-3" class="py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 dark:text-gray-400 hover:text-pantone-blue dark:hover:text-pantone-light hover:border-pantone-teal dark:hover:border-pantone-light">
                    <div class="flex items-center space-x-2">
                        <span>üìä</span>
                        <span data-translate="report-card">Report Card</span>
                    </div>
                </button>
                </nav>

                <div class="flex items-center space-x-2">
                    <!-- Language Selector -->
                    <div class="relative">
                        <button id="language-toggle" class="p-2 rounded-lg bg-pantone-light dark:bg-pantone-accent hover:bg-pantone-teal dark:hover:bg-pantone-blue transition-colors flex items-center space-x-1" onclick="toggleLanguageDropdown()">
                            <span class="text-pantone-blue dark:text-pantone-light">üåê</span>
                            <span id="current-language" class="text-xs text-pantone-blue dark:text-pantone-light font-medium">EN</span>
                        </button>

                        <!-- Language Dropdown -->
                        <div id="language-dropdown" class="absolute right-0 mt-2 w-32 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 z-50 hidden">
                            <div class="py-1">
                                <button onclick="changeLanguage('en', 'EN')" class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-pantone-light dark:hover:bg-pantone-accent transition-colors">
                                    üá∫üá∏ English
                                </button>
                                <button onclick="changeLanguage('te', '‡∞§‡±Ü')" class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-pantone-light dark:hover:bg-pantone-accent transition-colors">
                                    üáÆüá≥ ‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å
                                </button>
                                <button onclick="changeLanguage('hi', '‡§π‡§ø')" class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-pantone-light dark:hover:bg-pantone-accent transition-colors">
                                    üáÆüá≥ ‡§π‡§ø‡§Ç‡§¶‡•Ä
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Theme Toggle -->
                    <button id="theme-toggle" class="p-2 rounded-lg bg-pantone-light dark:bg-pantone-accent hover:bg-pantone-teal dark:hover:bg-pantone-blue transition-colors" onclick="toggleTheme()">
                        <span id="theme-icon" class="text-pantone-blue dark:text-pantone-light">üåô</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8 bg-gray-50 dark:bg-gray-900 min-h-screen transition-colors">
        <div class="px-4 py-6 sm:px-0">
            <!-- Student Dashboard -->
            <div id="content-0" class="tab-content">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Student Profile Card -->
                    <div class="lg:col-span-1">
                        <div class="bg-gradient-to-br from-purple-500 to-blue-600 dark:from-purple-600 dark:to-blue-700 rounded-lg shadow-lg text-white p-6">
                            <div class="text-center">
                                <div class="w-20 h-20 bg-white bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <span class="text-2xl font-bold">P</span>
                                </div>
                                <h3 class="text-xl font-bold mb-2">Priya Sharma</h3>
                                <p class="text-purple-100 mb-1">Grade 8 Student</p>
                                <p class="text-purple-100 text-sm">Learning Style: Visual</p>

                                <div class="mt-4">
                                    <p class="text-sm text-purple-100 mb-2">Overall Progress</p>
                                    <div class="bg-white bg-opacity-20 rounded-full h-3 mb-2">
                                        <div class="bg-white h-3 rounded-full" style="width: 76%"></div>
                                    </div>
                                    <p class="text-sm font-semibold">76%</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- AI Insights -->
                    <div class="lg:col-span-2">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center mb-4">
                                <span class="text-2xl mr-2">ü§ñ</span>
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">AI-Powered Insights</h3>
                                <button onclick="refreshInsights()" class="ml-auto text-blue-500 hover:text-blue-700">
                                    <span class="text-sm">üîÑ Refresh</span>
                                </button>
                            </div>

                            <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-4">
                                <p class="text-green-800 text-sm">
                                    Great progress, Priya! You're doing well in Mathematics and Science. Keep working on English Grammar and you'll see amazing improvement!
                                </p>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <h4 class="text-sm font-medium text-blue-600 mb-2">üéØ Strengths</h4>
                                    <div class="space-x-2">
                                        <span class="inline-block bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">‚≠ê Mathematics</span>
                                        <span class="inline-block bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">‚≠ê Science</span>
                                    </div>
                                </div>
                                <div>
                                    <h4 class="text-sm font-medium text-orange-600 mb-2">üìö Focus Areas</h4>
                                    <div class="space-x-2">
                                        <span class="inline-block bg-orange-100 text-orange-800 text-xs px-2 py-1 rounded-full">üìù English Grammar</span>
                                        <span class="inline-block bg-orange-100 text-orange-800 text-xs px-2 py-1 rounded-full">üìù History</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Subject Performance -->
                    <div class="lg:col-span-1">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold mb-4 text-gray-900 dark:text-white">üìä Subject Performance</h3>
                            <div class="space-y-4">
                                <div>
                                    <div class="flex justify-between text-sm mb-1">
                                        <span>Mathematics</span>
                                        <span class="font-semibold">85%</span>
                                    </div>
                                    <div class="bg-gray-200 rounded-full h-2">
                                        <div class="bg-green-500 h-2 rounded-full" style="width: 85%"></div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between text-sm mb-1">
                                        <span>Science</span>
                                        <span class="font-semibold">78%</span>
                                    </div>
                                    <div class="bg-gray-200 rounded-full h-2">
                                        <div class="bg-yellow-500 h-2 rounded-full" style="width: 78%"></div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between text-sm mb-1">
                                        <span>English</span>
                                        <span class="font-semibold">65%</span>
                                    </div>
                                    <div class="bg-gray-200 rounded-full h-2">
                                        <div class="bg-red-500 h-2 rounded-full" style="width: 65%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="lg:col-span-3">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold mb-4 text-gray-900 dark:text-white">üöÄ Quick Actions</h3>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <button onclick="startLearning()" class="bg-blue-500 hover:bg-blue-600 text-white py-4 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 shadow-md">
                                    <div class="text-center">
                                        <div class="w-8 h-8 mx-auto mb-2 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                            <span class="text-white font-bold text-lg">‚ñ∂</span>
                                        </div>
                                        <div class="text-sm font-medium">Start Learning</div>
                                    </div>
                                </button>
                                <button onclick="generateWorksheet()" class="bg-green-500 hover:bg-green-600 text-white py-4 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 shadow-md">
                                    <div class="text-center">
                                        <div class="w-8 h-8 mx-auto mb-2 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                            <span class="text-white font-bold text-sm">üìù</span>
                                        </div>
                                        <div class="text-sm font-medium">Generate Worksheet</div>
                                    </div>
                                </button>
                                <button onclick="askAI()" class="bg-purple-500 hover:bg-purple-600 text-white py-4 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 shadow-md">
                                    <div class="text-center">
                                        <div class="w-8 h-8 mx-auto mb-2 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                            <span class="text-white font-bold text-xs">ü§ñ</span>
                                        </div>
                                        <div class="text-sm font-medium">Ask AI Tutor</div>
                                    </div>
                                </button>
                                <button onclick="viewProgress()" class="bg-orange-500 hover:bg-orange-600 text-white py-4 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 shadow-md">
                                    <div class="text-center">
                                        <div class="w-8 h-8 mx-auto mb-2 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                            <span class="text-white font-bold text-sm">üìä</span>
                                        </div>
                                        <div class="text-sm font-medium">View Progress</div>
                                    </div>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Teacher Dashboard -->
            <div id="content-1" class="tab-content hidden">
                <div class="grid grid-cols-1 md:grid-cols-5 gap-6 mb-6">
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 text-center hover:shadow-xl transition-shadow cursor-pointer" onclick="showStatDetails('students')">
                        <div class="text-3xl text-pantone-teal mb-2">üë•</div>
                        <div id="total-students-count" class="text-2xl font-bold text-pantone-blue dark:text-pantone-light">25</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">Total Students</div>
                        <div id="students-weekly-change" class="text-xs text-pantone-green mt-1">+2 this week</div>
                    </div>
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 text-center hover:shadow-xl transition-shadow cursor-pointer" onclick="showStatDetails('performance')">
                        <div class="text-3xl text-pantone-green mb-2">üìà</div>
                        <div id="avg-performance" class="text-2xl font-bold text-pantone-green dark:text-green-400">72.5%</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">Avg Performance</div>
                        <div class="text-xs text-pantone-green mt-1">+3.2% this month</div>
                    </div>
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 text-center hover:shadow-xl transition-shadow cursor-pointer" onclick="showStatDetails('sessions')">
                        <div class="text-3xl text-pantone-teal mb-2">üéì</div>
                        <div id="active-sessions-count" class="text-2xl font-bold text-pantone-teal dark:text-pantone-light">8</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">Active Sessions</div>
                        <div class="text-xs text-pantone-teal mt-1">Live now</div>
                    </div>
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 text-center hover:shadow-xl transition-shadow cursor-pointer" onclick="showStatDetails('worksheets')">
                        <div class="text-3xl text-pantone-purple mb-2">üìù</div>
                        <div id="worksheets-done-count" class="text-2xl font-bold text-pantone-purple dark:text-purple-400">45</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">Worksheets Done</div>
                        <div class="text-xs text-pantone-orange mt-1">12 today</div>
                    </div>
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 text-center hover:shadow-xl transition-shadow cursor-pointer" onclick="showStatDetails('doubts')">
                        <div class="text-3xl text-pantone-orange mb-2">ü§ñ</div>
                        <div id="pending-doubts-count" class="text-2xl font-bold text-pantone-orange dark:text-orange-400">12</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">Pending Doubts</div>
                        <div class="text-xs text-red-500 mt-1">3 urgent</div>
                    </div>
                </div>

                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">üë• Class 8 - Student Overview</h3>
                        <div class="space-x-2">
                            <button onclick="addNewStudent()" class="bg-pantone-teal text-white px-4 py-2 rounded-lg text-sm hover:bg-blue-600" data-translate="add-student">+ Add Student</button>
                            <button onclick="showTab(3)" class="bg-pantone-purple text-white px-4 py-2 rounded-lg text-sm hover:bg-purple-600">üìä Report Cards</button>
                            <button onclick="exportToExcel()" class="bg-pantone-green text-white px-4 py-2 rounded-lg text-sm hover:bg-green-600" data-translate="export-excel">üìä Export Excel</button>
                        </div>
                    </div>

                    <div class="overflow-x-auto">
                        <table id="teacher-students-table" class="min-w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Student</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Performance</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Strengths</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Focus Areas</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr class="hover:bg-gray-50">
                                    <td class="px-6 py-4">
                                        <div class="flex items-center">
                                            <div class="w-10 h-10 bg-purple-500 rounded-full flex items-center justify-center text-white font-bold mr-3">P</div>
                                            <div>
                                                <div class="text-sm font-medium text-gray-900">Priya Sharma</div>
                                                <div class="text-sm text-gray-500">STU001</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4">
                                        <div class="text-sm font-medium text-gray-900">76%</div>
                                        <div class="bg-gray-200 rounded-full h-2 mt-1">
                                            <div class="bg-yellow-500 h-2 rounded-full" style="width: 76%"></div>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4">
                                        <span class="inline-block bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full mr-1">Math</span>
                                        <span class="inline-block bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Science</span>
                                    </td>
                                    <td class="px-6 py-4">
                                        <span class="inline-block bg-orange-100 text-orange-800 text-xs px-2 py-1 rounded-full mr-1">English</span>
                                        <span class="inline-block bg-orange-100 text-orange-800 text-xs px-2 py-1 rounded-full">History</span>
                                    </td>
                                    <td class="px-6 py-4">
                                        <span class="inline-block bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Active</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <div class="flex space-x-2">
                                            <button onclick="event.stopPropagation(); showStudentDetails('STU001', 'Priya Sharma')" class="text-blue-600 hover:text-blue-900 px-2 py-1 rounded text-xs" data-translate="view">View</button>
                                            <button onclick="event.stopPropagation(); editStudent('STU001')" class="text-green-600 hover:text-green-900 px-2 py-1 rounded text-xs" data-translate="edit">Edit</button>
                                            <button onclick="event.stopPropagation(); confirmRemoveStudent('STU001', 'Priya Sharma')" class="text-red-600 hover:text-red-900 px-2 py-1 rounded text-xs" data-translate="remove">Remove</button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- AI Features -->
            <div id="content-2" class="tab-content hidden">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div onclick="selectFeature('doubt')" class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 cursor-pointer hover:shadow-xl transition-shadow border-2 border-blue-500">
                        <div class="text-center">
                            <div class="text-4xl mb-4">ü§ñ</div>
                            <h3 class="text-lg font-semibold mb-2 text-gray-900 dark:text-white" data-translate="ai-doubt-clearing">AI Doubt Clearing</h3>
                            <p class="text-gray-600 dark:text-gray-400 text-sm" data-translate="ask-questions-get-explanations">Ask questions and get personalized explanations</p>
                        </div>
                    </div>
                    <div onclick="selectFeature('worksheet')" class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 cursor-pointer hover:shadow-xl transition-shadow border-2 border-transparent">
                        <div class="text-center">
                            <div class="text-4xl mb-4">üìù</div>
                            <h3 class="text-lg font-semibold mb-2 text-gray-900 dark:text-white" data-translate="smart-worksheets">Smart Worksheets</h3>
                            <p class="text-gray-600 dark:text-gray-400 text-sm" data-translate="generate-practice-materials">Generate personalized practice materials</p>
                        </div>
                    </div>
                    <div onclick="selectFeature('session')" class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 cursor-pointer hover:shadow-xl transition-shadow border-2 border-transparent">
                        <div class="text-center">
                            <div class="text-4xl mb-4">üéì</div>
                            <h3 class="text-lg font-semibold mb-2 text-gray-900 dark:text-white" data-translate="learning-sessions">Learning Sessions</h3>
                            <p class="text-gray-600 dark:text-gray-400 text-sm" data-translate="start-ai-powered-lessons">Start AI-powered personalized lessons</p>
                        </div>
                    </div>
                </div>

                <!-- Unique AI Features Row -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div onclick="selectFeature('voice')" class="bg-gradient-to-br from-purple-500 to-pink-500 rounded-lg shadow-lg p-4 cursor-pointer hover:shadow-xl transition-all transform hover:scale-105 text-white">
                        <div class="text-center">
                            <div class="text-3xl mb-2">üé§</div>
                            <h4 class="text-sm font-semibold mb-1" data-translate="voice-learning">Voice Learning</h4>
                            <p class="text-xs opacity-90" data-translate="talk-to-ai-tutor">Talk to AI tutor</p>
                        </div>
                    </div>
                    <div onclick="selectFeature('emotion')" class="bg-gradient-to-br from-green-500 to-teal-500 rounded-lg shadow-lg p-4 cursor-pointer hover:shadow-xl transition-all transform hover:scale-105 text-white">
                        <div class="text-center">
                            <div class="text-3xl mb-2">üòä</div>
                            <h4 class="text-sm font-semibold mb-1" data-translate="emotion-ai">Emotion AI</h4>
                            <p class="text-xs opacity-90" data-translate="mood-based-learning">Mood-based learning</p>
                        </div>
                    </div>
                    <div onclick="selectFeature('gamify')" class="bg-gradient-to-br from-orange-500 to-red-500 rounded-lg shadow-lg p-4 cursor-pointer hover:shadow-xl transition-all transform hover:scale-105 text-white">
                        <div class="text-center">
                            <div class="text-3xl mb-2">üéÆ</div>
                            <h4 class="text-sm font-semibold mb-1" data-translate="ai-games">AI Games</h4>
                            <p class="text-xs opacity-90" data-translate="learn-through-play">Learn through play</p>
                        </div>
                    </div>
                    <div onclick="selectFeature('predict')" class="bg-gradient-to-br from-blue-500 to-indigo-500 rounded-lg shadow-lg p-4 cursor-pointer hover:shadow-xl transition-all transform hover:scale-105 text-white">
                        <div class="text-center">
                            <div class="text-3xl mb-2">üîÆ</div>
                            <h4 class="text-sm font-semibold mb-1" data-translate="future-career">Future Predictor</h4>
                            <p class="text-xs opacity-90" data-translate="career-guidance-ai">Career guidance AI</p>
                        </div>
                    </div>
                </div>

                <!-- AI Features Interface -->
                <div id="ai-features-interface" class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                    <!-- AI Doubt Clearing -->
                    <div id="doubt-interface" class="feature-interface">
                        <div class="flex items-center mb-6">
                            <span class="text-2xl mr-2">ü§ñ</span>
                            <h3 class="text-lg font-semibold">AI Doubt Clearing</h3>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="text-md font-medium mb-4">Ask Your Question</h4>
                                <div class="space-y-4">
                                    <div class="grid grid-cols-2 gap-4">
                                        <select class="border border-gray-300 rounded-lg px-3 py-2">
                                            <option>Mathematics</option>
                                            <option>Science</option>
                                            <option>English</option>
                                            <option>History</option>
                                        </select>
                                        <input type="text" placeholder="Topic (e.g., Algebra)" class="border border-gray-300 rounded-lg px-3 py-2">
                                    </div>
                                    <textarea placeholder="Type your question here... The AI will provide a personalized explanation!"
                                             class="w-full border border-gray-300 rounded-lg px-3 py-2 h-24 resize-none"></textarea>
                                    <button onclick="askAIQuestion()" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-3 px-4 rounded-lg transition-colors">
                                        ü§ñ Ask AI Tutor
                                    </button>
                                </div>
                            </div>

                            <div id="ai-response" class="bg-blue-50 rounded-lg p-4">
                                <h4 class="text-md font-medium mb-3">ü§ñ AI Response</h4>
                                <div class="text-gray-600 text-center py-8">
                                    <div class="text-4xl mb-4">ü§ñ</div>
                                    <p>AI Tutor Ready</p>
                                    <p class="text-sm mt-2">Ask any question and get a personalized explanation adapted to your learning level and style.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Worksheet Generator -->
                    <div id="worksheet-interface" class="feature-interface hidden">
                        <div class="flex items-center mb-6">
                            <span class="text-2xl mr-2">üìù</span>
                            <h3 class="text-lg font-semibold">AI Worksheet Generator</h3>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- Left Column - Controls -->
                            <div class="bg-white rounded-lg shadow-sm border p-6">
                                <h4 class="text-md font-medium mb-4 text-gray-800">Customize Your Worksheet</h4>
                                <div class="space-y-4">
                                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Subject</label>
                                            <select id="worksheet-subject" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                                <option value="mathematics">Mathematics</option>
                                                <option value="science" selected>Science</option>
                                                <option value="english">English</option>
                                                <option value="history">History</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Difficulty</label>
                                            <select id="worksheet-difficulty" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                                <option value="easy">Easy (60-70%)</option>
                                                <option value="medium" selected>Medium (70-80%)</option>
                                                <option value="hard">Hard (80-90%)</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Topic (Optional)</label>
                                        <input id="worksheet-topic" type="text" placeholder="e.g., Algebra, Fractions, Cell Structure" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                    </div>
                                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Questions</label>
                                            <select id="worksheet-questions" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                                <option value="5">5 Questions</option>
                                                <option value="10" selected>10 Questions</option>
                                                <option value="15">15 Questions</option>
                                                <option value="20">20 Questions</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Type</label>
                                            <select id="worksheet-type" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                                <option value="mixed" selected>Mixed Types</option>
                                                <option value="mcq">Multiple Choice</option>
                                                <option value="short">Short Answer</option>
                                                <option value="long">Long Answer</option>
                                            </select>
                                        </div>
                                    </div>
                                    <button onclick="generateAIWorksheet()" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 px-4 rounded-lg transition-colors font-medium">
                                        üìù Generate AI Worksheet
                                    </button>
                                </div>
                            </div>

                            <!-- Right Column - Preview -->
                            <div id="worksheet-preview" class="bg-green-50 rounded-lg border border-green-200 p-6 min-h-[400px]">
                                <h4 class="text-md font-medium mb-3 text-gray-800">üìù Generated Worksheet</h4>
                                <div class="text-gray-600 text-center py-12">
                                    <div class="text-4xl mb-4">üìù</div>
                                    <p class="text-lg font-medium mb-2">AI Worksheet Generator Ready</p>
                                    <p class="text-sm">Select your preferences and click "Generate AI Worksheet" to create a personalized worksheet adapted to your performance level.</p>
                                    <div class="mt-4 text-xs text-gray-500">
                                        ‚ú® Powered by AI ‚Ä¢ üéØ Personalized ‚Ä¢ üìä Performance-based
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Learning Session -->
                    <div id="session-interface" class="feature-interface hidden">
                        <div class="flex items-center mb-6">
                            <span class="text-2xl mr-2">üéì</span>
                            <h3 class="text-lg font-semibold">AI Learning Session</h3>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="text-md font-medium mb-4">Start Your Learning Session</h4>
                                <div class="space-y-4">
                                    <select id="session-subject" class="w-full border border-gray-300 rounded-lg px-3 py-2">
                                        <option value="mathematics">Mathematics (Your Strength! 85%)</option>
                                        <option value="science">Science (Good Progress! 78%)</option>
                                        <option value="english" selected>English (Focus Area - 65%)</option>
                                        <option value="history">History (Focus Area)</option>
                                    </select>
                                    <select id="session-duration" class="w-full border border-gray-300 rounded-lg px-3 py-2">
                                        <option value="15">15 minutes</option>
                                        <option value="30" selected>30 minutes</option>
                                        <option value="45">45 minutes</option>
                                        <option value="60">1 hour</option>
                                    </select>
                                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                                        <p class="text-blue-800 text-sm">
                                            <strong>AI Recommendation:</strong> Based on your visual learning style and 65% English performance, I suggest starting with Grammar Basics using visual examples.
                                        </p>
                                    </div>
                                    <button onclick="startAISession()" class="w-full bg-purple-500 hover:bg-purple-600 text-white py-3 px-4 rounded-lg transition-colors">
                                        üéì Start AI Learning Session
                                    </button>
                                </div>
                            </div>

                            <div id="session-preview" class="bg-purple-50 rounded-lg p-4">
                                <h4 class="text-md font-medium mb-3">üéì Session Preview</h4>
                                <div class="text-gray-600 text-center py-8">
                                    <div class="text-4xl mb-4">üéì</div>
                                    <p>AI Learning Session Ready</p>
                                    <p class="text-sm mt-2">Start a personalized learning session adapted to your visual learning style and current performance level.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Voice Learning Interface -->
                    <div id="voice-interface" class="feature-interface hidden">
                        <div class="bg-gradient-to-br from-purple-500 to-pink-500 rounded-lg shadow-lg text-white p-6 mb-6">
                            <h3 class="text-xl font-bold mb-4">üé§ Voice Learning Assistant</h3>
                            <p class="text-purple-100">Speak naturally with your AI tutor. Ask questions, practice pronunciation, or have conversations in any subject!</p>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-white rounded-lg shadow-lg p-6">
                                <h4 class="text-lg font-semibold mb-4 flex items-center">
                                    <span class="text-2xl mr-2">üó£Ô∏è</span>
                                    Voice Chat
                                </h4>

                                <div class="mb-4">
                                    <div class="bg-gray-100 rounded-lg p-4 mb-4 min-h-32">
                                        <div id="voice-conversation" class="space-y-3">
                                            <div class="flex items-start">
                                                <div class="bg-purple-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm mr-3">AI</div>
                                                <div class="bg-purple-50 rounded-lg p-3 flex-1">
                                                    <p class="text-sm">Hello Priya! I'm your voice tutor. What would you like to learn today? You can ask me anything about Mathematics, Science, English, or History!</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="flex space-x-2">
                                        <button id="voice-record-btn" onclick="toggleVoiceRecording()" class="flex-1 bg-purple-500 text-white py-3 px-4 rounded-lg hover:bg-purple-600 transition-colors">
                                            <span id="voice-btn-text">üé§ Start Speaking</span>
                                        </button>
                                        <button onclick="clearVoiceChat()" class="bg-gray-300 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-400">üóëÔ∏è</button>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-white rounded-lg shadow-lg p-6">
                                <h4 class="text-lg font-semibold mb-4 flex items-center">
                                    <span class="text-2xl mr-2">üéØ</span>
                                    Voice Features
                                </h4>

                                <div class="space-y-4">
                                    <div class="bg-blue-50 p-4 rounded-lg">
                                        <h5 class="font-medium text-blue-800 mb-2">üìö Subject Practice</h5>
                                        <p class="text-sm text-blue-700">Practice speaking about any subject. AI will correct pronunciation and provide feedback.</p>
                                        <button onclick="startSubjectPractice()" class="mt-2 bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600" data-translate="start-practice">Start Practice</button>
                                    </div>

                                    <div class="bg-green-50 p-4 rounded-lg">
                                        <h5 class="font-medium text-green-800 mb-2">üåç Language Learning</h5>
                                        <p class="text-sm text-green-700">Practice English pronunciation with real-time feedback and accent training.</p>
                                        <button onclick="startLanguagePractice()" class="mt-2 bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600" data-translate="start-english">Start English</button>
                                    </div>

                                    <div class="bg-orange-50 p-4 rounded-lg">
                                        <h5 class="font-medium text-orange-800 mb-2">üé≠ Story Mode</h5>
                                        <p class="text-sm text-orange-700">Learn through interactive storytelling. AI creates stories based on your curriculum.</p>
                                        <button onclick="startStoryMode()" class="mt-2 bg-orange-500 text-white px-3 py-1 rounded text-sm hover:bg-orange-600" data-translate="tell-story">Tell Story</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Emotion AI Interface -->
                    <div id="emotion-interface" class="feature-interface hidden">
                        <div class="bg-gradient-to-br from-green-500 to-teal-500 rounded-lg shadow-lg text-white p-6 mb-6">
                            <h3 class="text-xl font-bold mb-4">üòä Emotion-Aware Learning</h3>
                            <p class="text-green-100">AI that understands your mood and adapts learning accordingly. Better mood = better learning!</p>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="bg-white rounded-lg shadow-lg p-6">
                                <h4 class="text-lg font-semibold mb-4 flex items-center">
                                    <span class="text-2xl mr-2">üé≠</span>
                                    Mood Detector
                                </h4>

                                <div class="text-center mb-4">
                                    <div class="w-24 h-24 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full flex items-center justify-center text-4xl mx-auto mb-3">
                                        <span id="current-mood">üòä</span>
                                    </div>
                                    <p class="text-sm text-gray-600 mb-2">Current Mood</p>
                                    <p id="mood-status" class="font-medium text-green-600">Happy & Ready to Learn!</p>
                                </div>

                                <button onclick="detectMood()" class="w-full bg-green-500 text-white py-2 px-4 rounded-lg hover:bg-green-600 mb-2" data-translate="detect-mood">üîç Detect My Mood</button>
                                <button onclick="moodBooster()" class="w-full bg-yellow-500 text-white py-2 px-4 rounded-lg hover:bg-yellow-600" data-translate="mood-booster">‚ö° Mood Booster</button>
                            </div>

                            <div class="bg-white rounded-lg shadow-lg p-6">
                                <h4 class="text-lg font-semibold mb-4 flex items-center">
                                    <span class="text-2xl mr-2">üé®</span>
                                    Adaptive Content
                                </h4>

                                <div class="space-y-3">
                                    <div class="bg-blue-50 p-3 rounded-lg">
                                        <div class="flex justify-between items-center">
                                            <span class="text-sm font-medium">Learning Style</span>
                                            <span class="text-xs bg-blue-500 text-white px-2 py-1 rounded">Visual</span>
                                        </div>
                                    </div>

                                    <div class="bg-green-50 p-3 rounded-lg">
                                        <div class="flex justify-between items-center">
                                            <span class="text-sm font-medium">Energy Level</span>
                                            <span class="text-xs bg-green-500 text-white px-2 py-1 rounded">High</span>
                                        </div>
                                    </div>

                                    <div class="bg-purple-50 p-3 rounded-lg">
                                        <div class="flex justify-between items-center">
                                            <span class="text-sm font-medium">Focus Mode</span>
                                            <span class="text-xs bg-purple-500 text-white px-2 py-1 rounded">Active</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="mt-4">
                                    <p class="text-sm text-gray-600 mb-2">AI Recommendation:</p>
                                    <p class="text-sm bg-yellow-50 p-2 rounded border-l-4 border-yellow-500">
                                        You're in a great mood for challenging problems! Let's try some advanced Mathematics today.
                                    </p>
                                </div>
                            </div>

                            <div class="bg-white rounded-lg shadow-lg p-6">
                                <h4 class="text-lg font-semibold mb-4 flex items-center">
                                    <span class="text-2xl mr-2">üíù</span>
                                    Wellness Tools
                                </h4>

                                <div class="space-y-3">
                                    <button onclick="startBreathingExercise()" class="w-full bg-blue-500 text-white py-2 px-3 rounded-lg hover:bg-blue-600 text-sm">
                                        ü´Å Breathing Exercise
                                    </button>

                                    <button onclick="startMotivation()" class="w-full bg-purple-500 text-white py-2 px-3 rounded-lg hover:bg-purple-600 text-sm">
                                        ‚≠ê Daily Motivation
                                    </button>

                                    <button onclick="startMindfulness()" class="w-full bg-green-500 text-white py-2 px-3 rounded-lg hover:bg-green-600 text-sm">
                                        üßò Mindfulness Break
                                    </button>

                                    <button onclick="celebrateAchievement()" class="w-full bg-yellow-500 text-white py-2 px-3 rounded-lg hover:bg-yellow-600 text-sm">
                                        üéâ Celebrate Success
                                    </button>
                                </div>

                                <div class="mt-4 p-3 bg-gradient-to-r from-pink-50 to-purple-50 rounded-lg">
                                    <p class="text-xs text-center text-gray-600">
                                        üí° <strong>Tip:</strong> Taking breaks improves learning by 40%!
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- AI Games Interface -->
                    <div id="gamify-interface" class="feature-interface hidden">
                        <div class="bg-gradient-to-br from-orange-500 to-red-500 rounded-lg shadow-lg text-white p-6 mb-6">
                            <h3 class="text-xl font-bold mb-4">üéÆ AI Learning Games</h3>
                            <p class="text-orange-100">Transform learning into an adventure! Play AI-powered educational games that adapt to your level.</p>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div class="bg-white rounded-lg shadow-lg p-6">
                                <h4 class="text-lg font-semibold mb-4 flex items-center">
                                    <span class="text-2xl mr-2">üèÜ</span>
                                    Your Gaming Stats
                                </h4>

                                <div class="space-y-3">
                                    <div class="flex justify-between items-center p-3 bg-yellow-50 rounded-lg">
                                        <span class="text-sm font-medium">Level</span>
                                        <span class="text-lg font-bold text-yellow-600">Level 8</span>
                                    </div>
                                    <div class="flex justify-between items-center p-3 bg-blue-50 rounded-lg">
                                        <span class="text-sm font-medium">XP Points</span>
                                        <span class="text-lg font-bold text-blue-600">2,450 XP</span>
                                    </div>
                                    <div class="flex justify-between items-center p-3 bg-green-50 rounded-lg">
                                        <span class="text-sm font-medium">Achievements</span>
                                        <span class="text-lg font-bold text-green-600">12 üèÖ</span>
                                    </div>
                                    <div class="flex justify-between items-center p-3 bg-purple-50 rounded-lg">
                                        <span class="text-sm font-medium">Streak</span>
                                        <span class="text-lg font-bold text-purple-600">6 days üî•</span>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-white rounded-lg shadow-lg p-6">
                                <h4 class="text-lg font-semibold mb-4 flex items-center">
                                    <span class="text-2xl mr-2">üéØ</span>
                                    Daily Challenges
                                </h4>

                                <div class="space-y-3">
                                    <div class="p-3 bg-green-50 rounded-lg border-l-4 border-green-500">
                                        <div class="flex justify-between items-center">
                                            <span class="text-sm font-medium">Math Quiz Master</span>
                                            <span class="text-xs bg-green-500 text-white px-2 py-1 rounded">‚úÖ Complete</span>
                                        </div>
                                        <p class="text-xs text-green-700 mt-1">+50 XP earned!</p>
                                    </div>

                                    <div class="p-3 bg-blue-50 rounded-lg border-l-4 border-blue-500">
                                        <div class="flex justify-between items-center">
                                            <span class="text-sm font-medium">Science Explorer</span>
                                            <span class="text-xs bg-blue-500 text-white px-2 py-1 rounded">üéØ Active</span>
                                        </div>
                                        <p class="text-xs text-blue-700 mt-1">Progress: 3/5 questions</p>
                                    </div>

                                    <div class="p-3 bg-gray-50 rounded-lg border-l-4 border-gray-300">
                                        <div class="flex justify-between items-center">
                                            <span class="text-sm font-medium">English Word Hunt</span>
                                            <span class="text-xs bg-gray-500 text-white px-2 py-1 rounded">‚è≥ Pending</span>
                                        </div>
                                        <p class="text-xs text-gray-600 mt-1">Unlock at Level 9</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="bg-white rounded-lg shadow-lg p-4 hover:shadow-xl transition-shadow cursor-pointer" onclick="startMathGame()">
                                <div class="text-center">
                                    <div class="text-4xl mb-3">üßÆ</div>
                                    <h5 class="font-semibold mb-2">Math Adventure</h5>
                                    <p class="text-sm text-gray-600 mb-3">Solve equations to save the kingdom!</p>
                                    <div class="flex justify-between text-xs">
                                        <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded">Easy</span>
                                        <span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded">+30 XP</span>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-white rounded-lg shadow-lg p-4 hover:shadow-xl transition-shadow cursor-pointer" onclick="startScienceGame()">
                                <div class="text-center">
                                    <div class="text-4xl mb-3">üî¨</div>
                                    <h5 class="font-semibold mb-2">Lab Detective</h5>
                                    <p class="text-sm text-gray-600 mb-3">Conduct experiments and solve mysteries!</p>
                                    <div class="flex justify-between text-xs">
                                        <span class="bg-green-100 text-green-800 px-2 py-1 rounded">Medium</span>
                                        <span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded">+50 XP</span>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-white rounded-lg shadow-lg p-4 hover:shadow-xl transition-shadow cursor-pointer" onclick="startEnglishGame()">
                                <div class="text-center">
                                    <div class="text-4xl mb-3">üìö</div>
                                    <h5 class="font-semibold mb-2">Word Wizard</h5>
                                    <p class="text-sm text-gray-600 mb-3">Build vocabulary through magical quests!</p>
                                    <div class="flex justify-between text-xs">
                                        <span class="bg-orange-100 text-orange-800 px-2 py-1 rounded">Hard</span>
                                        <span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded">+70 XP</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Future Predictor Interface -->
                    <div id="predict-interface" class="feature-interface hidden">
                        <div class="bg-gradient-to-br from-blue-500 to-indigo-500 rounded-lg shadow-lg text-white p-6 mb-6">
                            <h3 class="text-xl font-bold mb-4">üîÆ AI Career Predictor</h3>
                            <p class="text-blue-100">Discover your future career paths based on your learning patterns, interests, and academic performance!</p>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div class="bg-white rounded-lg shadow-lg p-6">
                                <h4 class="text-lg font-semibold mb-4 flex items-center">
                                    <span class="text-2xl mr-2">üéØ</span>
                                    Career Predictions
                                </h4>

                                <div class="space-y-4">
                                    <div class="p-4 bg-gradient-to-r from-green-50 to-blue-50 rounded-lg border-l-4 border-green-500">
                                        <div class="flex justify-between items-center mb-2">
                                            <h5 class="font-semibold text-green-800">Data Scientist</h5>
                                            <span class="bg-green-500 text-white px-2 py-1 rounded text-xs">92% Match</span>
                                        </div>
                                        <p class="text-sm text-gray-600 mb-2">Perfect fit based on your Mathematics excellence and analytical thinking!</p>
                                        <div class="flex space-x-2">
                                            <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">High Salary</span>
                                            <span class="bg-purple-100 text-purple-800 px-2 py-1 rounded text-xs">Growing Field</span>
                                        </div>
                                    </div>

                                    <div class="p-4 bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg border-l-4 border-purple-500">
                                        <div class="flex justify-between items-center mb-2">
                                            <h5 class="font-semibold text-purple-800">Software Engineer</h5>
                                            <span class="bg-purple-500 text-white px-2 py-1 rounded text-xs">88% Match</span>
                                        </div>
                                        <p class="text-sm text-gray-600 mb-2">Your logical thinking and problem-solving skills are ideal for coding!</p>
                                        <div class="flex space-x-2">
                                            <span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">Remote Work</span>
                                            <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">Creative</span>
                                        </div>
                                    </div>

                                    <div class="p-4 bg-gradient-to-r from-orange-50 to-yellow-50 rounded-lg border-l-4 border-orange-500">
                                        <div class="flex justify-between items-center mb-2">
                                            <h5 class="font-semibold text-orange-800">Research Scientist</h5>
                                            <span class="bg-orange-500 text-white px-2 py-1 rounded text-xs">85% Match</span>
                                        </div>
                                        <p class="text-sm text-gray-600 mb-2">Your curiosity and Science performance suggest research potential!</p>
                                        <div class="flex space-x-2">
                                            <span class="bg-indigo-100 text-indigo-800 px-2 py-1 rounded text-xs">Innovation</span>
                                            <span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">Impact</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-white rounded-lg shadow-lg p-6">
                                <h4 class="text-lg font-semibold mb-4 flex items-center">
                                    <span class="text-2xl mr-2">üìä</span>
                                    Skills Analysis
                                </h4>

                                <div class="space-y-4">
                                    <div>
                                        <div class="flex justify-between mb-1">
                                            <span class="text-sm font-medium">Analytical Thinking</span>
                                            <span class="text-sm text-green-600">95%</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-2">
                                            <div class="bg-green-500 h-2 rounded-full" style="width: 95%"></div>
                                        </div>
                                    </div>

                                    <div>
                                        <div class="flex justify-between mb-1">
                                            <span class="text-sm font-medium">Problem Solving</span>
                                            <span class="text-sm text-blue-600">90%</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-2">
                                            <div class="bg-blue-500 h-2 rounded-full" style="width: 90%"></div>
                                        </div>
                                    </div>

                                    <div>
                                        <div class="flex justify-between mb-1">
                                            <span class="text-sm font-medium">Creativity</span>
                                            <span class="text-sm text-purple-600">78%</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-2">
                                            <div class="bg-purple-500 h-2 rounded-full" style="width: 78%"></div>
                                        </div>
                                    </div>

                                    <div>
                                        <div class="flex justify-between mb-1">
                                            <span class="text-sm font-medium">Communication</span>
                                            <span class="text-sm text-orange-600">65%</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-2">
                                            <div class="bg-orange-500 h-2 rounded-full" style="width: 65%"></div>
                                        </div>
                                    </div>

                                    <div>
                                        <div class="flex justify-between mb-1">
                                            <span class="text-sm font-medium">Leadership</span>
                                            <span class="text-sm text-red-600">60%</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-2">
                                            <div class="bg-red-500 h-2 rounded-full" style="width: 60%"></div>
                                        </div>
                                    </div>
                                </div>

                                <div class="mt-4 p-3 bg-blue-50 rounded-lg">
                                    <p class="text-sm text-blue-800">
                                        <strong>üí° AI Suggestion:</strong> Focus on improving Communication and Leadership skills to unlock more career opportunities!
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-lg shadow-lg p-6">
                            <h4 class="text-lg font-semibold mb-4 flex items-center">
                                <span class="text-2xl mr-2">üõ§Ô∏è</span>
                                Recommended Learning Path
                            </h4>

                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <div class="text-center p-4 bg-gradient-to-b from-blue-50 to-blue-100 rounded-lg">
                                    <div class="text-2xl mb-2">üìö</div>
                                    <h5 class="font-semibold text-blue-800 mb-1">Grade 9-10</h5>
                                    <p class="text-xs text-blue-600">Focus on Math & Science</p>
                                </div>

                                <div class="text-center p-4 bg-gradient-to-b from-green-50 to-green-100 rounded-lg">
                                    <div class="text-2xl mb-2">üéì</div>
                                    <h5 class="font-semibold text-green-800 mb-1">Grade 11-12</h5>
                                    <p class="text-xs text-green-600">PCM Stream + Coding</p>
                                </div>

                                <div class="text-center p-4 bg-gradient-to-b from-purple-50 to-purple-100 rounded-lg">
                                    <div class="text-2xl mb-2">üèõÔ∏è</div>
                                    <h5 class="font-semibold text-purple-800 mb-1">College</h5>
                                    <p class="text-xs text-purple-600">Computer Science/Data Science</p>
                                </div>

                                <div class="text-center p-4 bg-gradient-to-b from-yellow-50 to-yellow-100 rounded-lg">
                                    <div class="text-2xl mb-2">üíº</div>
                                    <h5 class="font-semibold text-yellow-800 mb-1">Career</h5>
                                    <p class="text-xs text-yellow-600">Tech Industry Leader</p>
                                </div>
                            </div>

                            <div class="text-center mt-4">
                                <button onclick="generateCareerPlan()" class="bg-indigo-500 text-white px-6 py-2 rounded-lg hover:bg-indigo-600">
                                    üìã Generate Detailed Career Plan
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Report Card -->
            <div id="content-3" class="tab-content hidden">
                <!-- Report Card Header -->
                <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg shadow-lg p-6 mb-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <h2 class="text-2xl font-bold mb-2">üìä Student Report Card</h2>
                            <p class="text-blue-100">Comprehensive learning progress report for parents</p>
                        </div>
                        <div class="text-right">
                            <div class="text-sm text-blue-100">Generated on</div>
                            <div class="text-lg font-semibold" id="report-date"></div>
                        </div>
                    </div>
                </div>

                <!-- Student Selection for Report -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">üë§ Select Student for Report</h3>
                        <div class="flex items-center space-x-3">
                            <select id="report-student-selector" onchange="generateReportCard(this.value)" class="border border-gray-300 rounded-lg px-3 py-2">
                                <option value="">Select a student...</option>
                            </select>
                            <button onclick="downloadReportCard()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 flex items-center space-x-2">
                                <span>üì•</span>
                                <span>Download PDF</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Report Card Content -->
                <div id="report-card-content" class="hidden">
                    <!-- Student Information Card -->
                    <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                        <div class="flex items-center space-x-4 mb-6">
                            <div class="w-16 h-16 bg-blue-500 rounded-full flex items-center justify-center text-white text-2xl font-bold" id="report-student-avatar">
                                P
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-gray-900" id="report-student-name">Student Name</h3>
                                <p class="text-gray-600" id="report-student-details">Grade ‚Ä¢ Learning Style</p>
                                <p class="text-sm text-gray-500" id="report-student-id">Student ID</p>
                            </div>
                            <div class="ml-auto text-right">
                                <div class="text-3xl font-bold text-blue-600" id="report-overall-grade">A</div>
                                <div class="text-sm text-gray-500">Overall Grade</div>
                            </div>
                        </div>

                        <!-- Overall Performance Summary -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                            <div class="bg-green-50 p-4 rounded-lg text-center">
                                <div class="text-2xl font-bold text-green-600" id="report-performance">76%</div>
                                <div class="text-sm text-green-700">Overall Performance</div>
                            </div>
                            <div class="bg-blue-50 p-4 rounded-lg text-center">
                                <div class="text-2xl font-bold text-blue-600" id="report-attendance">95%</div>
                                <div class="text-sm text-blue-700">Attendance Rate</div>
                            </div>
                            <div class="bg-purple-50 p-4 rounded-lg text-center">
                                <div class="text-2xl font-bold text-purple-600" id="report-assignments">12</div>
                                <div class="text-sm text-purple-700">Assignments Completed</div>
                            </div>
                            <div class="bg-orange-50 p-4 rounded-lg text-center">
                                <div class="text-2xl font-bold text-orange-600" id="report-improvement">+8%</div>
                                <div class="text-sm text-orange-700">Improvement This Month</div>
                            </div>
                        </div>
                    </div>

                    <!-- Subject-wise Performance -->
                    <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                        <h4 class="text-lg font-semibold text-gray-900 mb-4">üìö Subject-wise Performance</h4>
                        <div class="space-y-4" id="subject-performance">
                            <!-- Subject performance will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Learning Analytics -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <!-- Strengths and Weaknesses -->
                        <div class="bg-white rounded-lg shadow-lg p-6">
                            <h4 class="text-lg font-semibold text-gray-900 mb-4">üí™ Strengths & Areas for Improvement</h4>
                            <div class="space-y-4">
                                <div>
                                    <h5 class="font-medium text-green-700 mb-2">‚úÖ Strengths</h5>
                                    <div class="flex flex-wrap gap-2" id="report-strengths">
                                        <!-- Strengths will be populated by JavaScript -->
                                    </div>
                                </div>
                                <div>
                                    <h5 class="font-medium text-orange-700 mb-2">üéØ Focus Areas</h5>
                                    <div class="flex flex-wrap gap-2" id="report-weaknesses">
                                        <!-- Weaknesses will be populated by JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Learning Style & Recommendations -->
                        <div class="bg-white rounded-lg shadow-lg p-6">
                            <h4 class="text-lg font-semibold text-gray-900 mb-4">üéØ Learning Insights</h4>
                            <div class="space-y-4">
                                <div>
                                    <h5 class="font-medium text-blue-700 mb-2">Learning Style</h5>
                                    <div class="bg-blue-50 p-3 rounded-lg">
                                        <span class="text-blue-800 font-medium" id="report-learning-style">Visual Learner</span>
                                        <p class="text-sm text-blue-600 mt-1" id="report-learning-description">Learns best through visual aids, diagrams, and charts</p>
                                    </div>
                                </div>
                                <div>
                                    <h5 class="font-medium text-purple-700 mb-2">AI Recommendations</h5>
                                    <div class="space-y-2" id="report-recommendations">
                                        <!-- Recommendations will be populated by JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activities -->
                    <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                        <h4 class="text-lg font-semibold text-gray-900 mb-4">üìÖ Recent Learning Activities</h4>
                        <div class="space-y-3" id="recent-activities">
                            <!-- Recent activities will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Parent Guidance Section -->
                    <div class="bg-gradient-to-r from-green-50 to-blue-50 rounded-lg p-6 mb-6">
                        <h4 class="text-lg font-semibold text-gray-900 mb-4">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Guidance for Parents</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h5 class="font-medium text-green-700 mb-2">üè† How to Help at Home</h5>
                                <ul class="space-y-2 text-sm text-gray-700" id="home-guidance">
                                    <!-- Home guidance will be populated by JavaScript -->
                                </ul>
                            </div>
                            <div>
                                <h5 class="font-medium text-blue-700 mb-2">üìà Next Steps</h5>
                                <ul class="space-y-2 text-sm text-gray-700" id="next-steps">
                                    <!-- Next steps will be populated by JavaScript -->
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Teacher's Comments -->
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h4 class="text-lg font-semibold text-gray-900 mb-4">üí¨ Teacher's Comments</h4>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p class="text-gray-700 italic" id="teacher-comments">
                                "This student shows excellent progress in mathematics and science. Recommend focusing on reading comprehension and writing skills for balanced development."
                            </p>
                            <div class="mt-3 text-right">
                                <span class="text-sm text-gray-500">- AI Education System</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- No Student Selected Message -->
                <div id="no-student-selected" class="text-center py-12">
                    <div class="text-6xl mb-4">üìä</div>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">Select a Student</h3>
                    <p class="text-gray-500">Choose a student from the dropdown above to generate their report card</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Floating AI Button -->
    <button onclick="showTab(2)" class="fixed bottom-6 right-6 bg-gradient-to-r from-purple-500 to-purple-600 text-white p-4 rounded-full shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200" title="AI Features">
        <span class="text-2xl">ü§ñ</span>
    </button>

    <script>
        let currentTab = 0;

        // Theme Management
        function initializeTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            const html = document.documentElement;
            const themeIcon = document.getElementById('theme-icon');

            if (savedTheme === 'dark') {
                html.classList.add('dark');
                themeIcon.textContent = '‚òÄÔ∏è';
            } else {
                html.classList.remove('dark');
                themeIcon.textContent = 'üåô';
            }
        }

        function initializeLanguage() {
            // Always start with English as default - clear any saved language on first load
            const isFirstLoad = !sessionStorage.getItem('languageInitialized');
            if (isFirstLoad) {
                localStorage.removeItem('selectedLanguage');
                sessionStorage.setItem('languageInitialized', 'true');
            }

            // Always start with English as default
            let selectedLanguage = 'en';

            // Only use saved language if user has explicitly selected one and it's not the first load
            const savedLanguage = localStorage.getItem('selectedLanguage');
            if (savedLanguage && savedLanguage !== 'en' && !isFirstLoad) {
                selectedLanguage = savedLanguage;
            }

            const currentLanguage = document.getElementById('current-language');

            const languageDisplayCodes = {
                'en': 'EN',
                'te': '‡∞§‡±Ü',
                'hi': '‡§π‡§ø'
            };

            if (currentLanguage) {
                currentLanguage.textContent = languageDisplayCodes[selectedLanguage] || 'EN';
            }

            // Apply translations for the selected language
            applyTranslations(selectedLanguage);
        }

        function toggleTheme() {
            const html = document.documentElement;
            const themeIcon = document.getElementById('theme-icon');

            if (html.classList.contains('dark')) {
                html.classList.remove('dark');
                themeIcon.textContent = 'üåô';
                localStorage.setItem('theme', 'light');
            } else {
                html.classList.add('dark');
                themeIcon.textContent = '‚òÄÔ∏è';
                localStorage.setItem('theme', 'dark');
            }
        }

        // Language functionality and translations
        const translations = {
            en: {
                // Header and Navigation
                'ai-education-agent': 'AI Education Agent',
                'smart-learning-platform': 'Smart Learning Platform',
                'smart-learning-platform-govt': 'Smart Learning Platform for Government Schools',
                'choose-role': 'Choose Your Role',
                'student-dashboard': 'Student Dashboard',
                'teacher-dashboard': 'Teacher Dashboard',
                'ai-features': 'AI Features',
                'report-card': 'Report Card',
                'welcome-back': 'Welcome back!',
                'logout': 'Logout',
                'help': 'Help',
                'close': 'Close',
                'cancel': 'Cancel',
                'save': 'Save',
                'add-student': 'Add Student',
                'export-excel': 'Export Excel',
                'view': 'View',
                'edit': 'Edit',
                'remove': 'Remove',
                'start-practice': 'Start Practice',
                'start-english': 'Start English',
                'tell-story': 'Tell Story',
                'detect-mood': 'Detect My Mood',
                'mood-booster': 'Mood Booster',
                'download-pdf': 'Download PDF',
                'print': 'Print',

                // Student Dashboard
                'student-profile': 'Student Profile',
                'current-progress': 'Current Progress',
                'mathematics': 'Mathematics',
                'science': 'Science',
                'english': 'English',
                'social-studies': 'Social Studies',
                'recent-activities': 'Recent Activities',
                'ai-doubt-clearing': 'AI Doubt Clearing',
                'ask-questions-get-explanations': 'Ask questions and get personalized explanations',
                'smart-worksheets': 'Smart Worksheets',
                'generate-practice-materials': 'Generate personalized practice materials',
                'learning-sessions': 'Learning Sessions',
                'start-ai-powered-lessons': 'Start AI-powered personalized lessons',
                'voice-learning': 'Voice Learning',
                'talk-to-ai-tutor': 'Talk to AI tutor',
                'emotion-ai': 'Emotion AI',
                'mood-based-learning': 'Mood-based learning',
                'ai-games': 'AI Games',
                'learn-through-play': 'Learn through play',
                'future-career': 'Future Career',
                'career-guidance-ai': 'Career guidance AI',

                // AI Features
                'ask-your-question': 'Ask Your Question',
                'topic-eg-algebra': 'Topic (e.g., Algebra)',
                'ai-response': 'AI Response',
                'send': 'Send',
                'generate-worksheet': 'Generate Worksheet',
                'start-session': 'Start Session',
                'ask-ai': 'Ask AI',

                // Report Card
                'student-report-card': 'Student Report Card',
                'comprehensive-learning-progress': 'Comprehensive learning progress report for parents',
                'generated-on': 'Generated on',
                'select-student': 'Select Student',
                'generate-report': 'Generate Report',
                'download-report': 'Download Report',
                'no-student-selected-msg': 'Choose a student from the dropdown above to generate their report card',

                // Teacher Dashboard
                'total-students': 'Total Students',
                'avg-performance': 'Avg Performance',
                'active-sessions': 'Active Sessions',
                'worksheets-generated': 'Worksheets Generated',
                'add-student': 'Add Student',
                'export-excel': 'Export Excel',
                'class-overview': 'Class 8 - Student Overview',

                // Common
                'close': 'Close',
                'save': 'Save',
                'cancel': 'Cancel',
                'submit': 'Submit',
                'loading': 'Loading...',
                'success': 'Success',
                'error': 'Error',
                'warning': 'Warning',
                'info': 'Info'
            },
            te: {
                // Header and Navigation
                'ai-education-agent': 'AI ‡∞µ‡∞ø‡∞¶‡±ç‡∞Ø‡∞æ ‡∞è‡∞ú‡±Ü‡∞Ç‡∞ü‡±ç',
                'smart-learning-platform': '‡∞∏‡±ç‡∞Æ‡∞æ‡∞∞‡±ç‡∞ü‡±ç ‡∞≤‡±Ü‡∞∞‡±ç‡∞®‡∞ø‡∞Ç‡∞ó‡±ç ‡∞™‡±ç‡∞≤‡∞æ‡∞ü‡±ç‚Äå‡∞´‡∞æ‡∞∞‡∞Æ‡±ç',
                'smart-learning-platform-govt': '‡∞™‡±ç‡∞∞‡∞≠‡±Å‡∞§‡±ç‡∞µ ‡∞™‡∞æ‡∞†‡∞∂‡∞æ‡∞≤‡∞≤ ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞∏‡±ç‡∞Æ‡∞æ‡∞∞‡±ç‡∞ü‡±ç ‡∞≤‡±Ü‡∞∞‡±ç‡∞®‡∞ø‡∞Ç‡∞ó‡±ç ‡∞™‡±ç‡∞≤‡∞æ‡∞ü‡±ç‚Äå‡∞´‡∞æ‡∞∞‡∞Æ‡±ç',
                'choose-role': '‡∞Æ‡±Ä ‡∞™‡∞æ‡∞§‡±ç‡∞∞‡∞®‡±Å ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø',
                'student-dashboard': '‡∞µ‡∞ø‡∞¶‡±ç‡∞Ø‡∞æ‡∞∞‡±ç‡∞•‡∞ø ‡∞°‡∞æ‡∞∑‡±ç‚Äå‡∞¨‡±ã‡∞∞‡±ç‡∞°‡±ç',
                'teacher-dashboard': '‡∞â‡∞™‡∞æ‡∞ß‡±ç‡∞Ø‡∞æ‡∞Ø ‡∞°‡∞æ‡∞∑‡±ç‚Äå‡∞¨‡±ã‡∞∞‡±ç‡∞°‡±ç',
                'ai-features': 'AI ‡∞´‡±Ä‡∞ö‡∞∞‡±ç‡∞≤‡±Å',
                'report-card': '‡∞∞‡∞ø‡∞™‡±ã‡∞∞‡±ç‡∞ü‡±ç ‡∞ï‡∞æ‡∞∞‡±ç‡∞°‡±ç',
                'welcome-back': '‡∞§‡∞ø‡∞∞‡∞ø‡∞ó‡∞ø ‡∞∏‡±ç‡∞µ‡∞æ‡∞ó‡∞§‡∞Ç!',
                'logout': '‡∞≤‡∞æ‡∞ó‡±ç ‡∞Ö‡∞µ‡±Å‡∞ü‡±ç',
                'help': '‡∞∏‡∞π‡∞æ‡∞Ø‡∞Ç',
                'close': '‡∞Æ‡±Ç‡∞∏‡∞ø‡∞µ‡±á‡∞Ø‡∞ø',
                'cancel': '‡∞∞‡∞¶‡±ç‡∞¶‡±Å ‡∞ö‡±á‡∞Ø‡∞ø',
                'save': '‡∞∏‡±á‡∞µ‡±ç ‡∞ö‡±á‡∞Ø‡∞ø',
                'add-student': '‡∞µ‡∞ø‡∞¶‡±ç‡∞Ø‡∞æ‡∞∞‡±ç‡∞•‡∞ø‡∞®‡∞ø ‡∞ú‡±ã‡∞°‡∞ø‡∞Ç‡∞ö‡±Å',
                'export-excel': '‡∞é‡∞ï‡±ç‡∞∏‡±Ü‡∞≤‡±ç ‡∞é‡∞ï‡±ç‡∞∏‡±ç‚Äå‡∞™‡±ã‡∞∞‡±ç‡∞ü‡±ç',
                'view': '‡∞ö‡±Ç‡∞°‡±Å',
                'edit': '‡∞∏‡∞µ‡∞∞‡∞ø‡∞Ç‡∞ö‡±Å',
                'remove': '‡∞§‡±ä‡∞≤‡∞ó‡∞ø‡∞Ç‡∞ö‡±Å',
                'start-practice': '‡∞Ö‡∞≠‡±ç‡∞Ø‡∞æ‡∞∏‡∞Ç ‡∞™‡±ç‡∞∞‡∞æ‡∞∞‡∞Ç‡∞≠‡∞ø‡∞Ç‡∞ö‡±Å',
                'start-english': '‡∞á‡∞Ç‡∞ó‡±ç‡∞≤‡±Ä‡∞∑‡±ç ‡∞™‡±ç‡∞∞‡∞æ‡∞∞‡∞Ç‡∞≠‡∞ø‡∞Ç‡∞ö‡±Å',
                'tell-story': '‡∞ï‡∞• ‡∞ö‡±Ü‡∞™‡±ç‡∞™‡±Å',
                'detect-mood': '‡∞®‡∞æ ‡∞Æ‡±Ç‡∞°‡±ç ‡∞ó‡±Å‡∞∞‡±ç‡∞§‡∞ø‡∞Ç‡∞ö‡±Å',
                'mood-booster': '‡∞Æ‡±Ç‡∞°‡±ç ‡∞¨‡±Ç‡∞∏‡±ç‡∞ü‡∞∞‡±ç',
                'download-pdf': 'PDF ‡∞°‡±å‡∞®‡±ç‚Äå‡∞≤‡±ã‡∞°‡±ç',
                'print': '‡∞™‡±ç‡∞∞‡∞ø‡∞Ç‡∞ü‡±ç',

                // Student Dashboard
                'student-profile': '‡∞µ‡∞ø‡∞¶‡±ç‡∞Ø‡∞æ‡∞∞‡±ç‡∞•‡∞ø ‡∞™‡±ç‡∞∞‡±ä‡∞´‡±à‡∞≤‡±ç',
                'current-progress': '‡∞™‡±ç‡∞∞‡∞∏‡±ç‡∞§‡±Å‡∞§ ‡∞™‡±Å‡∞∞‡±ã‡∞ó‡∞§‡∞ø',
                'mathematics': '‡∞ó‡∞£‡∞ø‡∞§‡∞Ç',
                'science': '‡∞∏‡±à‡∞®‡±ç‡∞∏‡±ç',
                'english': '‡∞á‡∞Ç‡∞ó‡±ç‡∞≤‡±Ä‡∞∑‡±ç',
                'social-studies': '‡∞∏‡∞æ‡∞Æ‡∞æ‡∞ú‡∞ø‡∞ï ‡∞Ö‡∞ß‡±ç‡∞Ø‡∞Ø‡∞®‡∞æ‡∞≤‡±Å',
                'recent-activities': '‡∞á‡∞ü‡±Ä‡∞µ‡∞≤‡∞ø ‡∞ï‡∞æ‡∞∞‡±ç‡∞Ø‡∞ï‡∞≤‡∞æ‡∞™‡∞æ‡∞≤‡±Å',
                'ai-doubt-clearing': 'AI ‡∞∏‡∞Ç‡∞¶‡±á‡∞π ‡∞®‡∞ø‡∞µ‡±É‡∞§‡±ç‡∞§‡∞ø',
                'ask-questions-get-explanations': '‡∞™‡±ç‡∞∞‡∞∂‡±ç‡∞®‡∞≤‡±Å ‡∞Ö‡∞°‡∞ø‡∞ó‡∞ø ‡∞µ‡±ç‡∞Ø‡∞ï‡±ç‡∞§‡∞ø‡∞ó‡∞§ ‡∞µ‡∞ø‡∞µ‡∞∞‡∞£‡∞≤‡±Å ‡∞™‡±ä‡∞Ç‡∞¶‡∞Ç‡∞°‡∞ø',
                'smart-worksheets': '‡∞∏‡±ç‡∞Æ‡∞æ‡∞∞‡±ç‡∞ü‡±ç ‡∞µ‡∞∞‡±ç‡∞ï‡±ç‚Äå‡∞∑‡±Ä‡∞ü‡±ç‡∞≤‡±Å',
                'generate-practice-materials': '‡∞µ‡±ç‡∞Ø‡∞ï‡±ç‡∞§‡∞ø‡∞ó‡∞§ ‡∞Ö‡∞≠‡±ç‡∞Ø‡∞æ‡∞∏ ‡∞∏‡∞æ‡∞Æ‡∞ó‡±ç‡∞∞‡∞ø‡∞®‡∞ø ‡∞∞‡±Ç‡∞™‡±ä‡∞Ç‡∞¶‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø',
                'learning-sessions': '‡∞≤‡±Ü‡∞∞‡±ç‡∞®‡∞ø‡∞Ç‡∞ó‡±ç ‡∞∏‡±Ü‡∞∑‡∞®‡±ç‡∞≤‡±Å',
                'start-ai-powered-lessons': 'AI-‡∞∂‡∞ï‡±ç‡∞§‡∞ø‡∞§‡±ã ‡∞ï‡±Ç‡∞°‡∞ø‡∞® ‡∞µ‡±ç‡∞Ø‡∞ï‡±ç‡∞§‡∞ø‡∞ó‡∞§ ‡∞™‡∞æ‡∞†‡∞æ‡∞≤‡∞®‡±Å ‡∞™‡±ç‡∞∞‡∞æ‡∞∞‡∞Ç‡∞≠‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø',
                'voice-learning': '‡∞µ‡∞æ‡∞Ø‡∞ø‡∞∏‡±ç ‡∞≤‡±Ü‡∞∞‡±ç‡∞®‡∞ø‡∞Ç‡∞ó‡±ç',
                'talk-to-ai-tutor': 'AI ‡∞ü‡±ç‡∞Ø‡±Ç‡∞ü‡∞∞‡±ç‚Äå‡∞§‡±ã ‡∞Æ‡∞æ‡∞ü‡±ç‡∞≤‡∞æ‡∞°‡∞Ç‡∞°‡∞ø',
                'emotion-ai': '‡∞é‡∞Æ‡±ã‡∞∑‡∞®‡±ç AI',
                'mood-based-learning': '‡∞Æ‡±Ç‡∞°‡±ç ‡∞Ü‡∞ß‡∞æ‡∞∞‡∞ø‡∞§ ‡∞Ö‡∞≠‡±ç‡∞Ø‡∞æ‡∞∏‡∞Ç',
                'ai-games': 'AI ‡∞ó‡±á‡∞Æ‡±ç‡∞∏‡±ç',
                'learn-through-play': '‡∞Ü‡∞ü ‡∞¶‡±ç‡∞µ‡∞æ‡∞∞‡∞æ ‡∞®‡±á‡∞∞‡±ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø',
                'future-career': '‡∞≠‡∞µ‡∞ø‡∞∑‡±ç‡∞Ø‡∞§‡±ç ‡∞ï‡±Ü‡∞∞‡±Ä‡∞∞‡±ç',
                'career-guidance-ai': '‡∞ï‡±Ü‡∞∞‡±Ä‡∞∞‡±ç ‡∞Æ‡∞æ‡∞∞‡±ç‡∞ó‡∞¶‡∞∞‡±ç‡∞∂‡∞ï‡∞§‡±ç‡∞µ‡∞Ç AI',

                // AI Features
                'ask-your-question': '‡∞Æ‡±Ä ‡∞™‡±ç‡∞∞‡∞∂‡±ç‡∞® ‡∞Ö‡∞°‡∞ó‡∞Ç‡∞°‡∞ø',
                'topic-eg-algebra': '‡∞µ‡∞ø‡∞∑‡∞Ø‡∞Ç (‡∞â‡∞¶‡∞æ., ‡∞¨‡±Ä‡∞ú‡∞ó‡∞£‡∞ø‡∞§‡∞Ç)',
                'ai-response': 'AI ‡∞™‡±ç‡∞∞‡∞§‡∞ø‡∞∏‡±ç‡∞™‡∞Ç‡∞¶‡∞®',
                'send': '‡∞™‡∞Ç‡∞™‡±Å',
                'generate-worksheet': '‡∞µ‡∞∞‡±ç‡∞ï‡±ç‚Äå‡∞∑‡±Ä‡∞ü‡±ç ‡∞∞‡±Ç‡∞™‡±ä‡∞Ç‡∞¶‡∞ø‡∞Ç‡∞ö‡±Å',
                'start-session': '‡∞∏‡±Ü‡∞∑‡∞®‡±ç ‡∞™‡±ç‡∞∞‡∞æ‡∞∞‡∞Ç‡∞≠‡∞ø‡∞Ç‡∞ö‡±Å',
                'ask-ai': 'AI ‡∞®‡∞ø ‡∞Ö‡∞°‡∞ó‡∞Ç‡∞°‡∞ø',

                // Report Card
                'student-report-card': '‡∞µ‡∞ø‡∞¶‡±ç‡∞Ø‡∞æ‡∞∞‡±ç‡∞•‡∞ø ‡∞∞‡∞ø‡∞™‡±ã‡∞∞‡±ç‡∞ü‡±ç ‡∞ï‡∞æ‡∞∞‡±ç‡∞°‡±ç',
                'comprehensive-learning-progress': '‡∞§‡∞≤‡±ç‡∞≤‡∞ø‡∞¶‡∞Ç‡∞°‡±ç‡∞∞‡±Å‡∞≤ ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞∏‡∞Æ‡∞ó‡±ç‡∞∞ ‡∞Ö‡∞≠‡±ç‡∞Ø‡∞æ‡∞∏ ‡∞™‡±Å‡∞∞‡±ã‡∞ó‡∞§‡∞ø ‡∞®‡∞ø‡∞µ‡±á‡∞¶‡∞ø‡∞ï',
                'generated-on': '‡∞∞‡±Ç‡∞™‡±ä‡∞Ç‡∞¶‡∞ø‡∞Ç‡∞ö‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø',
                'select-student': '‡∞µ‡∞ø‡∞¶‡±ç‡∞Ø‡∞æ‡∞∞‡±ç‡∞•‡∞ø‡∞®‡∞ø ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø',
                'generate-report': '‡∞∞‡∞ø‡∞™‡±ã‡∞∞‡±ç‡∞ü‡±ç ‡∞∞‡±Ç‡∞™‡±ä‡∞Ç‡∞¶‡∞ø‡∞Ç‡∞ö‡±Å',
                'download-report': '‡∞∞‡∞ø‡∞™‡±ã‡∞∞‡±ç‡∞ü‡±ç ‡∞°‡±å‡∞®‡±ç‚Äå‡∞≤‡±ã‡∞°‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø',
                'no-student-selected-msg': '‡∞µ‡∞æ‡∞∞‡∞ø ‡∞∞‡∞ø‡∞™‡±ã‡∞∞‡±ç‡∞ü‡±ç ‡∞ï‡∞æ‡∞∞‡±ç‡∞°‡±ç ‡∞∞‡±Ç‡∞™‡±ä‡∞Ç‡∞¶‡∞ø‡∞Ç‡∞ö‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞™‡±à‡∞® ‡∞â‡∞®‡±ç‡∞® ‡∞°‡±ç‡∞∞‡∞æ‡∞™‡±ç‚Äå‡∞°‡±å‡∞®‡±ç ‡∞®‡±Å‡∞Ç‡∞°‡∞ø ‡∞µ‡∞ø‡∞¶‡±ç‡∞Ø‡∞æ‡∞∞‡±ç‡∞•‡∞ø‡∞®‡∞ø ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø',

                // Teacher Dashboard
                'total-students': '‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç ‡∞µ‡∞ø‡∞¶‡±ç‡∞Ø‡∞æ‡∞∞‡±ç‡∞•‡±Å‡∞≤‡±Å',
                'avg-performance': '‡∞∏‡∞ó‡∞ü‡±Å ‡∞™‡∞®‡∞ø‡∞§‡±Ä‡∞∞‡±Å',
                'active-sessions': '‡∞ï‡±ç‡∞∞‡∞ø‡∞Ø‡∞æ‡∞∂‡±Ä‡∞≤ ‡∞∏‡±Ü‡∞∑‡∞®‡±ç‡∞≤‡±Å',
                'worksheets-generated': '‡∞µ‡∞∞‡±ç‡∞ï‡±ç‚Äå‡∞∑‡±Ä‡∞ü‡±ç‡∞≤‡±Å ‡∞∞‡±Ç‡∞™‡±ä‡∞Ç‡∞¶‡∞ø‡∞Ç‡∞ö‡∞¨‡∞°‡±ç‡∞°‡∞æ‡∞Ø‡∞ø',
                'add-student': '‡∞µ‡∞ø‡∞¶‡±ç‡∞Ø‡∞æ‡∞∞‡±ç‡∞•‡∞ø‡∞®‡∞ø ‡∞ú‡±ã‡∞°‡∞ø‡∞Ç‡∞ö‡±Å',
                'export-excel': '‡∞é‡∞ï‡±ç‡∞∏‡±Ü‡∞≤‡±ç ‡∞é‡∞ó‡±Å‡∞Æ‡∞§‡∞ø',
                'class-overview': '‡∞ï‡±ç‡∞≤‡∞æ‡∞∏‡±ç 8 - ‡∞µ‡∞ø‡∞¶‡±ç‡∞Ø‡∞æ‡∞∞‡±ç‡∞•‡±Å‡∞≤ ‡∞Ö‡∞µ‡∞≤‡±ã‡∞ï‡∞®‡∞Ç',

                // Common
                'close': '‡∞Æ‡±Ç‡∞∏‡∞ø‡∞µ‡±á‡∞Ø‡∞ø',
                'save': '‡∞∏‡±á‡∞µ‡±ç ‡∞ö‡±á‡∞Ø‡∞ø',
                'cancel': '‡∞∞‡∞¶‡±ç‡∞¶‡±Å ‡∞ö‡±á‡∞Ø‡∞ø',
                'submit': '‡∞∏‡∞Æ‡∞∞‡±ç‡∞™‡∞ø‡∞Ç‡∞ö‡±Å',
                'loading': '‡∞≤‡±ã‡∞°‡±ç ‡∞Ö‡∞µ‡±Å‡∞§‡±ã‡∞Ç‡∞¶‡∞ø...',
                'success': '‡∞µ‡∞ø‡∞ú‡∞Ø‡∞Ç',
                'error': '‡∞≤‡±ã‡∞™‡∞Ç',
                'warning': '‡∞π‡±Ü‡∞ö‡±ç‡∞ö‡∞∞‡∞ø‡∞ï',
                'info': '‡∞∏‡∞Æ‡∞æ‡∞ö‡∞æ‡∞∞‡∞Ç'
            },
            hi: {
                // Header and Navigation
                'ai-education-agent': 'AI ‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ ‡§è‡§ú‡•á‡§Ç‡§ü',
                'smart-learning-platform': '‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§≤‡§∞‡•ç‡§®‡§ø‡§Ç‡§ó ‡§™‡•ç‡§≤‡•á‡§ü‡§´‡•â‡§∞‡•ç‡§Æ',
                'smart-learning-platform-govt': '‡§∏‡§∞‡§ï‡§æ‡§∞‡•Ä ‡§∏‡•ç‡§ï‡•Ç‡§≤‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§≤‡§∞‡•ç‡§®‡§ø‡§Ç‡§ó ‡§™‡•ç‡§≤‡•á‡§ü‡§´‡•â‡§∞‡•ç‡§Æ',
                'choose-role': '‡§Ö‡§™‡§®‡•Ä ‡§≠‡•Ç‡§Æ‡§ø‡§ï‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç',
                'student-dashboard': '‡§õ‡§æ‡§§‡•ç‡§∞ ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°',
                'teacher-dashboard': '‡§∂‡§ø‡§ï‡•ç‡§∑‡§ï ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°',
                'ai-features': 'AI ‡§´‡•Ä‡§ö‡§∞‡•ç‡§∏',
                'report-card': '‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§ï‡§æ‡§∞‡•ç‡§°',
                'welcome-back': '‡§µ‡§æ‡§™‡§∏ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à!',
                'logout': '‡§≤‡•â‡§ó ‡§Ü‡§â‡§ü',
                'help': '‡§∏‡§π‡§æ‡§Ø‡§§‡§æ',
                'close': '‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç',
                'cancel': '‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç',
                'save': '‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç',
                'add-student': '‡§õ‡§æ‡§§‡•ç‡§∞ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç',
                'export-excel': '‡§è‡§ï‡•ç‡§∏‡•á‡§≤ ‡§è‡§ï‡•ç‡§∏‡§™‡•ã‡§∞‡•ç‡§ü',
                'view': '‡§¶‡•á‡§ñ‡•á‡§Ç',
                'edit': '‡§∏‡§Ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç',
                'remove': '‡§π‡§ü‡§æ‡§è‡§Ç',
                'start-practice': '‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç',
                'start-english': '‡§Ö‡§Ç‡§ó‡•ç‡§∞‡•á‡§ú‡•Ä ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç',
                'tell-story': '‡§ï‡§π‡§æ‡§®‡•Ä ‡§∏‡•Å‡§®‡§æ‡§è‡§Ç',
                'detect-mood': '‡§Æ‡•á‡§∞‡§æ ‡§Æ‡•Ç‡§° ‡§™‡§π‡§ö‡§æ‡§®‡•á‡§Ç',
                'mood-booster': '‡§Æ‡•Ç‡§° ‡§¨‡•Ç‡§∏‡•ç‡§ü‡§∞',
                'download-pdf': 'PDF ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§°',
                'print': '‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü',

                // Student Dashboard
                'student-profile': '‡§õ‡§æ‡§§‡•ç‡§∞ ‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤',
                'current-progress': '‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§™‡•ç‡§∞‡§ó‡§§‡§ø',
                'mathematics': '‡§ó‡§£‡§ø‡§§',
                'science': '‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§®',
                'english': '‡§Ö‡§Ç‡§ó‡•ç‡§∞‡•á‡§ú‡•Ä',
                'social-studies': '‡§∏‡§æ‡§Æ‡§æ‡§ú‡§ø‡§ï ‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§®',
                'recent-activities': '‡§π‡§æ‡§≤ ‡§ï‡•Ä ‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø‡§Ø‡§æ‡§Ç',
                'ai-doubt-clearing': 'AI ‡§∏‡§Ç‡§¶‡•á‡§π ‡§®‡§ø‡§µ‡§æ‡§∞‡§£',
                'ask-questions-get-explanations': '‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§™‡•Ç‡§õ‡•á‡§Ç ‡§î‡§∞ ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü‡•Ä‡§ï‡§∞‡§£ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç',
                'smart-worksheets': '‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§µ‡§∞‡•ç‡§ï‡§∂‡•Ä‡§ü',
                'generate-practice-materials': '‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏ ‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡•Ä ‡§¨‡§®‡§æ‡§è‡§Ç',
                'learning-sessions': '‡§≤‡§∞‡•ç‡§®‡§ø‡§Ç‡§ó ‡§∏‡•á‡§∂‡§®',
                'start-ai-powered-lessons': 'AI-‡§∏‡§Ç‡§ö‡§æ‡§≤‡§ø‡§§ ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§™‡§æ‡§† ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç',
                'voice-learning': '‡§µ‡•â‡§Ø‡§∏ ‡§≤‡§∞‡•ç‡§®‡§ø‡§Ç‡§ó',
                'talk-to-ai-tutor': 'AI ‡§ü‡•ç‡§Ø‡•Ç‡§ü‡§∞ ‡§∏‡•á ‡§¨‡§æ‡§§ ‡§ï‡§∞‡•á‡§Ç',
                'emotion-ai': '‡§á‡§Æ‡•ã‡§∂‡§® AI',
                'mood-based-learning': '‡§Æ‡•Ç‡§°-‡§Ü‡§ß‡§æ‡§∞‡§ø‡§§ ‡§∏‡•Ä‡§ñ‡§®‡§æ',
                'ai-games': 'AI ‡§ó‡•á‡§Æ‡•ç‡§∏',
                'learn-through-play': '‡§ñ‡•á‡§≤ ‡§ï‡•á ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ ‡§∏‡•á ‡§∏‡•Ä‡§ñ‡•á‡§Ç',
                'future-career': '‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø ‡§ï‡§æ ‡§ï‡§∞‡§ø‡§Ø‡§∞',
                'career-guidance-ai': '‡§ï‡§∞‡§ø‡§Ø‡§∞ ‡§Æ‡§æ‡§∞‡•ç‡§ó‡§¶‡§∞‡•ç‡§∂‡§® AI',

                // AI Features
                'ask-your-question': '‡§Ö‡§™‡§®‡§æ ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§™‡•Ç‡§õ‡•á‡§Ç',
                'topic-eg-algebra': '‡§µ‡§ø‡§∑‡§Ø (‡§ú‡•à‡§∏‡•á, ‡§¨‡•Ä‡§ú‡§ó‡§£‡§ø‡§§)',
                'ai-response': 'AI ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ',
                'send': '‡§≠‡•á‡§ú‡•á‡§Ç',
                'generate-worksheet': '‡§µ‡§∞‡•ç‡§ï‡§∂‡•Ä‡§ü ‡§¨‡§®‡§æ‡§è‡§Ç',
                'start-session': '‡§∏‡•á‡§∂‡§® ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç',
                'ask-ai': 'AI ‡§∏‡•á ‡§™‡•Ç‡§õ‡•á‡§Ç',

                // Report Card
                'student-report-card': '‡§õ‡§æ‡§§‡•ç‡§∞ ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§ï‡§æ‡§∞‡•ç‡§°',
                'comprehensive-learning-progress': '‡§Æ‡§æ‡§§‡§æ-‡§™‡§ø‡§§‡§æ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§µ‡•ç‡§Ø‡§æ‡§™‡§ï ‡§∏‡•Ä‡§ñ‡§®‡•á ‡§ï‡•Ä ‡§™‡•ç‡§∞‡§ó‡§§‡§ø ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü',
                'generated-on': '‡§™‡§∞ ‡§¨‡§®‡§æ‡§Ø‡§æ ‡§ó‡§Ø‡§æ',
                'select-student': '‡§õ‡§æ‡§§‡•ç‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç',
                'generate-report': '‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§¨‡§®‡§æ‡§è‡§Ç',
                'download-report': '‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç',
                'no-student-selected-msg': '‡§â‡§®‡§ï‡§æ ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§ï‡§æ‡§∞‡•ç‡§° ‡§¨‡§®‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ä‡§™‡§∞ ‡§ï‡•á ‡§°‡•ç‡§∞‡•â‡§™‡§°‡§æ‡§â‡§® ‡§∏‡•á ‡§è‡§ï ‡§õ‡§æ‡§§‡•ç‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç',

                // Teacher Dashboard
                'total-students': '‡§ï‡•Å‡§≤ ‡§õ‡§æ‡§§‡•ç‡§∞',
                'avg-performance': '‡§î‡§∏‡§§ ‡§™‡•ç‡§∞‡§¶‡§∞‡•ç‡§∂‡§®',
                'active-sessions': '‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø ‡§∏‡•á‡§∂‡§®',
                'worksheets-generated': '‡§µ‡§∞‡•ç‡§ï‡§∂‡•Ä‡§ü ‡§¨‡§®‡§æ‡§à ‡§ó‡§à',
                'add-student': '‡§õ‡§æ‡§§‡•ç‡§∞ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç',
                'export-excel': '‡§è‡§ï‡•ç‡§∏‡•á‡§≤ ‡§®‡§ø‡§∞‡•ç‡§Ø‡§æ‡§§',
                'class-overview': '‡§ï‡§ï‡•ç‡§∑‡§æ 8 - ‡§õ‡§æ‡§§‡•ç‡§∞ ‡§Ö‡§µ‡§≤‡•ã‡§ï‡§®',

                // Common
                'close': '‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç',
                'save': '‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç',
                'cancel': '‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç',
                'submit': '‡§ú‡§Æ‡§æ ‡§ï‡§∞‡•á‡§Ç',
                'loading': '‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...',
                'success': '‡§∏‡§´‡§≤‡§§‡§æ',
                'error': '‡§§‡•ç‡§∞‡•Å‡§ü‡§ø',
                'warning': '‡§ö‡•á‡§§‡§æ‡§µ‡§®‡•Ä',
                'info': '‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä'
            }
        };

        function toggleLanguageDropdown() {
            const dropdown = document.getElementById('language-dropdown');
            dropdown.classList.toggle('hidden');
        }

        function changeLanguage(langCode, displayCode) {
            const currentLanguage = document.getElementById('current-language');
            const dropdown = document.getElementById('language-dropdown');

            currentLanguage.textContent = displayCode;
            dropdown.classList.add('hidden');

            // Store selected language in localStorage
            localStorage.setItem('selectedLanguage', langCode);

            // Apply translations to the entire portal
            applyTranslations(langCode);

            const languageNames = {
                'en': 'English',
                'te': 'Telugu (‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å)',
                'hi': 'Hindi (‡§π‡§ø‡§Ç‡§¶‡•Ä)'
            };

            console.log(`Language changed to: ${languageNames[langCode]}`);
        }

        function applyTranslations(langCode) {
            const t = translations[langCode] || translations.en;

            // Update page title
            document.title = `üéì ${t['ai-education-agent']} - ${t['smart-learning-platform']}`;

            // Update all elements with data-translate attributes
            const translatableElements = document.querySelectorAll('[data-translate]');
            translatableElements.forEach(element => {
                const key = element.getAttribute('data-translate');
                if (t[key]) {
                    element.textContent = t[key];
                }
            });

            // Update placeholders for input elements
            const inputElements = document.querySelectorAll('input[data-translate-placeholder]');
            inputElements.forEach(element => {
                const key = element.getAttribute('data-translate-placeholder');
                if (t[key]) {
                    element.placeholder = t[key];
                }
            });

            // Additional text-based translations for elements without data-translate attributes
            const textBasedTranslations = [
                // Common button texts that might be dynamically generated
                { text: 'Logout', key: 'logout' },
                { text: 'Help', key: 'help' },
                { text: 'Send', key: 'send' },
                { text: 'Close', key: 'close' },
                { text: 'Save', key: 'save' },
                { text: 'Cancel', key: 'cancel' },
                { text: 'Add Student', key: 'add-student' },
                { text: '+ Add Student', key: 'add-student' },
                { text: 'Export Excel', key: 'export-excel' },
                { text: 'üìä Export Excel', key: 'export-excel' },
                { text: 'View', key: 'view' },
                { text: 'Edit', key: 'edit' },
                { text: 'Remove', key: 'remove' },
                { text: 'Start Practice', key: 'start-practice' },
                { text: 'Start English', key: 'start-english' },
                { text: 'Tell Story', key: 'tell-story' },
                { text: 'Detect My Mood', key: 'detect-mood' },
                { text: 'üîç Detect My Mood', key: 'detect-mood' },
                { text: 'Mood Booster', key: 'mood-booster' },
                { text: '‚ö° Mood Booster', key: 'mood-booster' },
                { text: 'Download PDF', key: 'download-pdf' },
                { text: 'üì• Download PDF', key: 'download-pdf' },
                { text: 'Print', key: 'print' },
                { text: 'üñ®Ô∏è Print', key: 'print' },
                { text: 'Submit', key: 'submit' }
            ];

            // Apply text-based translations
            textBasedTranslations.forEach(item => {
                const elements = document.querySelectorAll('button, span, div, p, h1, h2, h3, h4, h5, h6');
                elements.forEach(element => {
                    if (element.textContent.trim() === item.text && t[item.key]) {
                        element.textContent = t[item.key];
                    }
                });
            });

            console.log(`Applied ${langCode} translations to the portal`);
        }

        // Close language dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const languageToggle = document.getElementById('language-toggle');
            const languageDropdown = document.getElementById('language-dropdown');

            if (!languageToggle.contains(event.target) && !languageDropdown.contains(event.target)) {
                languageDropdown.classList.add('hidden');
            }
        });

        // Dynamic Statistics Management
        function updateStatistics() {
            const students = JSON.parse(localStorage.getItem('students') || '[]');
            const defaultStudents = ['STU001']; // Default students that are always counted

            // Calculate total students (including default + added students)
            const totalStudents = defaultStudents.length + students.length;

            // Update total students count
            const totalStudentsElement = document.getElementById('total-students-count');
            if (totalStudentsElement) {
                totalStudentsElement.textContent = totalStudents;
            }

            // Calculate active sessions (simulate based on student count)
            const activeSessions = Math.min(Math.floor(totalStudents * 0.3), totalStudents);
            const activeSessionsElement = document.getElementById('active-sessions-count');
            if (activeSessionsElement) {
                activeSessionsElement.textContent = activeSessions;
            }

            // Calculate worksheets done (simulate based on student count)
            const worksheetsDone = totalStudents * 2 + Math.floor(Math.random() * 10);
            const worksheetsDoneElement = document.getElementById('worksheets-done-count');
            if (worksheetsDoneElement) {
                worksheetsDoneElement.textContent = worksheetsDone;
            }

            // Calculate pending doubts (simulate)
            const pendingDoubts = Math.max(1, Math.floor(totalStudents * 0.4));
            const pendingDoubtsElement = document.getElementById('pending-doubts-count');
            if (pendingDoubtsElement) {
                pendingDoubtsElement.textContent = pendingDoubts;
            }

            // Update weekly change indicator
            const weeklyChange = students.length > 0 ? `+${students.length} this week` : '+0 this week';
            const weeklyChangeElement = document.getElementById('students-weekly-change');
            if (weeklyChangeElement) {
                weeklyChangeElement.textContent = weeklyChange;
            }

            // Update the student table count display
            updateStudentTableCount();
        }

        function updateStudentTableCount() {
            // Count visible rows in the student table
            const tableBody = document.querySelector('#teacher-students-table tbody');
            if (tableBody) {
                const visibleRows = tableBody.querySelectorAll('tr:not([style*="display: none"])');
                const count = visibleRows.length;

                // Update any count displays in the table header or nearby elements
                const countElements = document.querySelectorAll('.student-count-display');
                countElements.forEach(element => {
                    element.textContent = `${count} student${count !== 1 ? 's' : ''} total`;
                });
            }
        }

        // Toast notification system
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg text-white transform transition-all duration-300 translate-x-full`;

            if (type === 'success') {
                toast.classList.add('bg-pantone-green');
            } else if (type === 'info') {
                toast.classList.add('bg-pantone-teal');
            } else if (type === 'warning') {
                toast.classList.add('bg-pantone-orange');
            } else if (type === 'error') {
                toast.classList.add('bg-red-500');
            }

            toast.innerHTML = message;
            document.body.appendChild(toast);

            // Animate in
            setTimeout(() => {
                toast.classList.remove('translate-x-full');
            }, 100);

            // Animate out and remove
            setTimeout(() => {
                toast.classList.add('translate-x-full');
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }

        function showTab(tabIndex) {
            console.log('Switching to tab:', tabIndex);

            // Hide all content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });

            // Reset all tab styles to inactive state
            document.querySelectorAll('[id^="tab-"]').forEach(tab => {
                tab.className = 'py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 dark:text-gray-400 hover:text-pantone-blue dark:hover:text-pantone-light hover:border-pantone-teal dark:hover:border-pantone-light';
            });

            // Show selected content and highlight tab with active state
            const contentElement = document.getElementById(`content-${tabIndex}`);
            const tabElement = document.getElementById(`tab-${tabIndex}`);

            if (contentElement) {
                contentElement.classList.remove('hidden');
            }

            if (tabElement) {
                tabElement.className = 'py-4 px-1 border-b-2 font-medium text-sm border-pantone-teal dark:border-pantone-light text-pantone-blue dark:text-pantone-light';
            }

            currentTab = tabIndex;

            // Initialize report card when tab 3 is selected
            if (tabIndex === 3) {
                initializeReportCard();
            }
        }

        function refreshInsights() {
            const insightDiv = document.querySelector('.bg-green-50.border.border-green-200');
            const originalContent = insightDiv.innerHTML;

            insightDiv.innerHTML = '<p class="text-blue-800 text-sm">ü§ñ AI is analyzing your latest performance...</p>';

            setTimeout(() => {
                // Update performance numbers slightly
                updatePerformanceNumbers();

                const insights = [
                    "Excellent progress in Mathematics! Your algebra skills have improved by 8% this week.",
                    "Great job on Science concepts! Focus on Physics equations for even better results.",
                    "Your English grammar is improving steadily. Keep practicing daily for best results.",
                    "Outstanding effort in all subjects! You're on track to reach 80% overall performance.",
                    "Your consistent practice is paying off! Keep up the excellent work.",
                    "AI detected improvement in problem-solving speed. Great job!"
                ];

                const randomInsight = insights[Math.floor(Math.random() * insights.length)];
                insightDiv.innerHTML = `<p class="text-green-800 text-sm">${randomInsight}</p>`;
            }, 2000);
        }

        function updatePerformanceNumbers() {
            // Slightly increase performance numbers to show progress
            const mathBar = document.querySelector('.bg-green-500');
            const scienceBar = document.querySelector('.bg-yellow-500');
            const englishBar = document.querySelector('.bg-red-500');

            const mathPercent = document.querySelector('.bg-green-500').parentElement.nextElementSibling;
            const sciencePercent = document.querySelector('.bg-yellow-500').parentElement.nextElementSibling;
            const englishPercent = document.querySelector('.bg-red-500').parentElement.nextElementSibling;

            // Increase by 1-2%
            let currentMath = parseInt(mathPercent.textContent);
            let currentScience = parseInt(sciencePercent.textContent);
            let currentEnglish = parseInt(englishPercent.textContent);

            if (currentMath < 90) {
                mathPercent.textContent = (currentMath + 1) + '%';
                mathBar.style.width = (currentMath + 1) + '%';
            }
            if (currentScience < 85) {
                sciencePercent.textContent = (currentScience + 1) + '%';
                scienceBar.style.width = (currentScience + 1) + '%';
            }
            if (currentEnglish < 75) {
                englishPercent.textContent = (currentEnglish + 2) + '%';
                englishBar.style.width = (currentEnglish + 2) + '%';
            }

            // Update overall progress
            const overallProgress = Math.round((parseInt(mathPercent.textContent) + parseInt(sciencePercent.textContent) + parseInt(englishPercent.textContent)) / 3);
            document.querySelector('.text-2xl.font-bold').textContent = overallProgress + '%';
            document.querySelector('.bg-blue-500').style.width = overallProgress + '%';
        }

        function startLearning() {
            showTab(2);
            selectFeature('session');
            showLearningSession();
        }

        function generateWorksheet() {
            showTab(2); // Switch to AI Features tab
            selectFeature('worksheet'); // Select worksheet feature
            showWorksheetGenerator(); // Show the worksheet interface
        }

        function askAI() {
            console.log('askAI() called - switching to AI Features tab');
            showTab(2);
            selectFeature('doubt');
            showDoubtInterface();

            // Show a toast notification
            showToast('ü§ñ AI Tutor is ready! Ask any question.', 'success');
        }

        function viewProgress() {
            const progressModal = document.createElement('div');
            progressModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            progressModal.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">üìä Detailed Progress Analytics</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 text-xl">‚úï</button>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h4 class="font-medium text-blue-800 mb-2">üìà Weekly Progress</h4>
                            <div class="space-y-2">
                                <div class="flex justify-between"><span>Mathematics:</span><span class="text-green-600 font-bold">+3%</span></div>
                                <div class="flex justify-between"><span>Science:</span><span class="text-green-600 font-bold">+2%</span></div>
                                <div class="flex justify-between"><span>English:</span><span class="text-yellow-600 font-bold">+1%</span></div>
                                <div class="flex justify-between"><span>History:</span><span class="text-green-600 font-bold">+2%</span></div>
                            </div>
                        </div>

                        <div class="bg-green-50 p-4 rounded-lg">
                            <h4 class="font-medium text-green-800 mb-2">üéØ Goals Status</h4>
                            <div class="space-y-2">
                                <div class="flex justify-between"><span>Daily Practice:</span><span class="text-green-600">‚úÖ 6/7 days</span></div>
                                <div class="flex justify-between"><span>Worksheets:</span><span class="text-green-600">‚úÖ 4/3 target</span></div>
                                <div class="flex justify-between"><span>AI Questions:</span><span class="text-yellow-600">‚ö†Ô∏è 2/5 target</span></div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-purple-50 p-4 rounded-lg mb-4">
                        <h4 class="font-medium text-purple-800 mb-2">ü§ñ AI Recommendations</h4>
                        <ul class="text-sm text-purple-700 space-y-1">
                            <li>‚Ä¢ Increase English practice to 20 minutes daily</li>
                            <li>‚Ä¢ Focus on History dates and events</li>
                            <li>‚Ä¢ Continue excellent Mathematics performance</li>
                            <li>‚Ä¢ Ask more questions to AI tutor for better understanding</li>
                        </ul>
                    </div>

                    <div class="text-center">
                        <button onclick="this.closest('.fixed').remove()" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600" data-translate="close">Close</button>
                    </div>
                </div>
            `;

            document.body.appendChild(progressModal);
        }

        function selectFeature(feature) {
            // Define original styles for each card type
            const originalStyles = {
                'doubt': 'bg-white rounded-lg shadow-lg p-6 cursor-pointer hover:shadow-xl transition-shadow border-2',
                'worksheet': 'bg-white rounded-lg shadow-lg p-6 cursor-pointer hover:shadow-xl transition-shadow border-2',
                'session': 'bg-white rounded-lg shadow-lg p-6 cursor-pointer hover:shadow-xl transition-shadow border-2',
                'voice': 'bg-gradient-to-br from-purple-500 to-pink-500 rounded-lg shadow-lg p-4 cursor-pointer hover:shadow-xl transition-all transform hover:scale-105 text-white border-2',
                'emotion': 'bg-gradient-to-br from-green-500 to-teal-500 rounded-lg shadow-lg p-4 cursor-pointer hover:shadow-xl transition-all transform hover:scale-105 text-white border-2',
                'gamify': 'bg-gradient-to-br from-orange-500 to-red-500 rounded-lg shadow-lg p-4 cursor-pointer hover:shadow-xl transition-all transform hover:scale-105 text-white border-2',
                'predict': 'bg-gradient-to-br from-blue-500 to-indigo-500 rounded-lg shadow-lg p-4 cursor-pointer hover:shadow-xl transition-all transform hover:scale-105 text-white border-2'
            };

            // Reset all feature cards to their original styles
            const allCards = document.querySelectorAll('[onclick^="selectFeature"]');
            allCards.forEach((card, index) => {
                const cardFeature = card.getAttribute('onclick').match(/selectFeature\('(\w+)'\)/)[1];
                const baseStyle = originalStyles[cardFeature] || 'bg-white rounded-lg shadow-lg p-6 cursor-pointer hover:shadow-xl transition-shadow border-2';
                card.className = baseStyle + ' border-transparent';
            });

            // Highlight selected feature
            let selectedCard = null;
            if (event && event.target) {
                selectedCard = event.target.closest('div[onclick^="selectFeature"]');
            } else {
                // If called programmatically, find the correct card
                allCards.forEach(card => {
                    const cardFeature = card.getAttribute('onclick').match(/selectFeature\('(\w+)'\)/)[1];
                    if (cardFeature === feature) {
                        selectedCard = card;
                    }
                });
            }

            // Apply selection styling
            if (selectedCard) {
                const cardFeature = selectedCard.getAttribute('onclick').match(/selectFeature\('(\w+)'\)/)[1];
                const baseStyle = originalStyles[cardFeature] || 'bg-white rounded-lg shadow-lg p-6 cursor-pointer hover:shadow-xl transition-shadow border-2';
                selectedCard.className = baseStyle + ' border-blue-500';
            }

            // Show appropriate interface
            if (feature === 'doubt') {
                showDoubtInterface();
            } else if (feature === 'worksheet') {
                showWorksheetGenerator();
            } else if (feature === 'session') {
                showLearningSession();
            } else if (feature === 'voice') {
                showVoiceInterface();
            } else if (feature === 'emotion') {
                showEmotionInterface();
            } else if (feature === 'gamify') {
                showGamifyInterface();
            } else if (feature === 'predict') {
                showPredictInterface();
            }
        }

        function showDoubtInterface() {
            document.querySelectorAll('.feature-interface').forEach(interface => {
                interface.classList.add('hidden');
            });
            document.getElementById('doubt-interface').classList.remove('hidden');
        }

        function showWorksheetGenerator() {
            document.querySelectorAll('.feature-interface').forEach(interface => {
                interface.classList.add('hidden');
            });
            document.getElementById('worksheet-interface').classList.remove('hidden');
        }

        function showLearningSession() {
            document.querySelectorAll('.feature-interface').forEach(interface => {
                interface.classList.add('hidden');
            });
            document.getElementById('session-interface').classList.remove('hidden');
        }

        function showVoiceInterface() {
            document.querySelectorAll('.feature-interface').forEach(interface => {
                interface.classList.add('hidden');
            });
            document.getElementById('voice-interface').classList.remove('hidden');
        }

        function showEmotionInterface() {
            document.querySelectorAll('.feature-interface').forEach(interface => {
                interface.classList.add('hidden');
            });
            document.getElementById('emotion-interface').classList.remove('hidden');
        }

        function showGamifyInterface() {
            document.querySelectorAll('.feature-interface').forEach(interface => {
                interface.classList.add('hidden');
            });
            document.getElementById('gamify-interface').classList.remove('hidden');
        }

        function showPredictInterface() {
            document.querySelectorAll('.feature-interface').forEach(interface => {
                interface.classList.add('hidden');
            });
            document.getElementById('predict-interface').classList.remove('hidden');
        }

        function askAIQuestion() {
            const questionText = document.querySelector('#doubt-interface textarea').value;
            const subject = document.querySelector('#doubt-interface select').value;
            const topic = document.querySelector('#doubt-interface input[type="text"]').value;

            if (!questionText.trim()) {
                showToast('Please enter a question first!', 'warning');
                return;
            }

            const responseDiv = document.getElementById('ai-response');
            showToast('ü§ñ AI is analyzing your question...', 'info');

            // Show enhanced loading state
            responseDiv.innerHTML = `
                <h4 class="text-md font-medium mb-3">ü§ñ AI Response</h4>
                <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-6 mb-4">
                    <div class="text-center">
                        <div class="animate-pulse text-6xl mb-4">üß†</div>
                        <p class="text-gray-700 font-medium mb-2">AI is analyzing your question...</p>
                        <p class="text-sm text-gray-600 mb-4">Considering your 76% performance level and visual learning style</p>
                        <div class="flex justify-center space-x-1">
                            <div class="w-2 h-2 bg-blue-500 rounded-full animate-bounce"></div>
                            <div class="w-2 h-2 bg-purple-500 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                            <div class="w-2 h-2 bg-green-500 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                        </div>
                    </div>
                </div>
            `;

            // Generate intelligent AI response
            setTimeout(() => {
                const aiResponse = generateIntelligentResponse(questionText, subject, topic);
                responseDiv.innerHTML = `
                    <h4 class="text-md font-medium mb-3">ü§ñ AI Response</h4>

                    <!-- Question Context -->
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                        <div class="flex items-start">
                            <div class="text-blue-500 mr-3 mt-1">‚ùì</div>
                            <div class="flex-1">
                                <div class="flex flex-wrap gap-2 mb-2">
                                    <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">${subject}</span>
                                    ${topic ? `<span class="text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded">${topic}</span>` : ''}
                                    <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">Level: 76%</span>
                                </div>
                                <p class="text-blue-800 text-sm"><strong>Your Question:</strong> "${questionText}"</p>
                            </div>
                        </div>
                    </div>

                    <!-- AI Explanation -->
                    <div class="bg-white border border-gray-200 rounded-lg p-4 mb-4">
                        <div class="flex items-start">
                            <div class="text-green-500 mr-3 mt-1">üéØ</div>
                            <div class="flex-1">
                                <p class="text-gray-800 text-sm leading-relaxed mb-3">${aiResponse.explanation}</p>
                                ${aiResponse.example ? `
                                    <div class="bg-gray-50 border-l-4 border-blue-500 p-3 mb-3">
                                        <p class="text-sm text-gray-700"><strong>Example:</strong> ${aiResponse.example}</p>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>

                    <!-- Personalization Note -->
                    <div class="bg-green-50 border border-green-200 rounded-lg p-3 mb-4">
                        <div class="flex items-start">
                            <div class="text-green-500 mr-2 mt-0.5">‚ú®</div>
                            <p class="text-green-800 text-sm">
                                <span class="font-medium">Personalized for you:</span> ${aiResponse.personalization}
                            </p>
                        </div>
                    </div>

                    <!-- Follow-up Suggestions -->
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-4">
                        <p class="text-yellow-800 text-sm font-medium mb-2">üí° What would you like to explore next?</p>
                        <div class="space-y-2">
                            ${aiResponse.followUps.map(followUp => `
                                <button onclick="askFollowUp('${followUp.replace(/'/g, "\\'")}', '${subject}', '${topic}')"
                                        class="block w-full text-left text-yellow-700 text-xs p-2 bg-yellow-100 rounded hover:bg-yellow-200 transition-colors">
                                    ‚Ä¢ ${followUp}
                                </button>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Response Metadata -->
                    <div class="flex justify-between items-center text-xs text-gray-500 pt-3 border-t">
                        <div class="flex items-center space-x-4">
                            <span>üéØ Confidence: ${aiResponse.confidence}%</span>
                            <span>üß† AI Generated</span>
                            <span>üìä Adapted to your level</span>
                        </div>
                        <span>‚è±Ô∏è ${aiResponse.responseTime}s</span>
                    </div>
                `;
                showToast('‚úÖ AI response ready! Personalized for your learning style.', 'success');
            }, 2200);
        }

        function generateIntelligentResponse(question, subject, topic) {
            const lowerQuestion = question.toLowerCase();
            const responses = {
                mathematics: {
                    algebra: {
                        explanation: "Algebra is like a puzzle where letters (like x and y) represent unknown numbers. Think of it as a detective game - you use clues (equations) to find the mystery number! For example, if x + 3 = 7, you can find that x = 4 by subtracting 3 from both sides.",
                        example: "If you have 3 apples and someone gives you some more apples, and now you have 7 apples total, how many did they give you? This is x + 3 = 7, so x = 4 apples!",
                        personalization: "Since you're strong in logical thinking and prefer step-by-step approaches, I've broken this down into clear steps. Your 76% math performance shows you're ready for these concepts!",
                        followUps: [
                            "Would you like to practice solving simple equations step by step?",
                            "Should I show you how algebra connects to real-life problems?",
                            "Want to see visual examples with diagrams?"
                        ]
                    },
                    geometry: {
                        explanation: "Geometry is about shapes, sizes, and how they relate to each other. Think of it as the mathematics of the world around you - every building, every design, every pattern follows geometric principles.",
                        example: "A triangle's angles always add up to 180¬∞. If you know two angles are 60¬∞ and 70¬∞, the third must be 50¬∞ because 60 + 70 + 50 = 180.",
                        personalization: "Your visual learning style is perfect for geometry! I'll use diagrams and real-world examples to make concepts clear.",
                        followUps: [
                            "Would you like to explore different types of triangles?",
                            "Should we look at how geometry appears in architecture?",
                            "Want to practice calculating angles and areas?"
                        ]
                    },
                    general: {
                        explanation: "Mathematics is all about patterns, relationships, and problem-solving. Every concept builds on previous ones, like building blocks. The key is to understand the 'why' behind each step, not just memorize formulas.",
                        example: "When you learn addition, it helps with multiplication (which is repeated addition), which then helps with area calculations (length √ó width).",
                        personalization: "Based on your visual learning style and 76% performance level, I recommend using diagrams and real-world examples to understand math concepts better.",
                        followUps: [
                            "Which specific math topic would you like to explore?",
                            "Should we start with visual examples?",
                            "Would you like practice problems at your level?"
                        ]
                    }
                },
                science: {
                    physics: {
                        explanation: "Physics is about understanding how things move, why they move, and the forces that cause motion. It's like being a detective of the natural world - you observe, ask questions, and discover the rules that govern everything around us.",
                        example: "When you drop a ball, gravity pulls it down at 9.8 m/s¬≤. This same force keeps planets in orbit and makes water flow downhill.",
                        personalization: "Your analytical thinking and curiosity make you well-suited for physics. I'll use everyday examples to make abstract concepts concrete.",
                        followUps: [
                            "Would you like to explore how forces work in everyday life?",
                            "Should we look at simple machines and how they help us?",
                            "Want to understand why things fall at the same rate?"
                        ]
                    },
                    general: {
                        explanation: "Science is about understanding how the world around us works. It's like being a detective - you observe, ask questions, make predictions, and test them. Every scientific concept connects to something you can see or experience in daily life.",
                        example: "When you see a rainbow, it's light being split into different colors by water droplets - the same principle used in prisms and optical instruments.",
                        personalization: "Your curiosity and analytical thinking make you well-suited for science. I'll use everyday examples to make concepts clear and memorable.",
                        followUps: [
                            "Which science topic interests you most - Physics, Chemistry, or Biology?",
                            "Would you like to see how this applies to everyday life?",
                            "Should we do a virtual experiment to understand better?"
                        ]
                    }
                },
                english: {
                    general: {
                        explanation: "English is about communication - expressing your thoughts clearly, understanding others, and appreciating the beauty of language. Every story, poem, or essay follows patterns that help convey meaning effectively.",
                        example: "When you write 'The cat sat on the mat,' you're using subject-verb-object structure. This same pattern helps in complex writing too.",
                        personalization: "Your logical thinking helps with grammar rules, while your creativity can shine in writing and interpretation.",
                        followUps: [
                            "Would you like to improve your writing skills?",
                            "Should we explore how to analyze stories and poems?",
                            "Want to practice grammar with fun examples?"
                        ]
                    }
                }
            };

            // Determine response based on question content and subject
            let response;

            if (lowerQuestion.includes('algebra') || (subject === 'mathematics' && (topic && topic.toLowerCase().includes('algebra')))) {
                response = responses.mathematics.algebra;
            } else if (lowerQuestion.includes('geometry') || lowerQuestion.includes('triangle') || lowerQuestion.includes('angle') ||
                      (subject === 'mathematics' && (topic && (topic.toLowerCase().includes('geometry') || topic.toLowerCase().includes('shape'))))) {
                response = responses.mathematics.geometry;
            } else if (subject === 'mathematics') {
                response = responses.mathematics.general;
            } else if (lowerQuestion.includes('physics') || lowerQuestion.includes('force') || lowerQuestion.includes('motion') ||
                      (subject === 'science' && (topic && topic.toLowerCase().includes('physics')))) {
                response = responses.science.physics;
            } else if (subject === 'science') {
                response = responses.science.general;
            } else if (subject === 'english') {
                response = responses.english.general;
            } else {
                // Default intelligent response
                response = {
                    explanation: `Great question about ${topic || subject}! This is an important concept that connects to many other topics. Let me explain this in a way that builds on what you already know and matches your learning style.`,
                    example: `Think of this like building with blocks - each new concept you learn becomes a foundation for the next one.`,
                    personalization: "I've tailored this explanation to your 76% performance level and visual learning preferences.",
                    followUps: [
                        "Would you like more detailed examples?",
                        "Should I explain how this connects to other topics?",
                        "Would a different approach help you understand better?"
                    ]
                };
            }

            return {
                ...response,
                confidence: Math.floor(Math.random() * 15) + 85, // 85-99%
                responseTime: (Math.random() * 1.5 + 1.8).toFixed(1) // 1.8-3.3s
            };
        }

        function askFollowUp(followUpQuestion, subject, topic) {
            document.querySelector('#doubt-interface textarea').value = followUpQuestion;
            document.querySelector('#doubt-interface select').value = subject || 'mathematics';
            if (topic) {
                document.querySelector('#doubt-interface input[type="text"]').value = topic;
            }
            showToast('üí° Follow-up question added! Click "Ask AI Tutor" to continue.', 'info');

            // Scroll to the question input
            document.querySelector('#doubt-interface textarea').scrollIntoView({ behavior: 'smooth', block: 'center' });
            document.querySelector('#doubt-interface textarea').focus();
        }

        function generateAIWorksheet() {
            const subject = document.getElementById('worksheet-subject').value;
            const difficulty = document.getElementById('worksheet-difficulty').value;
            const topic = document.getElementById('worksheet-topic').value || 'General';
            const questions = document.getElementById('worksheet-questions').value;
            const type = document.getElementById('worksheet-type').value;

            // Show loading state
            const previewDiv = document.getElementById('worksheet-preview');
            previewDiv.innerHTML = `
                <h4 class="text-md font-medium mb-3 text-gray-800">üìù Generated Worksheet</h4>
                <div class="text-center py-8">
                    <div class="animate-spin text-4xl mb-4">‚öôÔ∏è</div>
                    <p class="text-gray-600">Generating personalized worksheet...</p>
                </div>
            `;

            // Call the backend API to generate worksheet
            const apiUrl = window.location.hostname === 'localhost' ?
                'http://localhost:8000/api/worksheets/generate' :
                '/api/worksheets/ai-generate';
            fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    subject: subject,
                    topic: topic,
                    difficulty_level: difficulty,
                    questions: questions,
                    type: type
                })
            })
            .then(response => response.json())
            .then(data => {
                displayWorksheet(data, subject, topic, difficulty, questions, type);
            })
            .catch(error => {
                console.error('Error generating worksheet:', error);
                // Fallback to local generation
                setTimeout(() => {
                    const fallbackData = {
                        worksheet_id: 'fallback_' + Date.now(),
                        title: `${subject.charAt(0).toUpperCase() + subject.slice(1)} - ${topic}`,
                        problems: [
                            generateQuestionData(subject, 1, type),
                            generateQuestionData(subject, 2, type),
                            generateQuestionData(subject, 3, type)
                        ]
                    };
                    displayWorksheet(fallbackData, subject, topic, difficulty, questions, type);
                }, 1500);
            });
        }

        // Function to display the worksheet
        function displayWorksheet(worksheetData, subject, topic, difficulty, questions, type) {
            const previewDiv = document.getElementById('worksheet-preview');

            let questionsHTML = '';
            worksheetData.problems.forEach((problem, index) => {
                if (problem.type === 'multiple_choice') {
                    const optionsHTML = problem.options.map(option =>
                        `<div class="ml-4 mt-1 text-gray-600 text-sm">${option}</div>`
                    ).join('');

                    questionsHTML += `
                        <div class="bg-gray-50 rounded-lg p-3 border-l-4 border-green-500">
                            <p class="font-medium text-gray-800 mb-1">Question ${index + 1}:</p>
                            <p class="text-gray-700 mb-2">${problem.question}</p>
                            ${optionsHTML}
                            <div class="mt-3 text-xs text-gray-500">Points: 5 | Type: Multiple Choice | Correct Answer: ${problem.correct_answer}</div>
                        </div>
                    `;
                } else {
                    questionsHTML += `
                        <div class="bg-gray-50 rounded-lg p-3 border-l-4 border-green-500">
                            <p class="font-medium text-gray-800 mb-1">Question ${index + 1}:</p>
                            <p class="text-gray-700">${problem.question}</p>
                            <div class="mt-2 text-xs text-gray-500">Points: 5 | Type: ${problem.type === 'short_answer' ? 'Short Answer' : 'Long Answer'}</div>
                        </div>
                    `;
                }
            });

            previewDiv.innerHTML = `
                <h4 class="text-md font-medium mb-3 text-gray-800">üìù Generated Worksheet</h4>
                <div class="bg-white rounded-lg shadow-sm border p-4 mb-4 max-h-96 overflow-y-auto">
                    <!-- Header -->
                    <div class="flex justify-between items-center mb-4 pb-3 border-b">
                        <div>
                            <h5 class="font-semibold text-gray-800 text-lg">${worksheetData.title}</h5>
                            <p class="text-sm text-gray-600">Student: Priya Sharma | Grade: 8 | Date: ${new Date().toLocaleDateString()}</p>
                        </div>
                        <span class="bg-green-100 text-green-800 text-xs px-3 py-1 rounded-full font-medium">Level: ${difficulty.charAt(0).toUpperCase() + difficulty.slice(1)}</span>
                    </div>

                    <!-- Questions -->
                    <div class="space-y-4">
                        ${questionsHTML}
                        ${questions > worksheetData.problems.length ? `
                        <div class="text-center text-gray-500 py-3 border-t border-gray-200">
                            <p class="text-sm">... ${questions - worksheetData.problems.length} more questions ...</p>
                            <p class="text-xs mt-1">Total Questions: ${questions} | Estimated Time: ${worksheetData.estimated_time_minutes || Math.ceil(questions * 2)} minutes</p>
                        </div>
                        ` : ''}
                    </div>

                    <!-- Footer -->
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mt-6 pt-4 border-t gap-3">
                        <div class="text-xs text-gray-500">
                            <div>üìä Difficulty: ${difficulty} | üéØ Adapted for 76% performance level</div>
                            <div class="mt-1">‚è±Ô∏è Estimated time: ${worksheetData.estimated_time_minutes || Math.ceil(questions * 2)} minutes | üìù Total points: ${questions * 5}</div>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="downloadPDF()" class="bg-blue-500 text-white px-3 py-2 rounded-lg text-xs hover:bg-blue-600 transition-colors" data-translate="download-pdf">üì• Download PDF</button>
                            <button onclick="printWorksheet()" class="bg-green-500 text-white px-3 py-2 rounded-lg text-xs hover:bg-green-600 transition-colors" data-translate="print">üñ®Ô∏è Print</button>
                        </div>
                    </div>
                </div>

                <!-- Success Message -->
                <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                    <div class="flex items-start">
                        <div class="text-green-500 mr-3 mt-0.5">‚úÖ</div>
                        <div>
                            <p class="text-green-800 text-sm font-medium">Worksheet Generated Successfully!</p>
                            <p class="text-green-700 text-xs mt-1">This ${difficulty} level worksheet is perfectly adapted to your current 76% performance level in ${subject}. Questions are personalized based on your learning style and previous performance.</p>
                        </div>
                    </div>
                </div>
            `;
        }

        // Helper function to generate question data for fallback
        function generateQuestionData(subject, questionNum, type) {
            const questionData = getQuestionBySubject(subject, questionNum, type);

            if (type === 'mcq' || type === 'multiple_choice') {
                return {
                    id: questionNum,
                    type: 'multiple_choice',
                    question: questionData.question,
                    options: questionData.options,
                    correct_answer: questionData.correct
                };
            } else {
                return {
                    id: questionNum,
                    type: 'short_answer',
                    question: questionData,
                    expected_length: '2-3 sentences'
                };
            }
        }

        // Helper function to generate question HTML based on type
        function generateQuestionHTML(subject, questionNum, type) {
            const questionData = getQuestionBySubject(subject, questionNum, type);

            if (type === 'mcq' || type === 'multiple_choice') {
                const optionsHTML = questionData.options.map(option =>
                    `<div class="ml-4 mt-1 text-gray-600 text-sm">${option}</div>`
                ).join('');

                return `
                    <div class="bg-gray-50 rounded-lg p-3 border-l-4 border-green-500">
                        <p class="font-medium text-gray-800 mb-1">Question ${questionNum}:</p>
                        <p class="text-gray-700 mb-2">${questionData.question}</p>
                        ${optionsHTML}
                        <div class="mt-3 text-xs text-gray-500">Points: 5 | Type: Multiple Choice | Correct Answer: ${questionData.correct}</div>
                    </div>
                `;
            } else {
                return `
                    <div class="bg-gray-50 rounded-lg p-3 border-l-4 border-green-500">
                        <p class="font-medium text-gray-800 mb-1">Question ${questionNum}:</p>
                        <p class="text-gray-700">${questionData}</p>
                        <div class="mt-2 text-xs text-gray-500">Points: 5 | Type: ${type === 'short' ? 'Short Answer' : type === 'long' ? 'Long Answer' : 'Mixed'}</div>
                    </div>
                `;
            }
        }

        // Helper function to generate subject-specific questions
        function getQuestionBySubject(subject, questionNum, type) {
            const questionData = {
                mathematics: {
                    mcq: [
                        {
                            question: "What is the value of x in the equation 2x + 5 = 13?",
                            options: ["A) x = 3", "B) x = 4", "C) x = 5", "D) x = 6"],
                            correct: "B"
                        },
                        {
                            question: "If y = 3x - 2, what is the value of y when x = 4?",
                            options: ["A) y = 8", "B) y = 10", "C) y = 12", "D) y = 14"],
                            correct: "B"
                        },
                        {
                            question: "What is the simplified form of 4(x + 3) - 2x?",
                            options: ["A) 2x + 12", "B) 4x + 12", "C) 2x + 3", "D) 6x + 12"],
                            correct: "A"
                        }
                    ],
                    short: [
                        "Solve for x: 2x + 5 = 13. Show your work step by step.",
                        "If y = 3x - 2, find y when x = 4. Explain your calculation.",
                        "Simplify: 4(x + 3) - 2x. Show each step of the simplification."
                    ]
                },
                science: {
                    mcq: [
                        {
                            question: "What is the primary function of mitochondria in a cell?",
                            options: ["A) Protein synthesis", "B) Energy production", "C) DNA storage", "D) Waste removal"],
                            correct: "B"
                        },
                        {
                            question: "Which process do plants use to make their own food?",
                            options: ["A) Respiration", "B) Digestion", "C) Photosynthesis", "D) Transpiration"],
                            correct: "C"
                        },
                        {
                            question: "What are the three main states of matter?",
                            options: ["A) Hot, cold, warm", "B) Solid, liquid, gas", "C) Big, medium, small", "D) Fast, slow, still"],
                            correct: "B"
                        }
                    ],
                    short: [
                        "Explain the function of mitochondria in a cell and why they are called 'powerhouses'.",
                        "Describe the process of photosynthesis and explain why it's important for life on Earth.",
                        "List the three states of matter and give two examples of each state."
                    ]
                },
                english: {
                    mcq: [
                        {
                            question: "In the sentence 'The quick brown fox jumps over the lazy dog', what is the subject?",
                            options: ["A) quick brown", "B) fox", "C) jumps", "D) lazy dog"],
                            correct: "B"
                        },
                        {
                            question: "Which sentence uses the past perfect tense correctly?",
                            options: ["A) I had eaten lunch", "B) I am eating lunch", "C) I will eat lunch", "D) I eat lunch"],
                            correct: "A"
                        },
                        {
                            question: "Choose the correct usage: 'The rain will _____ our picnic plans.'",
                            options: ["A) effect", "B) affect", "C) effects", "D) affects"],
                            correct: "B"
                        }
                    ],
                    short: [
                        "Identify the subject and predicate in this sentence: 'The quick brown fox jumps over the lazy dog.'",
                        "Write a sentence using the past perfect tense and explain why you used this tense.",
                        "Explain the difference between 'affect' and 'effect' with examples."
                    ]
                },
                history: {
                    mcq: [
                        {
                            question: "Who was the first Prime Minister of India?",
                            options: ["A) Mahatma Gandhi", "B) Jawaharlal Nehru", "C) Sardar Patel", "D) Dr. Rajendra Prasad"],
                            correct: "B"
                        },
                        {
                            question: "In which year did India gain independence?",
                            options: ["A) 1945", "B) 1946", "C) 1947", "D) 1948"],
                            correct: "C"
                        },
                        {
                            question: "Which movement was led by Mahatma Gandhi for Indian independence?",
                            options: ["A) Quit India Movement", "B) Khilafat Movement", "C) Swadeshi Movement", "D) All of the above"],
                            correct: "D"
                        }
                    ],
                    short: [
                        "Name the first Prime Minister of India and describe one of his major contributions.",
                        "Explain the significance of August 15, 1947, in Indian history.",
                        "List three important leaders of the Indian freedom struggle and their contributions."
                    ]
                }
            };

            const subjectData = questionData[subject];
            if (!subjectData) {
                return type === 'mcq' ?
                    { question: `Sample multiple choice question ${questionNum} for ${subject}`, options: ["A) Option 1", "B) Option 2", "C) Option 3", "D) Option 4"], correct: "A" } :
                    `Sample question ${questionNum} for ${subject}`;
            }

            if (type === 'mcq' || type === 'multiple_choice') {
                const mcqData = subjectData.mcq[questionNum - 1];
                return mcqData || { question: `Sample MCQ ${questionNum} for ${subject}`, options: ["A) Option 1", "B) Option 2", "C) Option 3", "D) Option 4"], correct: "A" };
            } else {
                const shortData = subjectData.short[questionNum - 1];
                return shortData || `Sample question ${questionNum} for ${subject}`;
            }
        }

        function downloadPDF() {
            showToast('üì• Downloading worksheet as PDF...', 'info');
            // In a real implementation, this would generate and download a PDF
            setTimeout(() => {
                showToast('‚úÖ PDF downloaded successfully!', 'success');
            }, 2000);
        }

        function printWorksheet() {
            showToast('üñ®Ô∏è Opening print dialog...', 'info');
            // In a real implementation, this would open the print dialog
            setTimeout(() => {
                window.print();
            }, 500);
        }

        function startAISession() {
            const subject = document.getElementById('session-subject').value;
            const duration = document.getElementById('session-duration').value;

            showToast(`üéì Starting ${duration}-minute ${subject} learning session!`, 'info');

            const previewDiv = document.getElementById('session-preview');
            previewDiv.innerHTML = `
                <h4 class="text-md font-medium mb-3">üéì Session Started!</h4>
                <div class="bg-white rounded-lg p-4 mb-4">
                    <div class="text-center mb-4">
                        <div class="text-3xl mb-2">‚è±Ô∏è</div>
                        <div class="text-lg font-semibold text-purple-600">${duration} minutes</div>
                        <div class="text-sm text-gray-600">${subject.charAt(0).toUpperCase() + subject.slice(1)} Session</div>
                    </div>

                    <div class="space-y-3">
                        <div class="bg-purple-50 border border-purple-200 rounded-lg p-3">
                            <p class="text-purple-800 text-sm font-medium">üéØ Today's Learning Goal:</p>
                            <p class="text-purple-700 text-sm">Master English Grammar basics using visual examples and interactive exercises.</p>
                        </div>

                        <div class="grid grid-cols-3 gap-2 text-center text-xs">
                            <div class="bg-green-100 text-green-800 py-2 rounded">
                                <div class="font-medium">Step 1</div>
                                <div>Visual Examples</div>
                            </div>
                            <div class="bg-yellow-100 text-yellow-800 py-2 rounded">
                                <div class="font-medium">Step 2</div>
                                <div>Practice</div>
                            </div>
                            <div class="bg-blue-100 text-blue-800 py-2 rounded">
                                <div class="font-medium">Step 3</div>
                                <div>Assessment</div>
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-center mt-4">
                        <button class="bg-purple-500 text-white px-6 py-2 rounded-lg hover:bg-purple-600 transition-colors">
                            üöÄ Continue Learning
                        </button>
                    </div>
                </div>
                <div class="bg-purple-50 border border-purple-200 rounded-lg p-3">
                    <p class="text-purple-800 text-sm">
                        üéì AI Learning Session is now active! The content is personalized for your visual learning style and 65% English performance.
                    </p>
                </div>
            `;
        }

        function downloadPDF() {
            const subject = document.getElementById('worksheet-subject').value;
            const difficulty = document.getElementById('worksheet-difficulty').value;
            const topic = document.getElementById('worksheet-topic').value || 'General';
            const questions = document.getElementById('worksheet-questions').value;

            // Create worksheet content
            const content = `
AI Education Agent - Personalized Worksheet
${subject.toUpperCase()} - ${topic}
Generated: ${new Date().toLocaleDateString()}
Difficulty: ${difficulty} Level

Student: Priya Sharma
Grade: 8
Learning Style: Visual
Performance Level: 76%

Questions:
1. Sample question based on ${topic}
2. Practice problem for ${difficulty} level
3. Application question for ${subject}
... (${questions} total questions)

Instructions: This worksheet is personalized for your learning level.
Show all work and ask your AI tutor if you need help!

Generated by AI Education Agent for Government Schools
            `;

            // Create and download file
            const blob = new Blob([content], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${subject}_${topic}_worksheet.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);

            showToast('üì• Worksheet downloaded successfully! Check your Downloads folder.', 'success');
        }

        function printWorksheet() {
            const subject = document.getElementById('worksheet-subject').value;
            const difficulty = document.getElementById('worksheet-difficulty').value;
            const topic = document.getElementById('worksheet-topic').value || 'General';
            const questions = document.getElementById('worksheet-questions').value;

            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Worksheet - ${subject} - ${topic}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; border-bottom: 2px solid #333; padding-bottom: 10px; margin-bottom: 20px; }
                        .info { background: #f5f5f5; padding: 10px; margin-bottom: 20px; }
                        .question { margin-bottom: 20px; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>ü§ñ AI Education Agent - Personalized Worksheet</h1>
                        <h2>${subject.toUpperCase()} - ${topic}</h2>
                        <p>Generated: ${new Date().toLocaleDateString()} | Difficulty: ${difficulty} Level</p>
                    </div>

                    <div class="info">
                        <strong>Student:</strong> Priya Sharma &nbsp;&nbsp;
                        <strong>Grade:</strong> 8 &nbsp;&nbsp;
                        <strong>Learning Style:</strong> Visual &nbsp;&nbsp;
                        <strong>Performance:</strong> 76%<br><br>
                        <strong>Instructions:</strong> This worksheet is personalized for your learning level. Show all work!
                    </div>

                    <div class="question"><strong>Question 1:</strong> Sample question for ${topic}<br><br>Answer: ________________</div>
                    <div class="question"><strong>Question 2:</strong> Practice problem (${difficulty} level)<br><br>Answer: ________________</div>
                    <div class="question"><strong>Question 3:</strong> Application question for ${subject}<br><br>Answer: ________________</div>

                    <p style="text-align: center; margin-top: 30px; font-size: 12px;">
                        ü§ñ Generated by AI Education Agent | Personalized for Government Schools
                    </p>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // Teacher Dashboard Functions
        function addNewStudent() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">üë• Add New Student</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 text-xl">‚úï</button>
                    </div>

                    <form onsubmit="submitNewStudent(event)" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Student Name</label>
                            <input type="text" id="student-name" required class="w-full border border-gray-300 rounded-lg px-3 py-2" placeholder="Enter student name">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Student ID</label>
                            <input type="text" id="student-id" required class="w-full border border-gray-300 rounded-lg px-3 py-2" placeholder="e.g., STU002">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Grade</label>
                            <select id="student-grade" class="w-full border border-gray-300 rounded-lg px-3 py-2">
                                <option value="6">Grade 6</option>
                                <option value="7">Grade 7</option>
                                <option value="8" selected>Grade 8</option>
                                <option value="9">Grade 9</option>
                                <option value="10">Grade 10</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Learning Style</label>
                            <select id="learning-style" class="w-full border border-gray-300 rounded-lg px-3 py-2">
                                <option value="visual">Visual</option>
                                <option value="auditory">Auditory</option>
                                <option value="kinesthetic">Kinesthetic</option>
                                <option value="reading">Reading/Writing</option>
                            </select>
                        </div>

                        <div class="flex space-x-3 pt-4">
                            <button type="submit" class="flex-1 bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600">Add Student</button>
                            <button type="button" onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400">Cancel</button>
                        </div>
                    </form>
                </div>
            `;

            document.body.appendChild(modal);
        }

        function submitNewStudent(event) {
            event.preventDefault();
            const name = document.getElementById('student-name').value;
            const studentId = document.getElementById('student-id').value;
            const grade = document.getElementById('student-grade').value;
            const learningStyle = document.getElementById('learning-style').value;

            // Create new student object
            const defaultPassword = studentId.toLowerCase() + '123'; // Simple default password
            const newStudent = {
                student_id: studentId,
                name: name,
                grade: parseInt(grade),
                password: defaultPassword,
                current_level: 50.0, // Default starting level
                strengths: [],
                weaknesses: [],
                learning_style: learningStyle,
                last_activity: new Date().toISOString(),
                status: 'active'
            };

            // Store student data
            let students = JSON.parse(localStorage.getItem('students') || '[]');
            students.push(newStudent);
            localStorage.setItem('students', JSON.stringify(students));

            // Close modal
            event.target.closest('.fixed').remove();

            // Show success message with password info
            showToast(`‚úÖ Student ${name} (${studentId}) added successfully! Default password: ${defaultPassword}`, 'success');

            // Update statistics
            updateStatistics();

            // Switch to the newly added student
            localStorage.setItem('currentStudentId', studentId);

            // Refresh teacher dashboard to show new student
            refreshTeacherDashboard();

            // Update student dashboard to show the new student
            updateStudentDashboard();

            // Show additional success message about switching
            setTimeout(() => {
                showToast(`üë§ Switched to ${name}'s dashboard`, 'success');
            }, 1000);
        }

        function refreshTeacherDashboard() {
            const students = JSON.parse(localStorage.getItem('students') || '[]');
            const studentTableBody = document.querySelector('#teacher-students-table tbody');

            if (studentTableBody && students.length > 0) {
                // Clear existing rows except the default ones
                const existingRows = studentTableBody.querySelectorAll('tr');
                existingRows.forEach((row, index) => {
                    if (index >= 3) { // Keep first 3 default students
                        row.remove();
                    }
                });

                // Add new students
                students.forEach(student => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50';
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-white font-semibold mr-3">
                                    ${student.name.charAt(0)}
                                </div>
                                <div>
                                    <div class="text-sm font-medium text-gray-900">${student.name}</div>
                                    <div class="text-sm text-gray-500">ID: ${student.student_id}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="w-full bg-gray-200 rounded-full h-2 mr-2">
                                    <div class="bg-blue-600 h-2 rounded-full" style="width: ${student.current_level}%"></div>
                                </div>
                                <span class="text-sm font-medium">${student.current_level}%</span>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex flex-wrap gap-1">
                                ${student.strengths.length > 0 ?
                                    student.strengths.slice(0, 2).map(strength =>
                                        `<span class="px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full">${strength}</span>`
                                    ).join('') :
                                    '<span class="px-2 py-1 text-xs bg-gray-100 text-gray-600 rounded-full">To be assessed</span>'
                                }
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex flex-wrap gap-1">
                                ${student.weaknesses.length > 0 ?
                                    student.weaknesses.slice(0, 2).map(weakness =>
                                        `<span class="px-2 py-1 text-xs bg-orange-100 text-orange-800 rounded-full">${weakness}</span>`
                                    ).join('') :
                                    '<span class="px-2 py-1 text-xs bg-gray-100 text-gray-600 rounded-full">To be assessed</span>'
                                }
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            ${new Date(student.last_activity).toLocaleDateString()}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 py-1 text-xs font-semibold rounded-full ${student.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}">
                                ${student.status}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <div class="flex space-x-2">
                                <button onclick="viewStudentDetails('${student.student_id}')" class="text-blue-600 hover:text-blue-900 px-2 py-1 rounded text-xs">View</button>
                                <button onclick="editStudent('${student.student_id}')" class="text-green-600 hover:text-green-900 px-2 py-1 rounded text-xs">Edit</button>
                                <button onclick="confirmRemoveStudent('${student.student_id}', '${student.name}')" class="text-red-600 hover:text-red-900 px-2 py-1 rounded text-xs">Remove</button>
                            </div>
                        </td>
                    `;
                    studentTableBody.appendChild(row);
                });
            }
        }

        // Function to confirm student removal
        function confirmRemoveStudent(studentId, studentName) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                    <div class="flex items-center mb-4">
                        <div class="text-red-500 text-2xl mr-3">‚ö†Ô∏è</div>
                        <h3 class="text-lg font-semibold text-gray-900">Confirm Student Removal</h3>
                    </div>
                    <p class="text-gray-600 mb-6">
                        Are you sure you want to remove <strong>${studentName}</strong> (${studentId}) from the class?
                        This action cannot be undone and will permanently delete all student data.
                    </p>
                    <div class="flex justify-end space-x-3">
                        <button onclick="this.closest('.fixed').remove()" class="px-4 py-2 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
                            Cancel
                        </button>
                        <button onclick="removeStudent('${studentId}'); this.closest('.fixed').remove()" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                            Remove Student
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Function to remove a student
        function removeStudent(studentId) {
            // Handle default student removal
            if (studentId === 'STU001') {
                // Hide the default student row
                const tableBody = document.querySelector('#teacher-students-table tbody');
                const defaultRow = tableBody.querySelector('tr');
                if (defaultRow) {
                    defaultRow.style.display = 'none';
                }

                // Update statistics
                updateStatistics();

                showToast(`‚úÖ Student Priya Sharma (STU001) removed successfully!`, 'success');
                return;
            }

            let students = JSON.parse(localStorage.getItem('students') || '[]');
            const studentIndex = students.findIndex(s => s.student_id === studentId);

            if (studentIndex !== -1) {
                const removedStudent = students[studentIndex];
                students.splice(studentIndex, 1);
                localStorage.setItem('students', JSON.stringify(students));

                // Update statistics
                updateStatistics();

                // If this was the current student, switch to another student or default
                const currentStudentId = localStorage.getItem('currentStudentId');
                if (currentStudentId === studentId) {
                    if (students.length > 0) {
                        localStorage.setItem('currentStudentId', students[0].student_id);
                    } else {
                        localStorage.setItem('currentStudentId', 'STU001'); // Default student
                    }
                    updateStudentDashboard();
                }

                // Refresh teacher dashboard
                refreshTeacherDashboard();

                // Show success message
                showToast(`‚úÖ Student ${removedStudent.name} (${studentId}) removed successfully!`, 'success');
            }
        }

        // Function to edit a student
        function editStudent(studentId) {
            let student;

            // Handle default student
            if (studentId === 'STU001') {
                student = {
                    student_id: 'STU001',
                    name: 'Priya Sharma',
                    grade: 8,
                    learning_style: 'visual'
                };
            } else {
                const students = JSON.parse(localStorage.getItem('students') || '[]');
                student = students.find(s => s.student_id === studentId);

                if (!student) {
                    showToast('‚ùå Student not found!', 'error');
                    return;
                }
            }

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-900">Edit Student</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <form onsubmit="updateStudent(event, '${studentId}')">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Student Name</label>
                                <input type="text" id="edit-student-name" value="${student.name}" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Student ID</label>
                                <input type="text" id="edit-student-id" value="${student.student_id}" class="w-full border border-gray-300 rounded-lg px-3 py-2 bg-gray-100" readonly>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Grade</label>
                                <select id="edit-student-grade" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                                    <option value="6" ${student.grade === 6 ? 'selected' : ''}>Grade 6</option>
                                    <option value="7" ${student.grade === 7 ? 'selected' : ''}>Grade 7</option>
                                    <option value="8" ${student.grade === 8 ? 'selected' : ''}>Grade 8</option>
                                    <option value="9" ${student.grade === 9 ? 'selected' : ''}>Grade 9</option>
                                    <option value="10" ${student.grade === 10 ? 'selected' : ''}>Grade 10</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Learning Style</label>
                                <select id="edit-learning-style" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                                    <option value="visual" ${student.learning_style === 'visual' ? 'selected' : ''}>Visual</option>
                                    <option value="auditory" ${student.learning_style === 'auditory' ? 'selected' : ''}>Auditory</option>
                                    <option value="kinesthetic" ${student.learning_style === 'kinesthetic' ? 'selected' : ''}>Kinesthetic</option>
                                </select>
                            </div>
                        </div>
                        <div class="flex justify-end space-x-3 mt-6">
                            <button type="button" onclick="this.closest('.fixed').remove()" class="px-4 py-2 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
                                Cancel
                            </button>
                            <button type="submit" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                                Update Student
                            </button>
                        </div>
                    </form>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Function to update student information
        function updateStudent(event, studentId) {
            event.preventDefault();

            const name = document.getElementById('edit-student-name').value;
            const grade = document.getElementById('edit-student-grade').value;
            const learningStyle = document.getElementById('edit-learning-style').value;

            // Handle default student
            if (studentId === 'STU001') {
                // Update the default student row in the table
                const tableBody = document.querySelector('#teacher-students-table tbody');
                const defaultRow = tableBody.querySelector('tr');
                if (defaultRow) {
                    const nameCell = defaultRow.querySelector('td:first-child .text-sm.font-medium');
                    if (nameCell) {
                        nameCell.textContent = name;
                    }
                }

                // Close modal
                event.target.closest('.fixed').remove();

                // Show success message
                showToast(`‚úÖ Student ${name} updated successfully!`, 'success');
                return;
            }

            let students = JSON.parse(localStorage.getItem('students') || '[]');
            const studentIndex = students.findIndex(s => s.student_id === studentId);

            if (studentIndex !== -1) {
                students[studentIndex] = {
                    ...students[studentIndex],
                    name: name,
                    grade: parseInt(grade),
                    learning_style: learningStyle
                };

                localStorage.setItem('students', JSON.stringify(students));

                // Close modal
                event.target.closest('.fixed').remove();

                // Refresh dashboards
                refreshTeacherDashboard();
                updateStudentDashboard();

                // Show success message
                showToast(`‚úÖ Student ${name} updated successfully!`, 'success');
            }
        }

        function updateStudentDashboard() {
            const storedStudents = JSON.parse(localStorage.getItem('students') || '[]');
            const currentStudentId = localStorage.getItem('currentStudentId') || 'STU001';

            // Default student (always available)
            const defaultStudent = {
                student_id: 'STU001',
                name: 'Priya Sharma',
                grade: 8,
                learning_style: 'visual',
                current_level: 76,
                strengths: ['Mathematics', 'Science'],
                weaknesses: ['English', 'History'],
                status: 'active',
                last_activity: new Date().toISOString()
            };

            // Combine default student with stored students
            const allStudents = [defaultStudent, ...storedStudents];
            let currentStudent = null;

            // Find the current student (could be default or stored)
            if (currentStudentId) {
                currentStudent = allStudents.find(s => s.student_id === currentStudentId);
            }

            // If no current student found, use the first available student
            if (!currentStudent && allStudents.length > 0) {
                currentStudent = allStudents[0];
                localStorage.setItem('currentStudentId', currentStudent.student_id);
            }

            if (currentStudent) {
                // Update student profile section
                const profileSection = document.querySelector('#content-0 .bg-gradient-to-br');
                if (profileSection) {
                    profileSection.innerHTML = `
                        <div class="text-center">
                            <div class="w-20 h-20 bg-white bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-4">
                                <span class="text-2xl font-bold">${currentStudent.name.charAt(0)}</span>
                            </div>
                            <h3 class="text-xl font-bold mb-2">${currentStudent.name}</h3>
                            <p class="text-purple-100 mb-1">Grade ${currentStudent.grade} Student</p>
                            <p class="text-purple-100 text-sm">Learning Style: ${currentStudent.learning_style}</p>
                            <div class="mt-4 p-3 bg-white bg-opacity-20 rounded-lg">
                                <p class="text-sm text-purple-100 mb-1">Overall Performance</p>
                                <p class="text-2xl font-bold">${currentStudent.current_level}%</p>
                            </div>
                        </div>
                    `;
                }

                // Add student selector if multiple students exist
                if (allStudents.length > 1) {
                    addStudentSelector(allStudents, currentStudent.student_id);
                }
            }
        }

        function addStudentSelector(students, currentStudentId) {
            const dashboardHeader = document.querySelector('#content-0');
            let selectorExists = document.querySelector('#student-selector');

            if (!selectorExists) {
                const selector = document.createElement('div');
                selector.id = 'student-selector';
                selector.className = 'mb-6 bg-white rounded-lg shadow-lg p-4';
                selector.innerHTML = `
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-gray-900">üë§ Select Student</h3>
                        <div class="flex items-center space-x-3">
                            <select onchange="switchStudent(this.value)" class="border border-gray-300 rounded-lg px-3 py-2">
                                ${students.map(student =>
                                    `<option value="${student.student_id}" ${student.student_id === currentStudentId ? 'selected' : ''}>
                                        ${student.name} (${student.student_id})
                                    </option>`
                                ).join('')}
                            </select>
                            <span class="text-sm text-gray-500">${students.length} student${students.length !== 1 ? 's' : ''} total</span>
                        </div>
                    </div>
                `;
                dashboardHeader.insertBefore(selector, dashboardHeader.firstChild);
            } else {
                // Update existing selector
                const select = selectorExists.querySelector('select');
                const countSpan = selectorExists.querySelector('.text-gray-500');

                select.innerHTML = students.map(student =>
                    `<option value="${student.student_id}" ${student.student_id === currentStudentId ? 'selected' : ''}>
                        ${student.name} (${student.student_id})
                    </option>`
                ).join('');

                if (countSpan) {
                    countSpan.textContent = `${students.length} student${students.length !== 1 ? 's' : ''} total`;
                }
            }
        }

        function switchStudent(studentId) {
            localStorage.setItem('currentStudentId', studentId);
            updateStudentDashboard();

            // Show success message
            const storedStudents = JSON.parse(localStorage.getItem('students') || '[]');
            const defaultStudent = { student_id: 'STU001', name: 'Priya Sharma' };
            const allStudents = [defaultStudent, ...storedStudents];
            const selectedStudent = allStudents.find(s => s.student_id === studentId);

            if (selectedStudent) {
                showToast(`üë§ Switched to ${selectedStudent.name}`, 'success');
            }
        }

        function viewStudentDetails(studentId) {
            localStorage.setItem('currentStudentId', studentId);
            showTab(0); // Switch to student dashboard
            updateStudentDashboard();

            // Show success message
            const storedStudents = JSON.parse(localStorage.getItem('students') || '[]');
            const defaultStudent = { student_id: 'STU001', name: 'Priya Sharma' };
            const allStudents = [defaultStudent, ...storedStudents];
            const selectedStudent = allStudents.find(s => s.student_id === studentId);

            if (selectedStudent) {
                showToast(`üëÅÔ∏è Viewing ${selectedStudent.name}'s dashboard`, 'success');
            }
        }

        function exportClassData() {
            const classData = `AI Education Agent - Class 8 Report
Generated: ${new Date().toLocaleDateString()}

CLASS OVERVIEW:
- Total Students: 25
- Average Performance: 72.5%
- Active Sessions: 8
- Worksheets Completed: 45
- Pending Doubts: 12

STUDENT PERFORMANCE:
Student ID: STU001
Name: Priya Sharma
Performance: 76%
Strengths: Mathematics, Science
Focus Areas: English, History
Status: Active

[Additional student data would be included here...]

SUBJECT ANALYSIS:
Mathematics: 85% average (Class strength)
Science: 78% average (Good progress)
English: 65% average (Needs attention)
History: 70% average (Improving)

AI RECOMMENDATIONS:
1. Increase English practice sessions
2. Focus on Grammar and Writing skills
3. Continue Mathematics excellence
4. Implement more visual learning aids

Generated by AI Education Agent for Government Schools`;

            // Create and download file
            const blob = new Blob([classData], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Class_8_Report_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);

            showToast('üì• Class report exported successfully!', 'success');
        }

        function exportToExcel() {
            // Get all students data
            const students = JSON.parse(localStorage.getItem('students') || '[]');
            const defaultStudent = {
                student_id: 'STU001',
                name: 'Priya Sharma',
                grade: 8,
                current_level: 76.0,
                strengths: ['Mathematics', 'Science'],
                weaknesses: ['English', 'History'],
                learning_style: 'Visual',
                last_activity: new Date().toISOString(),
                status: 'active'
            };

            // Combine default student with added students
            const allStudents = [defaultStudent, ...students];

            // Prepare data for Excel
            const excelData = [];

            // Add header row
            excelData.push([
                'Student ID',
                'Name',
                'Grade',
                'Performance (%)',
                'Strengths',
                'Areas for Improvement',
                'Learning Style',
                'Status',
                'Last Activity',
                'Worksheets Completed',
                'Active Sessions',
                'Pending Doubts'
            ]);

            // Add student data rows
            allStudents.forEach((student, index) => {
                const worksheetsCompleted = Math.floor(Math.random() * 20) + 10; // Simulate data
                const activeSessions = Math.floor(Math.random() * 5) + 1;
                const pendingDoubts = Math.floor(Math.random() * 3);

                excelData.push([
                    student.student_id,
                    student.name,
                    student.grade || 8,
                    student.current_level || (Math.random() * 30 + 60).toFixed(1),
                    Array.isArray(student.strengths) ? student.strengths.join(', ') : 'Mathematics, Science',
                    Array.isArray(student.weaknesses) ? student.weaknesses.join(', ') : 'English, History',
                    student.learning_style || 'Visual',
                    student.status || 'active',
                    new Date(student.last_activity || Date.now()).toLocaleDateString(),
                    worksheetsCompleted,
                    activeSessions,
                    pendingDoubts
                ]);
            });

            // Add summary data
            excelData.push([]);
            excelData.push(['SUMMARY STATISTICS']);
            excelData.push(['Total Students', allStudents.length]);
            excelData.push(['Average Performance', (allStudents.reduce((sum, s) => sum + (s.current_level || 70), 0) / allStudents.length).toFixed(1) + '%']);
            excelData.push(['Active Students', allStudents.filter(s => s.status === 'active').length]);
            excelData.push(['Generated On', new Date().toLocaleString()]);

            // Create workbook and worksheet
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(excelData);

            // Set column widths
            const colWidths = [
                { wch: 12 }, // Student ID
                { wch: 20 }, // Name
                { wch: 8 },  // Grade
                { wch: 15 }, // Performance
                { wch: 25 }, // Strengths
                { wch: 25 }, // Areas for Improvement
                { wch: 15 }, // Learning Style
                { wch: 10 }, // Status
                { wch: 15 }, // Last Activity
                { wch: 18 }, // Worksheets Completed
                { wch: 15 }, // Active Sessions
                { wch: 15 }  // Pending Doubts
            ];
            ws['!cols'] = colWidths;

            // Add worksheet to workbook
            XLSX.utils.book_append_sheet(wb, ws, 'Student Progress Report');

            // Generate filename with current date
            const filename = `Student_Progress_Report_${new Date().toISOString().split('T')[0]}.xlsx`;

            // Save file
            XLSX.writeFile(wb, filename);

            showToast('üìä Excel report exported successfully!', 'success');
        }

        function showStudentDetails(studentId, studentName) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-4xl w-full mx-4 max-h-96 overflow-y-auto">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">üë§ Student Details - ${studentName}</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 text-xl">‚úï</button>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- Student Info -->
                        <div class="bg-purple-50 p-4 rounded-lg">
                            <h4 class="font-medium text-purple-800 mb-3">üìã Basic Information</h4>
                            <div class="space-y-2 text-sm">
                                <div><strong>Student ID:</strong> ${studentId}</div>
                                <div><strong>Name:</strong> ${studentName}</div>
                                <div><strong>Grade:</strong> 8</div>
                                <div><strong>Learning Style:</strong> Visual</div>
                                <div><strong>Overall Performance:</strong> 76%</div>
                                <div><strong>Status:</strong> <span class="text-green-600">Active</span></div>
                            </div>
                        </div>

                        <!-- Performance Details -->
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h4 class="font-medium text-blue-800 mb-3">üìä Subject Performance</h4>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm">Mathematics</span>
                                    <div class="flex items-center">
                                        <div class="w-16 bg-gray-200 rounded-full h-2 mr-2">
                                            <div class="bg-green-500 h-2 rounded-full" style="width: 85%"></div>
                                        </div>
                                        <span class="text-sm font-medium">85%</span>
                                    </div>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm">Science</span>
                                    <div class="flex items-center">
                                        <div class="w-16 bg-gray-200 rounded-full h-2 mr-2">
                                            <div class="bg-yellow-500 h-2 rounded-full" style="width: 78%"></div>
                                        </div>
                                        <span class="text-sm font-medium">78%</span>
                                    </div>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm">English</span>
                                    <div class="flex items-center">
                                        <div class="w-16 bg-gray-200 rounded-full h-2 mr-2">
                                            <div class="bg-red-500 h-2 rounded-full" style="width: 65%"></div>
                                        </div>
                                        <span class="text-sm font-medium">65%</span>
                                    </div>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm">History</span>
                                    <div class="flex items-center">
                                        <div class="w-16 bg-gray-200 rounded-full h-2 mr-2">
                                            <div class="bg-orange-500 h-2 rounded-full" style="width: 70%"></div>
                                        </div>
                                        <span class="text-sm font-medium">70%</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- AI Insights -->
                        <div class="bg-green-50 p-4 rounded-lg">
                            <h4 class="font-medium text-green-800 mb-3">ü§ñ AI Insights</h4>
                            <div class="space-y-2 text-sm">
                                <div class="bg-white p-2 rounded border-l-4 border-green-500">
                                    <strong>Strengths:</strong> Mathematics, Science
                                </div>
                                <div class="bg-white p-2 rounded border-l-4 border-yellow-500">
                                    <strong>Focus Areas:</strong> English Grammar, History
                                </div>
                                <div class="bg-white p-2 rounded border-l-4 border-blue-500">
                                    <strong>Learning Style:</strong> Responds well to visual aids and diagrams
                                </div>
                                <div class="bg-white p-2 rounded border-l-4 border-purple-500">
                                    <strong>Recommendation:</strong> Increase English practice to 20 min/day
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-6 flex justify-center space-x-3">
                        <button onclick="generatePersonalizedWorksheet('${studentId}')" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">üìù Generate Worksheet</button>
                        <button onclick="startPersonalizedSession('${studentId}')" class="bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600">üéì Start Session</button>
                        <button onclick="viewStudentReportCard('${studentId}')" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600">üìä Report Card</button>
                        <button onclick="this.closest('.fixed').remove()" class="bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400">Close</button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
        }

        // Voice Learning Functions
        let isRecording = false;
        let voiceRecognition = null;

        function toggleVoiceRecording() {
            const btn = document.getElementById('voice-record-btn');
            const btnText = document.getElementById('voice-btn-text');

            if (!isRecording) {
                // Start recording
                isRecording = true;
                btnText.textContent = 'üî¥ Stop Speaking';
                btn.className = 'flex-1 bg-red-500 text-white py-3 px-4 rounded-lg hover:bg-red-600 transition-colors';

                // Simulate voice recognition
                setTimeout(() => {
                    addVoiceMessage('user', 'Can you help me understand fractions in mathematics?');
                    setTimeout(() => {
                        addVoiceMessage('ai', 'Of course! Fractions represent parts of a whole. Think of a pizza cut into 8 slices. If you eat 3 slices, you\'ve eaten 3/8 of the pizza. Would you like me to show you some visual examples?');
                    }, 1500);
                }, 2000);

            } else {
                // Stop recording
                isRecording = false;
                btnText.textContent = 'üé§ Start Speaking';
                btn.className = 'flex-1 bg-purple-500 text-white py-3 px-4 rounded-lg hover:bg-purple-600 transition-colors';
            }
        }

        function addVoiceMessage(sender, message) {
            const conversation = document.getElementById('voice-conversation');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'flex items-start';

            if (sender === 'user') {
                messageDiv.innerHTML = `
                    <div class="bg-blue-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm mr-3">P</div>
                    <div class="bg-blue-50 rounded-lg p-3 flex-1">
                        <p class="text-sm">${message}</p>
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="bg-purple-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm mr-3">AI</div>
                    <div class="bg-purple-50 rounded-lg p-3 flex-1">
                        <p class="text-sm">${message}</p>
                    </div>
                `;
            }

            conversation.appendChild(messageDiv);
            conversation.scrollTop = conversation.scrollHeight;
        }

        function clearVoiceChat() {
            const conversation = document.getElementById('voice-conversation');
            conversation.innerHTML = `
                <div class="flex items-start">
                    <div class="bg-purple-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm mr-3">AI</div>
                    <div class="bg-purple-50 rounded-lg p-3 flex-1">
                        <p class="text-sm">Hello Priya! I'm your voice tutor. What would you like to learn today? You can ask me anything about Mathematics, Science, English, or History!</p>
                    </div>
                </div>
            `;
        }

        function startSubjectPractice() {
            showToast('üé§ Starting subject practice mode! Speak about any topic and I\'ll provide feedback.', 'info');
            addVoiceMessage('ai', 'Great! Let\'s practice. Tell me about photosynthesis in plants. I\'ll help you with pronunciation and content!');
        }

        function startLanguagePractice() {
            showToast('üåç English pronunciation practice activated! Speak clearly and I\'ll help improve your accent.', 'info');
            addVoiceMessage('ai', 'Perfect! Let\'s work on English pronunciation. Try saying: "The quick brown fox jumps over the lazy dog." I\'ll analyze your pronunciation!');
        }

        function startStoryMode() {
            showToast('üé≠ Story mode activated! I\'ll create an educational story based on your curriculum.', 'success');
            addVoiceMessage('ai', 'Once upon a time, in the kingdom of Mathlandia, there lived a brave princess named Algebra. She had a magical power to solve any equation! One day, the evil wizard Confusion cast a spell that mixed up all the numbers in the kingdom...');
        }

        // Emotion AI Functions
        const moods = [
            { emoji: 'üòä', status: 'Happy & Ready to Learn!', color: 'text-green-600' },
            { emoji: 'üò¥', status: 'Feeling Sleepy', color: 'text-blue-600' },
            { emoji: 'üò∞', status: 'A bit Stressed', color: 'text-orange-600' },
            { emoji: 'ü§î', status: 'Curious & Thoughtful', color: 'text-purple-600' },
            { emoji: 'üòé', status: 'Confident & Energetic!', color: 'text-green-600' },
            { emoji: 'üòî', status: 'Need Some Motivation', color: 'text-red-600' }
        ];

        function detectMood() {
            showToast('üîç Analyzing your mood through learning patterns...', 'info');

            setTimeout(() => {
                const randomMood = moods[Math.floor(Math.random() * moods.length)];
                document.getElementById('current-mood').textContent = randomMood.emoji;
                const statusElement = document.getElementById('mood-status');
                statusElement.textContent = randomMood.status;
                statusElement.className = `font-medium ${randomMood.color}`;

                showToast(`üòä Mood detected: ${randomMood.status}`, 'success');
            }, 2000);
        }

        function moodBooster() {
            const boosterMessages = [
                "üåü You're doing amazing! Your Math scores have improved by 15% this month!",
                "üöÄ Remember: Every expert was once a beginner. You're on the right path!",
                "üí™ Your dedication to learning is inspiring. Keep up the great work!",
                "üéØ You've completed 4 worksheets this week - that's fantastic progress!",
                "‚≠ê Believe in yourself! You have the power to achieve anything you set your mind to!"
            ];

            const randomMessage = boosterMessages[Math.floor(Math.random() * boosterMessages.length)];
            showToast(randomMessage, 'success');

            // Update mood to happy
            document.getElementById('current-mood').textContent = 'üòä';
            const statusElement = document.getElementById('mood-status');
            statusElement.textContent = 'Motivated & Ready to Learn!';
            statusElement.className = 'font-medium text-green-600';
        }

        function startBreathingExercise() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4 text-center">
                    <h3 class="text-xl font-semibold mb-4">ü´Å Breathing Exercise</h3>
                    <div class="mb-6">
                        <div id="breathing-circle" class="w-32 h-32 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full mx-auto flex items-center justify-center text-white text-lg font-bold transition-transform duration-4000">
                            Breathe
                        </div>
                    </div>
                    <p id="breathing-instruction" class="text-lg mb-4">Breathe in slowly...</p>
                    <div class="flex space-x-3">
                        <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400">Close</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            // Animate breathing
            let breathingIn = true;
            const circle = modal.querySelector('#breathing-circle');
            const instruction = modal.querySelector('#breathing-instruction');

            setInterval(() => {
                if (breathingIn) {
                    circle.style.transform = 'scale(1.3)';
                    instruction.textContent = 'Breathe in slowly...';
                } else {
                    circle.style.transform = 'scale(1)';
                    instruction.textContent = 'Breathe out slowly...';
                }
                breathingIn = !breathingIn;
            }, 4000);
        }

        function startMotivation() {
            const motivationalQuotes = [
                "üåü 'The future belongs to those who believe in the beauty of their dreams.' - Eleanor Roosevelt",
                "üöÄ 'Success is not final, failure is not fatal: it is the courage to continue that counts.' - Winston Churchill",
                "üí™ 'Education is the most powerful weapon which you can use to change the world.' - Nelson Mandela",
                "‚≠ê 'The only way to do great work is to love what you do.' - Steve Jobs",
                "üéØ 'Believe you can and you're halfway there.' - Theodore Roosevelt"
            ];

            const randomQuote = motivationalQuotes[Math.floor(Math.random() * motivationalQuotes.length)];

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-gradient-to-br from-purple-500 to-pink-500 rounded-lg p-8 max-w-lg w-full mx-4 text-center text-white">
                    <h3 class="text-xl font-semibold mb-6">‚≠ê Daily Motivation</h3>
                    <div class="text-lg mb-6 italic">${randomQuote}</div>
                    <div class="mb-6">
                        <p class="text-purple-100">Remember Priya, you're capable of amazing things! Your journey in learning is unique and valuable.</p>
                    </div>
                    <button onclick="this.closest('.fixed').remove()" class="bg-white text-purple-600 py-2 px-6 rounded-lg hover:bg-purple-50 font-semibold">Thank You! üíú</button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function startMindfulness() {
            showToast('üßò Starting 2-minute mindfulness break. Focus on your breathing and relax.', 'info');

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-gradient-to-br from-green-400 to-teal-500 rounded-lg p-8 max-w-md w-full mx-4 text-center text-white">
                    <h3 class="text-xl font-semibold mb-4">üßò Mindfulness Break</h3>
                    <div class="mb-6">
                        <div class="text-6xl mb-4">üå∏</div>
                        <p class="text-green-100 mb-4">Take a moment to relax and center yourself.</p>
                        <p class="text-sm text-green-200">Close your eyes, breathe deeply, and let go of any stress or worry.</p>
                    </div>
                    <div id="mindfulness-timer" class="text-2xl font-bold mb-4">2:00</div>
                    <button onclick="this.closest('.fixed').remove()" class="bg-white text-green-600 py-2 px-6 rounded-lg hover:bg-green-50 font-semibold">I Feel Better üåü</button>
                </div>
            `;
            document.body.appendChild(modal);

            // Start countdown timer
            let timeLeft = 120;
            const timer = modal.querySelector('#mindfulness-timer');
            const countdown = setInterval(() => {
                timeLeft--;
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                timer.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;

                if (timeLeft <= 0) {
                    clearInterval(countdown);
                    timer.textContent = 'Complete! üåü';
                }
            }, 1000);
        }

        function celebrateAchievement() {
            const achievements = [
                "üèÜ Completed 5 Math worksheets this week!",
                "‚≠ê Improved English score by 10 points!",
                "üéØ Maintained 6-day learning streak!",
                "üí™ Asked 15 questions to AI tutor!",
                "üåü Mastered fractions and decimals!"
            ];

            const randomAchievement = achievements[Math.floor(Math.random() * achievements.length)];

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-gradient-to-br from-yellow-400 to-orange-500 rounded-lg p-8 max-w-md w-full mx-4 text-center text-white">
                    <h3 class="text-2xl font-bold mb-4">üéâ Celebration Time!</h3>
                    <div class="text-6xl mb-4">üèÜ</div>
                    <div class="text-lg mb-4 font-semibold">${randomAchievement}</div>
                    <p class="text-yellow-100 mb-6">You're doing fantastic! Keep up the amazing work, Priya!</p>
                    <button onclick="this.closest('.fixed').remove()" class="bg-white text-orange-600 py-2 px-6 rounded-lg hover:bg-orange-50 font-semibold">Thank You! üéä</button>
                </div>
            `;
            document.body.appendChild(modal);

            // Add confetti effect
            showToast('üéä Congratulations on your amazing progress!', 'success');
        }

        // AI Games Functions
        function startMathGame() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-2xl w-full mx-4">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold">üßÆ Math Adventure - Save the Kingdom!</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 text-xl">‚úï</button>
                    </div>

                    <div class="bg-gradient-to-r from-blue-50 to-purple-50 p-4 rounded-lg mb-4">
                        <p class="text-sm text-gray-700">üè∞ The evil wizard has locked the princess in a tower! Solve these equations to break the spell and save her!</p>
                    </div>

                    <div class="space-y-4">
                        <div class="bg-yellow-50 p-4 rounded-lg border-l-4 border-yellow-500">
                            <h4 class="font-semibold mb-2">Level 1: The Magic Door</h4>
                            <p class="mb-2">What is 15 + 27?</p>
                            <input type="number" id="math-answer-1" class="border border-gray-300 rounded px-3 py-2 w-20" placeholder="?">
                            <button onclick="checkMathAnswer(1, 42)" class="ml-2 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Cast Spell!</button>
                        </div>

                        <div class="bg-green-50 p-4 rounded-lg border-l-4 border-green-500">
                            <h4 class="font-semibold mb-2">Level 2: The Enchanted Bridge</h4>
                            <p class="mb-2">If x + 8 = 15, what is x?</p>
                            <input type="number" id="math-answer-2" class="border border-gray-300 rounded px-3 py-2 w-20" placeholder="?">
                            <button onclick="checkMathAnswer(2, 7)" class="ml-2 bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">Cross Bridge!</button>
                        </div>

                        <div class="bg-purple-50 p-4 rounded-lg border-l-4 border-purple-500">
                            <h4 class="font-semibold mb-2">Final Level: Break the Spell</h4>
                            <p class="mb-2">What is 3/4 as a decimal?</p>
                            <input type="number" step="0.01" id="math-answer-3" class="border border-gray-300 rounded px-3 py-2 w-20" placeholder="?">
                            <button onclick="checkMathAnswer(3, 0.75)" class="ml-2 bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">Save Princess!</button>
                        </div>
                    </div>

                    <div id="game-result" class="mt-4 text-center"></div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function checkMathAnswer(level, correctAnswer) {
            const userAnswer = parseFloat(document.getElementById(`math-answer-${level}`).value);
            const resultDiv = document.getElementById('game-result');

            if (userAnswer === correctAnswer) {
                resultDiv.innerHTML = `<div class="bg-green-100 text-green-800 p-3 rounded-lg">‚úÖ Correct! You've completed Level ${level}! ${level === 3 ? 'üè∞ Princess saved! +70 XP earned!' : '+20 XP earned!'}</div>`;
                showToast(`üéâ Level ${level} completed! Great job!`, 'success');
            } else {
                resultDiv.innerHTML = `<div class="bg-red-100 text-red-800 p-3 rounded-lg">‚ùå Not quite right. Try again! Hint: ${level === 1 ? 'Add the numbers carefully' : level === 2 ? 'Subtract 8 from both sides' : 'Divide 3 by 4'}</div>`;
            }
        }

        function startScienceGame() {
            showToast('üî¨ Starting Lab Detective game! Solve scientific mysteries through experiments!', 'info');

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-2xl w-full mx-4">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold">üî¨ Lab Detective - Mystery of the Missing Elements!</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 text-xl">‚úï</button>
                    </div>

                    <div class="bg-gradient-to-r from-green-50 to-blue-50 p-4 rounded-lg mb-4">
                        <p class="text-sm text-gray-700">üß™ Elements have gone missing from the periodic table! Use your scientific knowledge to find them!</p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h4 class="font-semibold mb-2">üîç Clue 1</h4>
                            <p class="text-sm mb-2">I am the most abundant gas in Earth's atmosphere. What am I?</p>
                            <select id="science-answer-1" class="w-full border border-gray-300 rounded px-3 py-2">
                                <option value="">Choose element...</option>
                                <option value="oxygen">Oxygen</option>
                                <option value="nitrogen">Nitrogen</option>
                                <option value="carbon">Carbon</option>
                            </select>
                        </div>

                        <div class="bg-green-50 p-4 rounded-lg">
                            <h4 class="font-semibold mb-2">üîç Clue 2</h4>
                            <p class="text-sm mb-2">I am essential for photosynthesis and have the symbol 'O'. What am I?</p>
                            <select id="science-answer-2" class="w-full border border-gray-300 rounded px-3 py-2">
                                <option value="">Choose element...</option>
                                <option value="oxygen">Oxygen</option>
                                <option value="hydrogen">Hydrogen</option>
                                <option value="carbon">Carbon</option>
                            </select>
                        </div>
                    </div>

                    <div class="text-center mt-4">
                        <button onclick="checkScienceAnswers()" class="bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600">üî¨ Solve Mystery!</button>
                    </div>

                    <div id="science-result" class="mt-4 text-center"></div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function checkScienceAnswers() {
            const answer1 = document.getElementById('science-answer-1').value;
            const answer2 = document.getElementById('science-answer-2').value;
            const resultDiv = document.getElementById('science-result');

            let correct = 0;
            if (answer1 === 'nitrogen') correct++;
            if (answer2 === 'oxygen') correct++;

            if (correct === 2) {
                resultDiv.innerHTML = `<div class="bg-green-100 text-green-800 p-3 rounded-lg">üéâ Perfect! You've solved the mystery! All elements found! +50 XP earned!</div>`;
                showToast('üî¨ Mystery solved! You\'re a true Lab Detective!', 'success');
            } else {
                resultDiv.innerHTML = `<div class="bg-yellow-100 text-yellow-800 p-3 rounded-lg">ü§î ${correct}/2 correct. Keep investigating! Science requires careful observation.</div>`;
            }
        }

        function startEnglishGame() {
            showToast('üìö Starting Word Wizard adventure! Build your vocabulary through magical quests!', 'info');

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-2xl w-full mx-4">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold">üìö Word Wizard - The Vocabulary Quest!</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 text-xl">‚úï</button>
                    </div>

                    <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-4 rounded-lg mb-4">
                        <p class="text-sm text-gray-700">ü™Ñ The ancient spell book needs the correct words to unlock its magic! Choose wisely, young wizard!</p>
                    </div>

                    <div class="space-y-4">
                        <div class="bg-purple-50 p-4 rounded-lg border-l-4 border-purple-500">
                            <h4 class="font-semibold mb-2">Spell 1: The Synonym Charm</h4>
                            <p class="mb-2">What is a synonym for "happy"?</p>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="checkEnglishAnswer(1, 'joyful')" class="bg-blue-100 hover:bg-blue-200 p-2 rounded text-sm">Joyful</button>
                                <button onclick="checkEnglishAnswer(1, 'sad')" class="bg-blue-100 hover:bg-blue-200 p-2 rounded text-sm">Sad</button>
                                <button onclick="checkEnglishAnswer(1, 'angry')" class="bg-blue-100 hover:bg-blue-200 p-2 rounded text-sm">Angry</button>
                                <button onclick="checkEnglishAnswer(1, 'tired')" class="bg-blue-100 hover:bg-blue-200 p-2 rounded text-sm">Tired</button>
                            </div>
                        </div>

                        <div class="bg-green-50 p-4 rounded-lg border-l-4 border-green-500">
                            <h4 class="font-semibold mb-2">Spell 2: The Grammar Guardian</h4>
                            <p class="mb-2">Choose the correct sentence:</p>
                            <div class="space-y-2">
                                <button onclick="checkEnglishAnswer(2, 'correct')" class="w-full bg-green-100 hover:bg-green-200 p-2 rounded text-sm text-left">She and I went to the store.</button>
                                <button onclick="checkEnglishAnswer(2, 'wrong')" class="w-full bg-green-100 hover:bg-green-200 p-2 rounded text-sm text-left">Her and me went to the store.</button>
                            </div>
                        </div>
                    </div>

                    <div id="english-result" class="mt-4 text-center"></div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        let englishScore = 0;
        function checkEnglishAnswer(question, answer) {
            const resultDiv = document.getElementById('english-result');

            if ((question === 1 && answer === 'joyful') || (question === 2 && answer === 'correct')) {
                englishScore++;
                resultDiv.innerHTML = `<div class="bg-green-100 text-green-800 p-3 rounded-lg">‚ú® Correct! Spell ${question} cast successfully! Score: ${englishScore}/2</div>`;

                if (englishScore === 2) {
                    setTimeout(() => {
                        resultDiv.innerHTML = `<div class="bg-purple-100 text-purple-800 p-3 rounded-lg">ü™Ñ Congratulations! You've mastered the Word Wizard quest! +70 XP earned!</div>`;
                        showToast('üìö Word Wizard quest completed! Your vocabulary is growing stronger!', 'success');
                    }, 1500);
                }
            } else {
                resultDiv.innerHTML = `<div class="bg-red-100 text-red-800 p-3 rounded-lg">‚ùå The spell fizzled! Try again, young wizard!</div>`;
            }
        }

        // Future Predictor Functions
        function generateCareerPlan() {
            showToast('üîÆ Generating your personalized career roadmap...', 'info');

            setTimeout(() => {
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                modal.innerHTML = `
                    <div class="bg-white rounded-lg p-6 max-w-4xl w-full mx-4 max-h-96 overflow-y-auto">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-semibold">üìã Personalized Career Plan for Priya Sharma</h3>
                            <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 text-xl">‚úï</button>
                        </div>

                        <div class="space-y-6">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h4 class="font-semibold text-blue-800 mb-2">üéØ Immediate Goals (Next 6 months)</h4>
                                <ul class="text-sm text-blue-700 space-y-1">
                                    <li>‚Ä¢ Improve English score from 65% to 75%</li>
                                    <li>‚Ä¢ Maintain Mathematics excellence (85%+)</li>
                                    <li>‚Ä¢ Start basic coding with Scratch programming</li>
                                    <li>‚Ä¢ Join school science club for hands-on experiments</li>
                                </ul>
                            </div>

                            <div class="bg-green-50 p-4 rounded-lg">
                                <h4 class="font-semibold text-green-800 mb-2">üìö Academic Path (Grades 9-12)</h4>
                                <ul class="text-sm text-green-700 space-y-1">
                                    <li>‚Ä¢ Choose PCM (Physics, Chemistry, Mathematics) stream</li>
                                    <li>‚Ä¢ Add Computer Science as optional subject</li>
                                    <li>‚Ä¢ Target 90%+ in board exams</li>
                                    <li>‚Ä¢ Participate in Math and Science Olympiads</li>
                                    <li>‚Ä¢ Learn Python programming language</li>
                                </ul>
                            </div>

                            <div class="bg-purple-50 p-4 rounded-lg">
                                <h4 class="font-semibold text-purple-800 mb-2">üèõÔ∏è Higher Education (College)</h4>
                                <ul class="text-sm text-purple-700 space-y-1">
                                    <li>‚Ä¢ Target: IIT/NIT for Computer Science Engineering</li>
                                    <li>‚Ä¢ Alternative: B.Sc. Data Science from top universities</li>
                                    <li>‚Ä¢ Prepare for JEE Main & Advanced</li>
                                    <li>‚Ä¢ Build portfolio with coding projects</li>
                                    <li>‚Ä¢ Internships at tech companies</li>
                                </ul>
                            </div>

                            <div class="bg-yellow-50 p-4 rounded-lg">
                                <h4 class="font-semibold text-yellow-800 mb-2">üíº Career Opportunities</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                    <div>
                                        <h5 class="font-medium">Tech Industry:</h5>
                                        <ul class="text-yellow-700 space-y-1">
                                            <li>‚Ä¢ Data Scientist at Google/Microsoft</li>
                                            <li>‚Ä¢ AI/ML Engineer</li>
                                            <li>‚Ä¢ Software Developer</li>
                                        </ul>
                                    </div>
                                    <div>
                                        <h5 class="font-medium">Research & Academia:</h5>
                                        <ul class="text-yellow-700 space-y-1">
                                            <li>‚Ä¢ Research Scientist</li>
                                            <li>‚Ä¢ University Professor</li>
                                            <li>‚Ä¢ Innovation Consultant</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="text-center mt-6">
                            <button onclick="downloadCareerPlan()" class="bg-indigo-500 text-white px-6 py-2 rounded-lg hover:bg-indigo-600 mr-3">üì• Download Plan</button>
                            <button onclick="this.closest('.fixed').remove()" class="bg-gray-300 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-400">Close</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            }, 2000);
        }

        function downloadCareerPlan() {
            const careerPlan = `üîÆ AI CAREER PLAN FOR PRIYA SHARMA
Generated: ${new Date().toLocaleDateString()}

STUDENT PROFILE:
- Name: Priya Sharma
- Grade: 8
- Learning Style: Visual
- Strengths: Mathematics (85%), Analytical Thinking
- Focus Areas: English (65%), Communication Skills

IMMEDIATE GOALS (Next 6 months):
‚úì Improve English score from 65% to 75%
‚úì Maintain Mathematics excellence (85%+)
‚úì Start basic coding with Scratch programming
‚úì Join school science club for hands-on experiments

ACADEMIC PATH (Grades 9-12):
‚úì Choose PCM (Physics, Chemistry, Mathematics) stream
‚úì Add Computer Science as optional subject
‚úì Target 90%+ in board exams
‚úì Participate in Math and Science Olympiads
‚úì Learn Python programming language

HIGHER EDUCATION (College):
‚úì Target: IIT/NIT for Computer Science Engineering
‚úì Alternative: B.Sc. Data Science from top universities
‚úì Prepare for JEE Main & Advanced
‚úì Build portfolio with coding projects
‚úì Internships at tech companies

CAREER OPPORTUNITIES:
Tech Industry:
- Data Scientist at Google/Microsoft
- AI/ML Engineer
- Software Developer

Research & Academia:
- Research Scientist
- University Professor
- Innovation Consultant

PREDICTED SALARY RANGE: ‚Çπ15-50 LPA
SUCCESS PROBABILITY: 92%

Generated by AI Education Agent - Future Predictor
Personalized for Government Schools Initiative`;

            const blob = new Blob([careerPlan], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Career_Plan_Priya_Sharma_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);

            showToast('üì• Career plan downloaded successfully!', 'success');
        }

        function generatePersonalizedWorksheet(studentId) {
            // Close the student details modal
            document.querySelector('.fixed').remove();

            // Switch to AI Features tab and show worksheet generator
            showTab(2);
            selectFeature('worksheet');
            showWorksheetGenerator();

            showToast(`üìù Generating personalized worksheet for ${studentId}...`, 'info');
        }

        function startPersonalizedSession(studentId) {
            // Close the student details modal
            document.querySelector('.fixed').remove();

            // Switch to AI Features tab and show learning session
            showTab(2);
            selectFeature('session');
            showLearningSession();

            showToast(`üéì Starting personalized learning session for ${studentId}...`, 'info');
        }

        function viewStudentReportCard(studentId) {
            // Close the student details modal
            document.querySelector('.fixed').remove();

            // Switch to Report Card tab
            showTab(3);

            // Set the student in the selector and generate report
            const selector = document.getElementById('report-student-selector');
            if (selector) {
                selector.value = studentId;
                generateReportCard(studentId);
            }

            showToast(`üìä Generating report card for ${studentId}...`, 'info');
        }

        function showStatDetails(statType) {
            const statData = {
                students: {
                    title: 'üë• Student Statistics',
                    content: `
                        <div class="space-y-4">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h4 class="font-medium text-blue-800 mb-2">Enrollment Trends</h4>
                                <div class="grid grid-cols-2 gap-4 text-sm">
                                    <div>Total Students: <strong>25</strong></div>
                                    <div>New This Week: <strong class="text-green-600">+2</strong></div>
                                    <div>Active Students: <strong>23</strong></div>
                                    <div>Inactive: <strong class="text-red-600">2</strong></div>
                                </div>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h4 class="font-medium text-gray-800 mb-2">Grade Distribution</h4>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between"><span>Grade 8:</span><span>25 students</span></div>
                                    <div class="flex justify-between"><span>Average Age:</span><span>13.2 years</span></div>
                                </div>
                            </div>
                        </div>
                    `
                },
                performance: {
                    title: 'üìà Performance Analytics',
                    content: `
                        <div class="space-y-4">
                            <div class="bg-green-50 p-4 rounded-lg">
                                <h4 class="font-medium text-green-800 mb-2">Overall Performance</h4>
                                <div class="grid grid-cols-2 gap-4 text-sm">
                                    <div>Class Average: <strong>72.5%</strong></div>
                                    <div>Monthly Growth: <strong class="text-green-600">+3.2%</strong></div>
                                    <div>Top Performer: <strong>Priya Sharma (76%)</strong></div>
                                    <div>Improvement Needed: <strong class="text-orange-600">5 students</strong></div>
                                </div>
                            </div>
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h4 class="font-medium text-blue-800 mb-2">Subject-wise Performance</h4>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between"><span>Mathematics:</span><span class="text-green-600">85% avg</span></div>
                                    <div class="flex justify-between"><span>Science:</span><span class="text-yellow-600">78% avg</span></div>
                                    <div class="flex justify-between"><span>English:</span><span class="text-red-600">65% avg</span></div>
                                    <div class="flex justify-between"><span>History:</span><span class="text-orange-600">70% avg</span></div>
                                </div>
                            </div>
                        </div>
                    `
                },
                sessions: {
                    title: 'üéì Active Learning Sessions',
                    content: `
                        <div class="space-y-4">
                            <div class="bg-purple-50 p-4 rounded-lg">
                                <h4 class="font-medium text-purple-800 mb-2">Current Sessions</h4>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between"><span>Mathematics - Algebra:</span><span class="text-green-600">3 students</span></div>
                                    <div class="flex justify-between"><span>English - Grammar:</span><span class="text-blue-600">2 students</span></div>
                                    <div class="flex justify-between"><span>Science - Physics:</span><span class="text-purple-600">3 students</span></div>
                                </div>
                            </div>
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h4 class="font-medium text-blue-800 mb-2">Session Statistics</h4>
                                <div class="grid grid-cols-2 gap-4 text-sm">
                                    <div>Total Sessions Today: <strong>8</strong></div>
                                    <div>Average Duration: <strong>25 min</strong></div>
                                    <div>Completion Rate: <strong class="text-green-600">92%</strong></div>
                                    <div>Student Satisfaction: <strong class="text-green-600">4.8/5</strong></div>
                                </div>
                            </div>
                        </div>
                    `
                },
                worksheets: {
                    title: 'üìù Worksheet Analytics',
                    content: `
                        <div class="space-y-4">
                            <div class="bg-orange-50 p-4 rounded-lg">
                                <h4 class="font-medium text-orange-800 mb-2">Worksheet Statistics</h4>
                                <div class="grid grid-cols-2 gap-4 text-sm">
                                    <div>Total Completed: <strong>45</strong></div>
                                    <div>Completed Today: <strong class="text-green-600">12</strong></div>
                                    <div>Average Score: <strong>78%</strong></div>
                                    <div>Pending Review: <strong class="text-yellow-600">8</strong></div>
                                </div>
                            </div>
                            <div class="bg-purple-50 p-4 rounded-lg">
                                <h4 class="font-medium text-purple-800 mb-2">Subject Distribution</h4>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between"><span>Mathematics:</span><span>18 worksheets</span></div>
                                    <div class="flex justify-between"><span>Science:</span><span>12 worksheets</span></div>
                                    <div class="flex justify-between"><span>English:</span><span>10 worksheets</span></div>
                                    <div class="flex justify-between"><span>History:</span><span>5 worksheets</span></div>
                                </div>
                            </div>
                        </div>
                    `
                },
                doubts: {
                    title: 'ü§ñ Doubt Resolution Status',
                    content: `
                        <div class="space-y-4">
                            <div class="bg-red-50 p-4 rounded-lg">
                                <h4 class="font-medium text-red-800 mb-2">Pending Doubts</h4>
                                <div class="grid grid-cols-2 gap-4 text-sm">
                                    <div>Total Pending: <strong>12</strong></div>
                                    <div>Urgent (>24h): <strong class="text-red-600">3</strong></div>
                                    <div>Average Response Time: <strong>2.5 hours</strong></div>
                                    <div>Resolution Rate: <strong class="text-green-600">94%</strong></div>
                                </div>
                            </div>
                            <div class="bg-yellow-50 p-4 rounded-lg">
                                <h4 class="font-medium text-yellow-800 mb-2">Subject-wise Doubts</h4>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between"><span>Mathematics:</span><span class="text-blue-600">5 doubts</span></div>
                                    <div class="flex justify-between"><span>English:</span><span class="text-red-600">4 doubts</span></div>
                                    <div class="flex justify-between"><span>Science:</span><span class="text-yellow-600">2 doubts</span></div>
                                    <div class="flex justify-between"><span>History:</span><span class="text-green-600">1 doubt</span></div>
                                </div>
                            </div>
                        </div>
                    `
                }
            };

            const data = statData[statType];
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">${data.title}</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 text-xl">‚úï</button>
                    </div>
                    ${data.content}
                    <div class="text-center mt-6">
                        <button onclick="this.closest('.fixed').remove()" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600">Close</button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
        }

        // Check API connection
        async function checkAPI() {
            // For demo purposes, always show as online with AI capabilities
            document.getElementById('api-status').innerHTML = '‚úÖ AI Online';
            document.getElementById('api-status').className = 'px-3 py-1 rounded-full text-sm font-medium bg-green-500 text-white';

            // Optional: Still try to check for real backend
            try {
                const healthUrl = window.location.hostname === 'localhost' ?
                    'http://localhost:8000/' :
                    '/api/health';
                const response = await fetch(healthUrl);
                const data = await response.json();
                document.getElementById('api-status').innerHTML = '‚úÖ AI Connected';
            } catch (error) {
                // Keep showing online status even if backend is not available
                // since we have intelligent mock responses
                console.log('Backend not available, using intelligent mock responses');
            }
        }

        // Check API on load
        checkAPI();

        // Initialize page with Student Dashboard as default
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize student data, but don't set default tab here
            // The tab will be set by setupRoleBasedUI() when user logs in
            initializeStudentData();
        });

        function initializeStudentData() {
            // Initialize with default students if none exist
            const existingStudents = JSON.parse(localStorage.getItem('students') || '[]');
            if (existingStudents.length === 0) {
                const defaultStudents = [
                    {
                        student_id: 'STU001',
                        name: 'Priya Sharma',
                        grade: 8,
                        current_level: 76.0,
                        strengths: ['Mathematics', 'Science'],
                        weaknesses: ['English Grammar'],
                        learning_style: 'visual',
                        last_activity: '2024-01-15T10:30:00Z',
                        status: 'active'
                    }
                ];
                localStorage.setItem('students', JSON.stringify(defaultStudents));
                localStorage.setItem('currentStudentId', 'STU001');
            }

            // Update both dashboards
            updateStudentDashboard();
            refreshTeacherDashboard();
        }

        // Report Card Functions
        function initializeReportCard() {
            // Set current date
            const reportDate = document.getElementById('report-date');
            if (reportDate) {
                reportDate.textContent = new Date().toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            }

            // Populate student selector
            updateReportStudentSelector();
        }

        function updateReportStudentSelector() {
            const selector = document.getElementById('report-student-selector');
            if (!selector) return;

            const storedStudents = JSON.parse(localStorage.getItem('students') || '[]');
            const defaultStudent = {
                student_id: 'STU001',
                name: 'Priya Sharma',
                grade: 8,
                learning_style: 'visual'
            };

            const allStudents = [defaultStudent, ...storedStudents];

            selector.innerHTML = '<option value="">Select a student...</option>';
            allStudents.forEach(student => {
                const option = document.createElement('option');
                option.value = student.student_id;
                option.textContent = `${student.name} (${student.student_id})`;
                selector.appendChild(option);
            });
        }

        function generateReportCard(studentId) {
            if (!studentId) {
                document.getElementById('report-card-content').classList.add('hidden');
                document.getElementById('no-student-selected').classList.remove('hidden');
                return;
            }

            // Get student data
            const storedStudents = JSON.parse(localStorage.getItem('students') || '[]');
            const defaultStudent = {
                student_id: 'STU001',
                name: 'Priya Sharma',
                grade: 8,
                learning_style: 'visual',
                current_level: 76,
                strengths: ['Mathematics', 'Science'],
                weaknesses: ['English', 'History'],
                status: 'active'
            };

            const allStudents = [defaultStudent, ...storedStudents];
            const student = allStudents.find(s => s.student_id === studentId);

            if (!student) {
                showToast('‚ùå Student not found!', 'error');
                return;
            }

            // Show report card content
            document.getElementById('report-card-content').classList.remove('hidden');
            document.getElementById('no-student-selected').classList.add('hidden');

            // Populate student information
            document.getElementById('report-student-avatar').textContent = student.name.charAt(0);
            document.getElementById('report-student-name').textContent = student.name;
            document.getElementById('report-student-details').textContent = `Grade ${student.grade} ‚Ä¢ ${student.learning_style} Learner`;
            document.getElementById('report-student-id').textContent = `Student ID: ${student.student_id}`;

            // Calculate overall grade
            const performance = student.current_level || 50;
            const grade = getLetterGrade(performance);
            document.getElementById('report-overall-grade').textContent = grade;

            // Update performance metrics
            document.getElementById('report-performance').textContent = `${performance}%`;
            document.getElementById('report-attendance').textContent = '95%'; // Mock data
            document.getElementById('report-assignments').textContent = Math.floor(Math.random() * 15) + 8;
            document.getElementById('report-improvement').textContent = `+${Math.floor(Math.random() * 10) + 3}%`;

            // Generate subject performance
            generateSubjectPerformance(student);

            // Update strengths and weaknesses
            updateStrengthsWeaknesses(student);

            // Update learning style information
            updateLearningStyleInfo(student);

            // Generate recommendations
            generateRecommendations(student);

            // Generate recent activities
            generateRecentActivities(student);

            // Generate parent guidance
            generateParentGuidance(student);

            // Update teacher comments
            updateTeacherComments(student);

            showToast(`üìä Report card generated for ${student.name}`, 'success');
        }

        function getLetterGrade(percentage) {
            if (percentage >= 90) return 'A+';
            if (percentage >= 85) return 'A';
            if (percentage >= 80) return 'B+';
            if (percentage >= 75) return 'B';
            if (percentage >= 70) return 'C+';
            if (percentage >= 65) return 'C';
            if (percentage >= 60) return 'D+';
            if (percentage >= 55) return 'D';
            return 'F';
        }

        function generateSubjectPerformance(student) {
            const subjects = [
                { name: 'Mathematics', score: Math.max(60, student.current_level + Math.floor(Math.random() * 20) - 10), color: 'blue' },
                { name: 'Science', score: Math.max(60, student.current_level + Math.floor(Math.random() * 20) - 10), color: 'green' },
                { name: 'English', score: Math.max(50, student.current_level + Math.floor(Math.random() * 20) - 15), color: 'purple' },
                { name: 'History', score: Math.max(55, student.current_level + Math.floor(Math.random() * 20) - 12), color: 'orange' },
                { name: 'Geography', score: Math.max(58, student.current_level + Math.floor(Math.random() * 20) - 8), color: 'teal' }
            ];

            const container = document.getElementById('subject-performance');
            container.innerHTML = '';

            subjects.forEach(subject => {
                const grade = getLetterGrade(subject.score);
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg';
                div.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="w-3 h-3 bg-${subject.color}-500 rounded-full"></div>
                        <span class="font-medium text-gray-900">${subject.name}</span>
                    </div>
                    <div class="flex items-center space-x-3">
                        <div class="w-32 bg-gray-200 rounded-full h-2">
                            <div class="bg-${subject.color}-500 h-2 rounded-full" style="width: ${subject.score}%"></div>
                        </div>
                        <span class="text-sm font-medium text-gray-700 w-12">${subject.score}%</span>
                        <span class="text-lg font-bold text-${subject.color}-600 w-8">${grade}</span>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function updateStrengthsWeaknesses(student) {
            const strengthsContainer = document.getElementById('report-strengths');
            const weaknessesContainer = document.getElementById('report-weaknesses');

            // Clear existing content
            strengthsContainer.innerHTML = '';
            weaknessesContainer.innerHTML = '';

            // Add strengths
            const strengths = student.strengths && student.strengths.length > 0 ?
                student.strengths : ['Problem Solving', 'Logical Thinking'];

            strengths.forEach(strength => {
                const span = document.createElement('span');
                span.className = 'px-3 py-1 bg-green-100 text-green-800 text-sm rounded-full';
                span.textContent = strength;
                strengthsContainer.appendChild(span);
            });

            // Add weaknesses
            const weaknesses = student.weaknesses && student.weaknesses.length > 0 ?
                student.weaknesses : ['Reading Comprehension', 'Writing Skills'];

            weaknesses.forEach(weakness => {
                const span = document.createElement('span');
                span.className = 'px-3 py-1 bg-orange-100 text-orange-800 text-sm rounded-full';
                span.textContent = weakness;
                weaknessesContainer.appendChild(span);
            });
        }

        function updateLearningStyleInfo(student) {
            const styleElement = document.getElementById('report-learning-style');
            const descriptionElement = document.getElementById('report-learning-description');

            const learningStyles = {
                'visual': {
                    name: 'Visual Learner',
                    description: 'Learns best through visual aids, diagrams, charts, and colorful presentations'
                },
                'auditory': {
                    name: 'Auditory Learner',
                    description: 'Learns best through listening, discussions, music, and verbal explanations'
                },
                'kinesthetic': {
                    name: 'Kinesthetic Learner',
                    description: 'Learns best through hands-on activities, movement, and practical experiences'
                }
            };

            const style = learningStyles[student.learning_style] || learningStyles['visual'];
            styleElement.textContent = style.name;
            descriptionElement.textContent = style.description;
        }

        function generateRecommendations(student) {
            const container = document.getElementById('report-recommendations');
            container.innerHTML = '';

            const recommendations = [
                'üìö Continue practicing daily math problems to strengthen analytical skills',
                'üé® Use visual learning tools and mind maps for better retention',
                'üë• Participate in group discussions to improve communication skills',
                'üìù Practice writing short essays to enhance language skills',
                'üî¨ Engage in hands-on science experiments for deeper understanding'
            ];

            recommendations.forEach(rec => {
                const div = document.createElement('div');
                div.className = 'text-sm text-purple-700 bg-purple-50 p-2 rounded';
                div.textContent = rec;
                container.appendChild(div);
            });
        }

        function generateRecentActivities(student) {
            const container = document.getElementById('recent-activities');
            container.innerHTML = '';

            const activities = [
                { date: '2024-08-05', activity: 'Completed Algebra Worksheet', score: '85%', type: 'worksheet' },
                { date: '2024-08-04', activity: 'AI Doubt Clearing Session', score: '5 questions', type: 'doubt' },
                { date: '2024-08-03', activity: 'Science Quiz on Photosynthesis', score: '92%', type: 'quiz' },
                { date: '2024-08-02', activity: 'English Reading Comprehension', score: '78%', type: 'reading' },
                { date: '2024-08-01', activity: 'Math Problem Solving Session', score: '88%', type: 'math' }
            ];

            activities.forEach(activity => {
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg';

                const typeIcons = {
                    'worksheet': 'üìù',
                    'doubt': 'ü§ñ',
                    'quiz': 'üìä',
                    'reading': 'üìñ',
                    'math': 'üî¢'
                };

                div.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <span class="text-xl">${typeIcons[activity.type] || 'üìö'}</span>
                        <div>
                            <div class="font-medium text-gray-900">${activity.activity}</div>
                            <div class="text-sm text-gray-500">${activity.date}</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="font-medium text-blue-600">${activity.score}</div>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function generateParentGuidance(student) {
            const homeGuidance = document.getElementById('home-guidance');
            const nextSteps = document.getElementById('next-steps');

            homeGuidance.innerHTML = '';
            nextSteps.innerHTML = '';

            const homeAdvice = [
                'üìñ Set aside 30 minutes daily for reading practice',
                'üßÆ Practice mental math during everyday activities',
                'üé® Use colorful charts and diagrams for visual learning',
                'üí¨ Encourage questions and discussions about school topics',
                '‚è∞ Maintain a consistent study schedule'
            ];

            const nextStepsAdvice = [
                'üéØ Focus on improving writing and communication skills',
                'üìö Enroll in advanced mathematics programs',
                'üî¨ Explore science experiments and projects',
                'üë• Join study groups for collaborative learning',
                'üì± Use educational apps for interactive learning'
            ];

            homeAdvice.forEach(advice => {
                const li = document.createElement('li');
                li.textContent = advice;
                homeGuidance.appendChild(li);
            });

            nextStepsAdvice.forEach(step => {
                const li = document.createElement('li');
                li.textContent = step;
                nextSteps.appendChild(li);
            });
        }

        function updateTeacherComments(student) {
            const commentsElement = document.getElementById('teacher-comments');

            const comments = [
                `${student.name} demonstrates excellent analytical thinking and shows consistent improvement in problem-solving skills. Recommend focusing on language arts for well-rounded development.`,
                `This student shows great enthusiasm for learning and actively participates in class discussions. Continue encouraging curiosity and exploration in all subjects.`,
                `${student.name} has shown remarkable progress this term. The visual learning approach is working well. Suggest incorporating more hands-on activities for enhanced engagement.`,
                `Strong performance in STEM subjects with room for growth in creative writing. Recommend joining the school's creative writing club to develop these skills further.`
            ];

            const randomComment = comments[Math.floor(Math.random() * comments.length)];
            commentsElement.textContent = randomComment;
        }

        function downloadReportCard() {
            const studentSelector = document.getElementById('report-student-selector');
            const selectedStudentId = studentSelector.value;

            if (!selectedStudentId) {
                showToast('‚ùå Please select a student first!', 'error');
                return;
            }

            // Get student name for filename
            const selectedOption = studentSelector.options[studentSelector.selectedIndex];
            const studentName = selectedOption.textContent.split(' (')[0];

            // Create a simplified version for download
            const reportContent = `
AI EDUCATION AGENT - STUDENT REPORT CARD
Generated: ${new Date().toLocaleDateString()}

STUDENT INFORMATION:
${document.getElementById('report-student-name').textContent}
${document.getElementById('report-student-details').textContent}
${document.getElementById('report-student-id').textContent}

OVERALL PERFORMANCE:
Overall Grade: ${document.getElementById('report-overall-grade').textContent}
Performance: ${document.getElementById('report-performance').textContent}
Attendance: ${document.getElementById('report-attendance').textContent}
Assignments Completed: ${document.getElementById('report-assignments').textContent}
Monthly Improvement: ${document.getElementById('report-improvement').textContent}

TEACHER'S COMMENTS:
${document.getElementById('teacher-comments').textContent}

RECOMMENDATIONS FOR PARENTS:
- Set aside 30 minutes daily for reading practice
- Practice mental math during everyday activities
- Use colorful charts and diagrams for visual learning
- Encourage questions and discussions about school topics
- Maintain a consistent study schedule

This report was generated by the AI Education Agent system.
For more detailed analytics, please visit the online dashboard.
            `;

            // Create and download the file
            const blob = new Blob([reportContent], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${studentName}_Report_Card_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);

            showToast(`üì• Report card downloaded for ${studentName}!`, 'success');
        }

        // Initialize theme, language and statistics on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize in proper order: language first, then theme, then other features
            initializeLanguage();
            initializeTheme();
            updateStatistics();
        });

        // Initialize data and theme, but don't set default tab here
        // The tab will be set by setupRoleBasedUI() when user logs in
        initializeStudentData();
        initializeTheme();
        updateStatistics();

        // Authentication System
        let currentUser = null;
        let currentUserRole = null;

        function resetDemoData() {
            // Clear all existing data
            localStorage.removeItem('teachers');
            localStorage.removeItem('students');
            localStorage.removeItem('currentUser');
            localStorage.removeItem('userRole');
            localStorage.removeItem('currentStudentId');

            // Reset current user variables
            currentUser = null;
            currentUserRole = null;

            // Reinitialize default data
            initializeDefaultData();

            // Reset to home page
            showHomePage();

            showToast('‚úÖ Demo data reset successfully! You can now use the demo credentials.', 'success');
            console.log('Demo data reset completed');
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded, initializing...');
            initializeDefaultData();
            checkAuthStatus();
        });

        // Also initialize immediately (in case DOMContentLoaded already fired)
        if (document.readyState === 'loading') {
            // Document is still loading
        } else {
            // Document has already loaded
            console.log('Document already loaded, initializing immediately...');
            initializeDefaultData();
        }

        function initializeDefaultData() {
            // Always ensure default teacher account exists
            let teachers = JSON.parse(localStorage.getItem('teachers') || '[]');

            // Check if default teacher exists, if not add it
            const defaultTeacherExists = teachers.find(t => t.email === 'teacher@demo.com');
            if (!defaultTeacherExists) {
                const defaultTeacher = {
                    id: 'T001',
                    name: 'Demo Teacher',
                    email: 'teacher@demo.com',
                    school: 'Government High School',
                    password: 'demo123',
                    createdAt: new Date().toISOString()
                };
                teachers.push(defaultTeacher);
                localStorage.setItem('teachers', JSON.stringify(teachers));
                console.log('Default teacher created:', defaultTeacher);
            }

            // Always ensure default student account exists
            let students = JSON.parse(localStorage.getItem('students') || '[]');

            // Check if default student exists, if not add it
            const defaultStudentExists = students.find(s => s.student_id === 'STU001');
            if (!defaultStudentExists) {
                const defaultStudent = {
                    student_id: 'STU001',
                    name: 'Priya Sharma',
                    grade: 8,
                    password: 'stu001123',
                    current_level: 76.0,
                    strengths: ['Mathematics', 'Science'],
                    weaknesses: ['English', 'History'],
                    learning_style: 'Visual',
                    last_activity: new Date().toISOString(),
                    status: 'active'
                };
                students.push(defaultStudent);
                localStorage.setItem('students', JSON.stringify(students));
                console.log('Default student created:', defaultStudent);
            }

            // Debug: Log current data
            console.log('Teachers in storage:', JSON.parse(localStorage.getItem('teachers') || '[]'));
            console.log('Students in storage:', JSON.parse(localStorage.getItem('students') || '[]'));
        }

        function checkAuthStatus() {
            const user = localStorage.getItem('currentUser');
            const role = localStorage.getItem('userRole');

            if (user && role) {
                currentUser = JSON.parse(user);
                currentUserRole = role;
                showMainApp();
            } else {
                showHomePage();
            }
        }

        function showHomePage() {
            document.getElementById('home-page').classList.remove('hidden');
            document.getElementById('main-app').classList.add('hidden');

            // When showing home page (no user logged in), default to Student Dashboard view
            showTab(0);
        }

        function showMainApp() {
            document.getElementById('home-page').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');

            // Update user info in header
            document.getElementById('user-welcome').textContent = `Welcome, ${currentUser.name}!`;
            document.getElementById('user-role').textContent = currentUserRole === 'teacher' ? 'Teacher Dashboard' : 'Student Dashboard';
            document.getElementById('user-avatar').textContent = currentUserRole === 'teacher' ? 'üë®‚Äçüè´' : 'üë®‚Äçüéì';

            // Show appropriate tabs based on role
            setupRoleBasedUI();

            initializeTheme();
            updateStatistics();
        }

        function setupRoleBasedUI() {
            console.log('Setting up UI for role:', currentUserRole);
            const tabs = document.querySelectorAll('[id^="tab-"]');

            if (currentUserRole === 'student') {
                console.log('Setting up student UI - showing Student Dashboard, AI Features, and Report Card');
                // Student can see: Student Dashboard, AI Features, Report Card
                tabs[0].classList.remove('hidden'); // Student Dashboard

                // Completely remove Teacher Dashboard tab from DOM for students
                const teacherTab = tabs[1];
                if (teacherTab) {
                    teacherTab.remove();
                }

                tabs[2].classList.remove('hidden'); // AI Features
                tabs[3].classList.remove('hidden'); // Report Card

                // Remove student selector from student dashboard
                const studentSelector = document.getElementById('student-selector');
                if (studentSelector) {
                    studentSelector.remove();
                }

                // Set default tab to Student Dashboard
                showTab(0);
            } else if (currentUserRole === 'teacher') {
                console.log('Setting up teacher UI - showing only Teacher Dashboard');
                // Teacher can ONLY see Teacher Dashboard

                // Completely remove Student Dashboard, AI Features, and Report Card tabs from DOM for teachers
                const studentTab = tabs[0];
                const aiTab = tabs[2];
                const reportTab = tabs[3];

                if (studentTab) {
                    studentTab.remove();
                }
                if (aiTab) {
                    aiTab.remove();
                }
                if (reportTab) {
                    reportTab.remove();
                }

                // Show only Teacher Dashboard
                tabs[1].classList.remove('hidden'); // Teacher Dashboard

                // Hide non-teacher content
                const studentContent = document.getElementById('content-0');
                const aiContent = document.getElementById('content-2');
                const reportContent = document.getElementById('content-3');

                if (studentContent) {
                    studentContent.style.display = 'none';
                }
                if (aiContent) {
                    aiContent.style.display = 'none';
                }
                if (reportContent) {
                    reportContent.style.display = 'none';
                }

                // Default to Teacher Dashboard for teachers
                setTimeout(() => {
                    showTab(1); // Teacher Dashboard
                }, 100); // Small delay to ensure DOM is ready
            }
        }

        function showRoleSelection() {
            document.getElementById('role-selection').classList.remove('hidden');
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('signup-form').classList.add('hidden');
        }

        function showLogin(role) {
            document.getElementById('role-selection').classList.add('hidden');
            document.getElementById('login-form').classList.remove('hidden');
            document.getElementById('signup-form').classList.add('hidden');

            const title = document.getElementById('login-title');
            const signupOption = document.getElementById('teacher-signup-option');

            if (role === 'teacher') {
                title.textContent = 'Teacher Login';
                signupOption.classList.remove('hidden');
                document.getElementById('login-id').placeholder = 'Enter your email';
            } else {
                title.textContent = 'Student Login';
                signupOption.classList.add('hidden');
                document.getElementById('login-id').placeholder = 'Enter your Student ID';
            }

            // Store current role for login
            document.getElementById('login-form').setAttribute('data-role', role);
        }

        function showSignup() {
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('signup-form').classList.remove('hidden');
        }

        function togglePasswordVisibility(inputId, button) {
            const passwordInput = document.getElementById(inputId);
            const eyeIcon = button.querySelector('svg');

            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                // Change to eye-slash icon (closed eye)
                eyeIcon.innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21" />
                `;
            } else {
                passwordInput.type = 'password';
                // Change back to eye icon (open eye)
                eyeIcon.innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                `;
            }
        }

        function handleLogin(event) {
            event.preventDefault();

            const role = document.getElementById('login-form').getAttribute('data-role');
            const loginId = document.getElementById('login-id').value;
            const password = document.getElementById('login-password').value;
            const submitButton = event.target.querySelector('button[type="submit"]');

            // Show loading state
            const originalText = submitButton.innerHTML;
            submitButton.innerHTML = '<div class="loading-spinner inline-block mr-2"></div>Logging in...';
            submitButton.disabled = true;

            if (role === 'teacher') {
                // Check teacher credentials
                const teachers = JSON.parse(localStorage.getItem('teachers') || '[]');
                console.log('Available teachers:', teachers);
                console.log('Login attempt - Email:', loginId, 'Password:', password);

                const teacher = teachers.find(t => t.email === loginId && t.password === password);
                console.log('Found teacher:', teacher);

                if (teacher) {
                    currentUser = teacher;
                    currentUserRole = 'teacher';
                    localStorage.setItem('currentUser', JSON.stringify(teacher));
                    localStorage.setItem('userRole', 'teacher');
                    console.log('Teacher login successful, showing main app...');
                    showMainApp();
                    showToast('‚úÖ Welcome back, ' + teacher.name + '!', 'success');
                } else {
                    showToast('‚ùå Invalid email or password. Try clicking "Reset Demo Data" first.', 'error');
                }
            } else {
                // Check student credentials
                const students = JSON.parse(localStorage.getItem('students') || '[]');
                console.log('Available students:', students);
                console.log('Login attempt - Student ID:', loginId, 'Password:', password);

                const student = students.find(s => s.student_id === loginId && s.password === password);
                console.log('Found student:', student);

                if (student) {
                    currentUser = student;
                    currentUserRole = 'student';
                    localStorage.setItem('currentUser', JSON.stringify(student));
                    localStorage.setItem('userRole', 'student');
                    localStorage.setItem('currentStudentId', student.student_id);
                    showMainApp();
                    showToast('‚úÖ Welcome back, ' + student.name + '!', 'success');
                } else {
                    showToast('‚ùå Invalid Student ID or password. Try clicking "Reset Demo Data" first.', 'error');
                }
            }

            // Reset loading state
            setTimeout(() => {
                submitButton.innerHTML = originalText;
                submitButton.disabled = false;
            }, 1000);
        }

        function handleSignup(event) {
            event.preventDefault();

            const name = document.getElementById('signup-name').value;
            const email = document.getElementById('signup-email').value;
            const school = document.getElementById('signup-school').value;
            const password = document.getElementById('signup-password').value;

            // Check if teacher already exists
            const teachers = JSON.parse(localStorage.getItem('teachers') || '[]');
            if (teachers.find(t => t.email === email)) {
                showToast('‚ùå Teacher with this email already exists', 'error');
                return;
            }

            // Create new teacher
            const newTeacher = {
                id: 'T' + Date.now(),
                name: name,
                email: email,
                school: school,
                password: password,
                createdAt: new Date().toISOString()
            };

            teachers.push(newTeacher);
            localStorage.setItem('teachers', JSON.stringify(teachers));

            showToast('‚úÖ Account created successfully! Please login.', 'success');
            showLogin('teacher');
        }

        function logout() {
            // Clear all user session data
            localStorage.removeItem('currentUser');
            localStorage.removeItem('userRole');
            localStorage.removeItem('currentStudentId');
            currentUser = null;
            currentUserRole = null;

            // Reset to home page
            showHomePage();
            showToast('üëã Logged out successfully!', 'success');

            // Reset form
            document.getElementById('login-id').value = '';
            document.getElementById('login-password').value = '';
        }

        function showHelpModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">üìö Help & Instructions</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 text-xl">‚úï</button>
                    </div>

                    <div class="space-y-4 text-sm text-gray-700 dark:text-gray-300">
                        <div>
                            <h4 class="font-semibold text-pantone-blue mb-2">üîë Demo Credentials</h4>
                            <p><strong>Teacher:</strong> teacher@demo.com / demo123</p>
                            <p><strong>Student:</strong> STU001 / stu001123</p>
                        </div>

                        <div>
                            <h4 class="font-semibold text-pantone-blue mb-2">‚å®Ô∏è Keyboard Shortcuts</h4>
                            <p><strong>Alt + T:</strong> Toggle theme</p>
                            <p><strong>Alt + L:</strong> Logout</p>
                            <p><strong>Escape:</strong> Close modals</p>
                        </div>

                        <div>
                            <h4 class="font-semibold text-pantone-blue mb-2">üë®‚Äçüè´ Teacher Features</h4>
                            <p>‚Ä¢ Add and manage students</p>
                            <p>‚Ä¢ View class statistics</p>
                            <p>‚Ä¢ Export progress reports to Excel</p>
                            <p>‚Ä¢ Access all AI features</p>
                        </div>

                        <div>
                            <h4 class="font-semibold text-pantone-blue mb-2">üë®‚Äçüéì Student Features</h4>
                            <p>‚Ä¢ Personalized learning dashboard</p>
                            <p>‚Ä¢ AI-powered doubt clearing</p>
                            <p>‚Ä¢ Smart worksheets</p>
                            <p>‚Ä¢ Interactive learning sessions</p>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            // Alt + T for theme toggle
            if (event.altKey && event.key === 't') {
                event.preventDefault();
                toggleTheme();
            }

            // Alt + L for logout (when logged in)
            if (event.altKey && event.key === 'l' && currentUser) {
                event.preventDefault();
                logout();
            }

            // Escape to close modals
            if (event.key === 'Escape') {
                const modals = document.querySelectorAll('.fixed.inset-0');
                modals.forEach(modal => modal.remove());
            }
        });

        // Function to clear session and start fresh
        function clearSession() {
            localStorage.removeItem('currentUser');
            localStorage.removeItem('userRole');
            currentUser = null;
            currentUserRole = null;
        }

        // Initialize on page load
        clearSession(); // Clear any existing session to start fresh
        initializeDemoData();
        checkAuthStatus();
    </script>

    <!-- Status Bar at Bottom -->
    <footer class="bg-pantone-accent dark:bg-gray-800 text-white py-2 px-4 text-center text-sm">
        <p>üéì AI Education Agent - Full AI-Powered Version | Version 2.0.0 | OpenAI Status: ‚úÖ Connected</p>
    </footer>

    </div> <!-- Close main-app div -->

</body>
</html>